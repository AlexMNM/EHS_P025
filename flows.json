[
    {
        "id": "a7c7ec5294135863",
        "type": "tab",
        "label": "I/O",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "8e125f4bb2233c4b",
        "type": "tab",
        "label": "Keysight",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "c4157bddbbb8817a",
        "type": "tab",
        "label": "Logic",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0e117d41da2683ed",
        "type": "tab",
        "label": "Database",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "f0b99c790d575624",
        "type": "tab",
        "label": "Library",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "a6c85f6538755b0c",
        "type": "tab",
        "label": "Ui",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0637f22188042045",
        "type": "tab",
        "label": "Ui-Home",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "0ba5db83a2227bb8",
        "type": "tab",
        "label": "UI-Marius",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "85a0c31e48c798bf",
        "type": "tab",
        "label": "Ui-Database",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "aecf9ba551ec4a57",
        "type": "tab",
        "label": "Ui-Settings",
        "disabled": false,
        "info": "",
        "env": []
    },
    {
        "id": "6b7a48cdf37ecce9",
        "type": "tab",
        "label": "Example mongodb4",
        "disabled": true,
        "info": "",
        "env": []
    },
    {
        "id": "c31a62b56be46a15",
        "type": "tab",
        "label": "34465A Capture+Bounce (D2)",
        "disabled": true,
        "info": ""
    },
    {
        "id": "91212d0a56043b3b",
        "type": "group",
        "z": "aecf9ba551ec4a57",
        "name": "Edit product type",
        "style": {
            "label": true
        },
        "nodes": [
            "f2e3a0db8dea4a4b",
            "92184b1fbbb492a6",
            "420103eb5538d470",
            "f17665e77a438a74",
            "7f188de42da84111",
            "d3a57847349e12ca",
            "03b94af069cc8537",
            "ea8d11d48fdca17f",
            "d22bef696024a279",
            "396bfb23c28ff5b8",
            "f9cece5ac88ea2a7",
            "6613ee3a67759dd0",
            "dbca34e49233a7d4",
            "5a000baa5781089c",
            "953994fd1285bde1",
            "34b26a7ff80a850f",
            "150473f2c686409d",
            "3380c5beca686cc8",
            "d81db01110179032",
            "b813fb708889b927",
            "4f06528212ea74a0",
            "a08dcea851cda779",
            "9c94e675360ccf7c",
            "4757177110a58530",
            "ca237eb130a5bdc3",
            "f90fdbbfe117b568",
            "1f3b495e00daba71",
            "30e422b091f39fa3",
            "d069aa2590aa031f",
            "a601fa8b67067a91",
            "e4eda6a9e6628f2f",
            "d1876fc92f5ef163",
            "6d3a3d61dd8734cf",
            "3d457befa2bee268",
            "5239e5d08e988b30"
        ],
        "x": 44,
        "y": 539,
        "w": 892,
        "h": 442
    },
    {
        "id": "32c9d68b1d798fbc",
        "type": "group",
        "z": "aecf9ba551ec4a57",
        "name": "Settings",
        "style": {
            "label": true
        },
        "nodes": [
            "32c2e30c04b0a7cb",
            "d4219e24a88dc0e8",
            "eaa2da6793b55f40",
            "76313568f2a04441",
            "db5b289970cf2446",
            "b19da3d04cf94fc2"
        ],
        "x": 54,
        "y": 1039,
        "w": 522,
        "h": 162
    },
    {
        "id": "3eb3d696e34bc6e2",
        "type": "group",
        "z": "aecf9ba551ec4a57",
        "name": "Select product type",
        "style": {
            "label": true
        },
        "nodes": [
            "8cde3623a591ad28",
            "e361215bc8c832ec",
            "5516c6e781361bc2",
            "318ffbd6feb78037",
            "acd4787a8b6262f8",
            "624a2e68fe5f9cd6",
            "f47cbfc45fced655",
            "877013ed22113b66",
            "a4325849565fb5be",
            "6d84d370604bcb7f",
            "1c0bdfa30262cea9",
            "632d196f1b0465cb",
            "f99e252f0a818113",
            "4f8bb3c473c5249f"
        ],
        "x": 44,
        "y": 179,
        "w": 822,
        "h": 309.5
    },
    {
        "id": "694442544535cd79",
        "type": "junction",
        "z": "0637f22188042045",
        "x": 960,
        "y": 820,
        "wires": [
            [
                "bccca76e7ee582a9"
            ]
        ]
    },
    {
        "id": "8020914300043d42",
        "type": "junction",
        "z": "0637f22188042045",
        "x": 2180,
        "y": 920,
        "wires": [
            [
                "247148b3adf6b567"
            ]
        ]
    },
    {
        "id": "cc61ef53d87fc729",
        "type": "junction",
        "z": "0637f22188042045",
        "x": 2040,
        "y": 1400,
        "wires": [
            [
                "13e1a51b2ebcf21c"
            ]
        ]
    },
    {
        "id": "4a622033fd22118c",
        "type": "junction",
        "z": "c4157bddbbb8817a",
        "x": 1000,
        "y": 600,
        "wires": [
            [
                "43ee3d72e8e6ab80",
                "933f114c0b9919b8"
            ]
        ]
    },
    {
        "id": "6535ec5645ee3d86",
        "type": "junction",
        "z": "0637f22188042045",
        "x": 1860,
        "y": 460,
        "wires": [
            [
                "0eac7f2727c502b3"
            ]
        ]
    },
    {
        "id": "b286894fefbfc7bc",
        "type": "mongodb4-client",
        "name": "",
        "protocol": "mongodb",
        "hostname": "database",
        "port": "",
        "dbName": "test_db",
        "appName": "",
        "authSource": "",
        "authMechanism": "DEFAULT",
        "tls": false,
        "tlsCAFile": "",
        "tlsCertificateKeyFile": "",
        "tlsInsecure": false,
        "connectTimeoutMS": "30000",
        "socketTimeoutMS": "0",
        "minPoolSize": "0",
        "maxPoolSize": "100",
        "maxIdleTimeMS": "0",
        "uri": "",
        "advanced": "{}",
        "uriTabActive": "tab-uri-simple"
    },
    {
        "id": "86cea779c465227a",
        "type": "ui-base",
        "name": "My Dashboard",
        "path": "/dashboard",
        "appIcon": "",
        "includeClientData": true,
        "acceptsClientConfig": [
            "ui-notification",
            "ui-control"
        ],
        "showPathInSidebar": false,
        "headerContent": "page",
        "navigationStyle": "default",
        "titleBarStyle": "default",
        "showReconnectNotification": true,
        "notificationDisplayTime": 1,
        "showDisconnectNotification": true,
        "allowInstall": true
    },
    {
        "id": "db3c0ff5429c4380",
        "type": "ui-theme",
        "name": "Default Theme",
        "colors": {
            "surface": "#ffffff",
            "primary": "#0094CE",
            "bgPage": "#eeeeee",
            "groupBg": "#ffffff",
            "groupOutline": "#cccccc"
        },
        "sizes": {
            "density": "default",
            "pagePadding": "12px",
            "groupGap": "12px",
            "groupBorderRadius": "4px",
            "widgetGap": "12px"
        }
    },
    {
        "id": "848bac8770d29cf3",
        "type": "ui-page",
        "name": "Database",
        "ui": "86cea779c465227a",
        "path": "/page2",
        "icon": "database-search ",
        "layout": "grid",
        "theme": "db3c0ff5429c4380",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 3,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "26cc4e226e9df6bb",
        "type": "ui-group",
        "name": "Search database",
        "page": "848bac8770d29cf3",
        "width": "3",
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "08a4c47b7bced26d",
        "type": "ui-group",
        "name": "Results",
        "page": "848bac8770d29cf3",
        "width": "4",
        "height": 1,
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "5f03761aafa114cc",
        "type": "ui-group",
        "name": "Graphic",
        "page": "848bac8770d29cf3",
        "width": "5",
        "height": 1,
        "order": 3,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "08baf0b5c9586966",
        "type": "s7 endpoint",
        "d": true,
        "transport": "iso-on-tcp",
        "address": "192.168.100.10",
        "port": "102",
        "rack": "0",
        "slot": "1",
        "localtsaphi": "01",
        "localtsaplo": "00",
        "remotetsaphi": "01",
        "remotetsaplo": "00",
        "connmode": "rack-slot",
        "adapter": "",
        "busaddr": 2,
        "cycletime": "0",
        "timeout": 2000,
        "name": "Plc",
        "vartable": [
            {
                "addr": "DB3,B14.7200",
                "name": "resultBuffer"
            },
            {
                "addr": "DB3,DI10",
                "name": "count"
            }
        ]
    },
    {
        "id": "3cb7f915b2dc54d4",
        "type": "s7comm",
        "ip": "192.168.100.10",
        "port": "102",
        "rack": "0",
        "slot": "1",
        "payload": [
            {
                "S7_Type": "DB",
                "S7_DBnum": "3",
                "S7_Datatype": "B",
                "S7_Offset": "14",
                "S7_BitOffset": "0",
                "S7_Quantity": "6000",
                "S7_Name": "resultBuffer"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "3",
                "S7_Datatype": "DI",
                "S7_Offset": "10",
                "S7_BitOffset": "0",
                "S7_Quantity": "1",
                "S7_Name": "count"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "23",
                "S7_Datatype": "STRING",
                "S7_Offset": "0",
                "S7_BitOffset": "0",
                "S7_Quantity": "254",
                "S7_Name": "productType"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "23",
                "S7_Datatype": "STRING",
                "S7_Offset": "256",
                "S7_BitOffset": "0",
                "S7_Quantity": "254",
                "S7_Name": "productOrder"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "23",
                "S7_Datatype": "B",
                "S7_Offset": "512",
                "S7_BitOffset": "0",
                "S7_Quantity": "36",
                "S7_Name": "productFeatures"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "23",
                "S7_Datatype": "B",
                "S7_Offset": "548",
                "S7_BitOffset": "0",
                "S7_Quantity": "180",
                "S7_Name": "productParameters"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "8",
                "S7_Datatype": "B",
                "S7_Offset": "0",
                "S7_BitOffset": "0",
                "S7_Quantity": "140",
                "S7_Name": "procStages"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "8",
                "S7_Datatype": "uint16",
                "S7_Offset": "140",
                "S7_BitOffset": "0",
                "S7_Quantity": "1",
                "S7_Name": "procStageCount"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "8",
                "S7_Datatype": "DI",
                "S7_Offset": "142",
                "S7_BitOffset": "0",
                "S7_Quantity": "1",
                "S7_Name": "procActStage"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "15",
                "S7_Datatype": "B",
                "S7_Offset": "0",
                "S7_BitOffset": "0",
                "S7_Quantity": "6600",
                "S7_Name": "ohmData_0"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "15",
                "S7_Datatype": "B",
                "S7_Offset": "6600",
                "S7_BitOffset": "0",
                "S7_Quantity": "6600",
                "S7_Name": "ohmData_1"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "15",
                "S7_Datatype": "uint16",
                "S7_Offset": "13200",
                "S7_BitOffset": "0",
                "S7_Quantity": "1",
                "S7_Name": "ohmCount"
            },
            {
                "S7_Type": "DB",
                "S7_DBnum": "15",
                "S7_Datatype": "DI",
                "S7_Offset": "13202",
                "S7_BitOffset": "0",
                "S7_Quantity": "1",
                "S7_Name": "ohmStage"
            }
        ]
    },
    {
        "id": "78bfe53267642fbf",
        "type": "ui-page",
        "name": "Main",
        "ui": "86cea779c465227a",
        "path": "/page1",
        "icon": "home",
        "layout": "grid",
        "theme": "db3c0ff5429c4380",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 2,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "28b505574a770e44",
        "type": "ui-page",
        "name": "Settings",
        "ui": "86cea779c465227a",
        "path": "/page3",
        "icon": "tune",
        "layout": "grid",
        "theme": "db3c0ff5429c4380",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 4,
        "className": "",
        "visible": true,
        "disabled": false
    },
    {
        "id": "328519736c0eac55",
        "type": "ui-group",
        "name": "Products",
        "page": "28b505574a770e44",
        "width": "4",
        "height": 1,
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "9a2350a4f1394335",
        "type": "ui-group",
        "name": "Statistics",
        "page": "78bfe53267642fbf",
        "width": 4,
        "height": "1",
        "order": 2,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "bf198eb6e69ac543",
        "type": "ui-group",
        "name": "Inner encoder",
        "page": "78bfe53267642fbf",
        "width": 4,
        "height": "4",
        "order": 4,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "3378c67758bc3e77",
        "type": "ui-group",
        "name": "Outer encoder",
        "page": "78bfe53267642fbf",
        "width": 4,
        "height": "4",
        "order": 5,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "89a4f69b951b98f3",
        "type": "ui-group",
        "name": "Button",
        "page": "78bfe53267642fbf",
        "width": 4,
        "height": 1,
        "order": 6,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "6f6a6db0185ac9a4",
        "type": "ui-group",
        "name": "Setup",
        "page": "78bfe53267642fbf",
        "width": 5,
        "height": 1,
        "order": 1,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "b7574cc4a83ac22e",
        "type": "ui-group",
        "name": "Values",
        "page": "28b505574a770e44",
        "width": "8",
        "height": 1,
        "order": 3,
        "showTitle": true,
        "className": "",
        "visible": "false",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "af49f759fce29780",
        "type": "ui-group",
        "name": "Edit value",
        "page": "28b505574a770e44",
        "width": 6,
        "height": "7",
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "dialog"
    },
    {
        "id": "0d92c765bfad87e6",
        "type": "ui-theme",
        "name": "Basic Blue Theme",
        "colors": {
            "surface": "#4d58ff",
            "primary": "#0094ce",
            "bgPage": "#eeeeee",
            "groupBg": "#ffffff",
            "groupOutline": "#cccccc"
        },
        "sizes": {
            "pagePadding": "12px",
            "groupGap": "12px",
            "groupBorderRadius": "4px",
            "widgetGap": "12px",
            "density": "default"
        }
    },
    {
        "id": "1f120d7b63a85b3d",
        "type": "ui-page",
        "name": "Marius",
        "ui": "86cea779c465227a",
        "path": "/page4",
        "icon": "axe",
        "layout": "grid",
        "theme": "0d92c765bfad87e6",
        "breakpoints": [
            {
                "name": "Default",
                "px": "0",
                "cols": "3"
            },
            {
                "name": "Tablet",
                "px": "576",
                "cols": "6"
            },
            {
                "name": "Small Desktop",
                "px": "768",
                "cols": "9"
            },
            {
                "name": "Desktop",
                "px": "1024",
                "cols": "12"
            }
        ],
        "order": 1,
        "className": "",
        "visible": "true",
        "disabled": "false"
    },
    {
        "id": "8c7f35716465254a",
        "type": "ui-group",
        "name": "Out",
        "page": "1f120d7b63a85b3d",
        "width": "12",
        "height": 1,
        "order": 2,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "3ebbad412a47acd4",
        "type": "ui-group",
        "name": "Marius",
        "page": "1f120d7b63a85b3d",
        "width": 6,
        "height": 1,
        "order": 1,
        "showTitle": true,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "38ddce4a31197555",
        "type": "ui-group",
        "name": "Result",
        "page": "78bfe53267642fbf",
        "width": 2,
        "height": 1,
        "order": 3,
        "showTitle": false,
        "className": "",
        "visible": "true",
        "disabled": "false",
        "groupType": "default"
    },
    {
        "id": "f7676b47d7dc782a",
        "type": "tcp in",
        "z": "a7c7ec5294135863",
        "name": "",
        "server": "server",
        "host": "",
        "port": "1881",
        "datamode": "stream",
        "datatype": "utf8",
        "newline": "",
        "topic": "",
        "trim": false,
        "base64": false,
        "tls": "",
        "x": 260,
        "y": 440,
        "wires": [
            [
                "410e4594e6ee8790",
                "fe0dae770e5e2106",
                "4c147073df63d385"
            ]
        ]
    },
    {
        "id": "42f86a76711d556d",
        "type": "tcp request",
        "z": "a7c7ec5294135863",
        "name": "",
        "server": "host.docker.internal",
        "port": "8000",
        "out": "sit",
        "ret": "string",
        "splitc": " ",
        "newline": "",
        "trim": false,
        "tls": "",
        "x": 440,
        "y": 620,
        "wires": [
            [
                "2fccc716f9a80afa",
                "f025faa8bcc5189d"
            ]
        ]
    },
    {
        "id": "50591a9bfab375b0",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "logik out",
        "mode": "link",
        "links": [
            "745dac0558d14053"
        ],
        "x": 1465,
        "y": 600,
        "wires": []
    },
    {
        "id": "5aa597c1af9984f8",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "to extension in",
        "links": [
            "364fe0205ba99901"
        ],
        "x": 265,
        "y": 620,
        "wires": [
            [
                "42f86a76711d556d"
            ]
        ]
    },
    {
        "id": "081f4f5260792cc4",
        "type": "tcp out",
        "z": "a7c7ec5294135863",
        "name": "",
        "host": "",
        "port": "",
        "beserver": "reply",
        "base64": false,
        "end": false,
        "tls": "",
        "x": 1430,
        "y": 260,
        "wires": []
    },
    {
        "id": "6739d8b2b161e960",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inStarted",
        "links": [
            "46a3c3149898b41f",
            "0ad8baea941ce172"
        ],
        "x": 915,
        "y": 220,
        "wires": [
            [
                "d50364178d0efc4d"
            ]
        ]
    },
    {
        "id": "fe0dae770e5e2106",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "keep_session",
        "rules": [
            {
                "t": "set",
                "p": "session",
                "pt": "flow",
                "to": "_session",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 500,
        "y": 240,
        "wires": [
            []
        ]
    },
    {
        "id": "d50364178d0efc4d",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "send Ack",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[\"BROKER\",\"Ack\"]",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1020,
        "y": 220,
        "wires": [
            [
                "4c147073df63d385",
                "05639a7b3ca71415"
            ]
        ]
    },
    {
        "id": "2fccc716f9a80afa",
        "type": "switch",
        "z": "a7c7ec5294135863",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "AqStarted",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "AqResults",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 620,
        "wires": [
            [
                "0ad8baea941ce172"
            ],
            [
                "3fe6cbb983baf291"
            ]
        ]
    },
    {
        "id": "5391fc0432d5ade1",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"3\",\"S7_Datatype\":\"B\",\"S7_Offset\":\"14\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"6000\",\"S7_Name\":\"resultBuffer\"}",
        "s7Name": "resultBuffer",
        "topic": "resultBuffer",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 860,
        "wires": [
            [
                "3be72af7c7b1aeee"
            ]
        ]
    },
    {
        "id": "6aa20c06f449d656",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"3\",\"S7_Datatype\":\"DI\",\"S7_Offset\":\"10\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"1\",\"S7_Name\":\"count\"}",
        "s7Name": "count",
        "topic": "count",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 820,
        "wires": [
            [
                "3be72af7c7b1aeee",
                "5391fc0432d5ade1"
            ]
        ]
    },
    {
        "id": "3be72af7c7b1aeee",
        "type": "function",
        "z": "a7c7ec5294135863",
        "name": "compose_payload",
        "func": "const chunk_size = 12\nswitch (msg.topic) {\n    case \"count\":\n        context.set(\"count\", msg.payload.value[0])\n        return\n    case \"resultBuffer\":\n        const count = context.get(\"count\");\n        const data = new Uint8Array(msg.payload.value.slice(0, count*chunk_size))\n        const chunks = chunk(data, chunk_size)\n        const results = chunks.map((e) => ({\n            timeStamp: new DataView(e.buffer).getFloat32(0, false),\n            position: new DataView(e.buffer).getFloat32(4, false),\n            /*ohm : String.fromCharCode.apply(null,data.slice(10, 10 + data[9])).match(/[+-]?([0-9]*[.])?[0-9]+/g)?.map(Number)[0] || -1,*/\n            strain: new DataView(e.buffer).getFloat32(8, false)\n        }))\n        msg.payload = results;\n        msg.topic = \"stageResults\";\n        break;\n}\n\nreturn msg;\n\n\nfunction chunk(arr, chunkSize) {\n    return Array.from({ length: Math.ceil(arr.byteLength / chunkSize) }, (_, i) =>\n        arr.slice(i * chunkSize, i * chunkSize + chunkSize)\n    );\n}\n\nfunction float32BigE(buf) {\n    const ret = [];\n    let index = 0;\n    for (; index < buf.byteLength; index += 4) {\n        ret.push(new DataView(buf).getFloat32(index, false));\n    }\n    return ret;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 840,
        "wires": [
            [
                "1fd565c40afdd133",
                "19b4c07517d32a9c"
            ]
        ]
    },
    {
        "id": "323208cc749c6dee",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"23\",\"S7_Datatype\":\"STRING\",\"S7_Offset\":\"0\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"254\",\"S7_Name\":\"productType\"}",
        "s7Name": "productType",
        "topic": "type",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 980,
        "wires": [
            [
                "299f23630ed056a2",
                "930314226d710c42"
            ]
        ]
    },
    {
        "id": "299f23630ed056a2",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"23\",\"S7_Datatype\":\"STRING\",\"S7_Offset\":\"256\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"254\",\"S7_Name\":\"productOrder\"}",
        "s7Name": "productOrder",
        "topic": "order",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1020,
        "wires": [
            [
                "6153ee0d32e83504",
                "930314226d710c42"
            ]
        ]
    },
    {
        "id": "6153ee0d32e83504",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"23\",\"S7_Datatype\":\"B\",\"S7_Offset\":\"512\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"36\",\"S7_Name\":\"productFeatures\"}",
        "s7Name": "productFeatures",
        "topic": "features",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 340,
        "y": 1060,
        "wires": [
            [
                "1f5e0b3fc36af163",
                "930314226d710c42"
            ]
        ]
    },
    {
        "id": "1f5e0b3fc36af163",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"23\",\"S7_Datatype\":\"B\",\"S7_Offset\":\"548\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"180\",\"S7_Name\":\"productParameters\"}",
        "s7Name": "productParameters",
        "topic": "parameters",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 330,
        "y": 1100,
        "wires": [
            [
                "930314226d710c42"
            ]
        ]
    },
    {
        "id": "930314226d710c42",
        "type": "function",
        "z": "a7c7ec5294135863",
        "name": "compose_payload",
        "func": "switch (msg.topic) {\n    default:\n        break\n    case \"type\":\n        context.set(\"type\", msg.payload.value[0])\n        break\n    case \"order\":\n        context.set(\"order\", msg.payload.value[0])\n        break\n    case \"features\":\n    case \"parameters\": {\n        const data = new Uint8Array(msg.payload.value)\n        const buff = data.buffer\n\n        switch (msg.topic) {\n            case \"features\":\n                const features = {\n                    name: String.fromCharCode.apply(null, data.slice(2, 2 + data[1])),\n                    orientation: String.fromCharCode(data[12]),\n                    bushing: String.fromCharCode(data[13]),\n                    buttonForce: new DataView(buff).getFloat32(14, false),\n                    innerShaft: {\n                        detents: new DataView(buff).getUint16(18, false),\n                        resolution: new DataView(buff).getUint16(20, false),\n                        torque: new DataView(buff).getFloat32(22, false),\n                    },\n                    outerShaft: {\n                        detents: new DataView(buff).getUint16(26, false),\n                        resolution: new DataView(buff).getUint16(28, false),\n                        torque: new DataView(buff).getFloat32(30, false),\n                    },\n                    ipSealing: String.fromCharCode(data[34]),\n                    shaftType: String.fromCharCode(data[35]),\n                }\n                context.set(\"features\", features);\n                break\n            case \"parameters\":\n                const groupLim = sliceToObj(float32BigE(buff), [\"upper\", \"nominal\", \"lower\"])\n                const groupComp = sliceToObj(groupLim, [\"zPosition\", \"zVelocity\", \"displacement\", \"dVelocity\", \"strain\"])\n                const parameters = {\n                    button: groupComp[0],\n                    inner: groupComp[1],\n                    outer: groupComp[2],\n                }\n                msg.payload = {\n                    operator: global.get(\"operator\", \"file\"),\n                    type: context.get(\"type\"),\n                    order: context.get(\"order\"),\n                    features: context.get(\"features\"),\n                    parameters: parameters\n                }\n                msg.topic = \"productData\"\n                return msg\n        }\n    }\n        break\n}\nreturn\n\nfunction chunk(arr, chunkSize) {\n    return Array.from({ length: Math.ceil(arr.length / chunkSize) }, (_, i) =>\n        arr.slice(i * chunkSize, i * chunkSize + chunkSize)\n    );\n}\nfunction sliceToObj(arr, keys) {\n    const chunks = chunk(arr, keys.length)\n    const ret = []\n    chunks.forEach(function(chunk) {\n        const obj = {}\n        keys.forEach(function(key, i) {\n            obj[key] = chunk[i]\n        })\n        ret.push(obj)\n    });\n    return ret\n}\nfunction float32BigE(buf) {\n    const ret = [];\n    let index = 0;\n    for (; index < buf.byteLength; index += 4) {\n        ret.push(new DataView(buf).getFloat32(index, false));\n    }\n    return ret;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 1040,
        "wires": [
            [
                "e5a7e70048bace36"
            ]
        ]
    },
    {
        "id": "041852a8317a6337",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"8\",\"S7_Datatype\":\"uint16\",\"S7_Offset\":\"140\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"1\",\"S7_Name\":\"procStageCount\"}",
        "s7Name": "procStageCount",
        "topic": "count",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1220,
        "wires": [
            [
                "ceda95fb10e29c4b",
                "5799ce57aca708bf"
            ]
        ]
    },
    {
        "id": "ceda95fb10e29c4b",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"8\",\"S7_Datatype\":\"DI\",\"S7_Offset\":\"142\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"1\",\"S7_Name\":\"procActStage\"}",
        "s7Name": "procActStage",
        "topic": "active",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1260,
        "wires": [
            [
                "be249d604792a5b6",
                "5799ce57aca708bf"
            ]
        ]
    },
    {
        "id": "be249d604792a5b6",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"8\",\"S7_Datatype\":\"B\",\"S7_Offset\":\"0\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"140\",\"S7_Name\":\"procStages\"}",
        "s7Name": "procStages",
        "topic": "stages",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1300,
        "wires": [
            [
                "5799ce57aca708bf"
            ]
        ]
    },
    {
        "id": "5799ce57aca708bf",
        "type": "function",
        "z": "a7c7ec5294135863",
        "name": "compose_payload",
        "func": "switch (msg.topic) {\n    default:\n        break\n    case \"count\":\n        context.set(\"count\", msg.payload.value[0])\n        break\n    case \"active\":\n        context.set(\"active\", msg.payload.value[0])\n        break\n    case \"stages\": {\n        const data = new Uint8Array(msg.payload.value)\n        const chunks = chunk(data, 14)\n        const stages = chunks.map(function(e) {\n            return {\n                component : String.fromCharCode(e[[0]]),\n                measurement: String.fromCharCode(e[[1]]),\n                channel: String.fromCharCode(e[[2]]),\n                count: new DataView(e.buffer).getUint16(4, false),\n                displacement: new DataView(e.buffer).getFloat32(6, false),\n                velocity: new DataView(e.buffer).getFloat32(10, false),\n            }\n        })\n\n        msg.payload = {\n            count : context.get(\"count\"),\n            active : context.get(\"active\"),\n            stages : stages,\n        }\n        msg.topic = \"processData\"\n\n        return msg        \n    }\n}\nreturn\n\nfunction chunk(arr, chunkSize) {\n    return Array.from({ length: Math.ceil(arr.byteLength / chunkSize) }, (_, i) =>\n        arr.slice(i * chunkSize, i * chunkSize + chunkSize)\n    );\n}\n\nfunction float32BigE(buf) {\n    const ret = [];\n    let index = 0;\n    for (; index < buf.byteLength; index += 4) {\n        ret.push(new DataView(buf).getFloat32(index, false));\n    }\n    return ret;\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 1260,
        "wires": [
            [
                "d5dae291c870e27a"
            ]
        ]
    },
    {
        "id": "410e4594e6ee8790",
        "type": "switch",
        "z": "a7c7ec5294135863",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "cont",
                "v": "StartAq",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "NewEntry",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "StartStage",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "EndStage",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "GetOhm",
                "vt": "str"
            },
            {
                "t": "cont",
                "v": "GetOStage",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 6,
        "x": 470,
        "y": 440,
        "wires": [
            [
                "950164b780fa14d3"
            ],
            [
                "ab059ae988157308"
            ],
            [
                "4cf4e1b1835209e1"
            ],
            [
                "564dbb5500efbb4b"
            ],
            [
                "ffb3be6558e2f16d"
            ],
            [
                "d530debf90794e70"
            ]
        ]
    },
    {
        "id": "19b4c07517d32a9c",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "session.process.data.plc",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 840,
        "wires": [
            [
                "b202a0b79dc00822"
            ]
        ]
    },
    {
        "id": "e5a7e70048bace36",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "session.product",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 870,
        "y": 1040,
        "wires": [
            [
                "4667f931d82fbdd7"
            ]
        ]
    },
    {
        "id": "d5dae291c870e27a",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "session.process.stages",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 900,
        "y": 1260,
        "wires": [
            [
                "58926eb4cedd25af"
            ]
        ]
    },
    {
        "id": "212a440de77be06b",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"8\",\"S7_Datatype\":\"DI\",\"S7_Offset\":\"142\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"1\",\"S7_Name\":\"procActStage\"}",
        "s7Name": "procActStage",
        "topic": "active",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1360,
        "wires": [
            [
                "6228b658b42953d5"
            ]
        ]
    },
    {
        "id": "6228b658b42953d5",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "session.process.stages.active",
                "pt": "global",
                "to": "payload.value[0]",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 880,
        "y": 1360,
        "wires": [
            [
                "7b31415877960626"
            ]
        ]
    },
    {
        "id": "ab059ae988157308",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outNewEntry",
        "mode": "link",
        "links": [
            "02b930634876cbec",
            "4c1963f1e5c6c86e",
            "c581333be03e682b"
        ],
        "x": 575,
        "y": 400,
        "wires": []
    },
    {
        "id": "564dbb5500efbb4b",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outEndStage",
        "mode": "link",
        "links": [
            "5d84924b741dd305"
        ],
        "x": 575,
        "y": 480,
        "wires": []
    },
    {
        "id": "4cf4e1b1835209e1",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outStartStage",
        "mode": "link",
        "links": [
            "98102428a5c55a49",
            "defa32b61e14e01a"
        ],
        "x": 575,
        "y": 440,
        "wires": []
    },
    {
        "id": "5d84924b741dd305",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inEndStage",
        "links": [
            "564dbb5500efbb4b"
        ],
        "x": 265,
        "y": 820,
        "wires": [
            [
                "6aa20c06f449d656"
            ]
        ]
    },
    {
        "id": "c581333be03e682b",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inNewEntry",
        "links": [
            "ab059ae988157308"
        ],
        "x": 265,
        "y": 980,
        "wires": [
            [
                "323208cc749c6dee"
            ]
        ]
    },
    {
        "id": "4c1963f1e5c6c86e",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inNewEntry",
        "links": [
            "ab059ae988157308"
        ],
        "x": 265,
        "y": 1220,
        "wires": [
            [
                "041852a8317a6337"
            ]
        ]
    },
    {
        "id": "98102428a5c55a49",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inStartStage",
        "links": [
            "4cf4e1b1835209e1"
        ],
        "x": 245,
        "y": 1360,
        "wires": [
            [
                "212a440de77be06b"
            ]
        ]
    },
    {
        "id": "b202a0b79dc00822",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outDataAck",
        "mode": "link",
        "links": [
            "bb8ee15e0a80636c",
            "5e0e7b6c807841c7"
        ],
        "x": 1095,
        "y": 840,
        "wires": []
    },
    {
        "id": "4667f931d82fbdd7",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outProductAck",
        "mode": "link",
        "links": [
            "6afdfaf5619f77bb",
            "3d64c50fa540eed8"
        ],
        "x": 1105,
        "y": 1040,
        "wires": []
    },
    {
        "id": "58926eb4cedd25af",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outProcessAck",
        "mode": "link",
        "links": [
            "3d64c50fa540eed8",
            "e672d7208e27a12e"
        ],
        "x": 1105,
        "y": 1260,
        "wires": []
    },
    {
        "id": "7b31415877960626",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outStageAck",
        "mode": "link",
        "links": [
            "e672d7208e27a12e",
            "3d64c50fa540eed8"
        ],
        "x": 1105,
        "y": 1360,
        "wires": []
    },
    {
        "id": "9138b328fa99483f",
        "type": "inject",
        "z": "a7c7ec5294135863",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 980,
        "wires": [
            [
                "323208cc749c6dee"
            ]
        ]
    },
    {
        "id": "cec9d9d2c6908aa1",
        "type": "inject",
        "z": "a7c7ec5294135863",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 820,
        "wires": [
            [
                "6aa20c06f449d656",
                "1fd565c40afdd133"
            ]
        ]
    },
    {
        "id": "b7ea094851563b07",
        "type": "inject",
        "z": "a7c7ec5294135863",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 160,
        "y": 1220,
        "wires": [
            [
                "041852a8317a6337"
            ]
        ]
    },
    {
        "id": "fafaf048b7ad9483",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"15\",\"S7_Datatype\":\"DI\",\"S7_Offset\":\"13202\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"1\",\"S7_Name\":\"ohmStage\"}",
        "s7Name": "ohmStage",
        "topic": "stage",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1480,
        "wires": [
            [
                "30424adcd5cd3a94"
            ]
        ]
    },
    {
        "id": "d3d65a0a1041c0ef",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"15\",\"S7_Datatype\":\"uint16\",\"S7_Offset\":\"13200\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"1\",\"S7_Name\":\"ohmCount\"}",
        "s7Name": "ohmCount",
        "topic": "count",
        "name": "",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1520,
        "wires": [
            [
                "30424adcd5cd3a94",
                "f5c8a19a8ca02d91"
            ]
        ]
    },
    {
        "id": "f5c8a19a8ca02d91",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"15\",\"S7_Datatype\":\"B\",\"S7_Offset\":\"0\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"6600\",\"S7_Name\":\"ohmData_0\"}",
        "s7Name": "ohmData_0",
        "topic": "data_0",
        "name": "data 0",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1560,
        "wires": [
            [
                "30424adcd5cd3a94",
                "7dabc1f50b1cc91b"
            ]
        ]
    },
    {
        "id": "30424adcd5cd3a94",
        "type": "function",
        "z": "a7c7ec5294135863",
        "name": "compose_payload",
        "func": "switch (msg.topic) {\n    default:\n        break\n    case \"stage\":\n        context.set(\"stage\", msg.payload.value[0])\n        break\n    case \"count\":\n        context.set(\"count\", msg.payload.value[0])\n        break\n    case \"data_0\":\n        context.set(\"data_0\", msg.payload.value)\n        break\n    case \"data_1\": {\n        const cnt = context.get(\"count\")\n        const data = new Uint8Array(context.get(\"data_0\").concat(msg.payload.value))\n        const lines = chunk(data, 66).slice(0,cnt).map((v) => { return String.fromCharCode(...v.slice(2, 2 + v[1])).trim()  })\n\n        msg.payload = lines\n        msg.stage = context.get(\"stage\")\n        msg.topic = \"ohmmeterData\"\n        return msg\n    }\n}\n\nreturn\n\n\nfunction chunk(arr, chunkSize) {\n    return Array.from({ length: Math.ceil(arr.length / chunkSize) }, (_, i) =>\n        arr.slice(i * chunkSize, i * chunkSize + chunkSize)\n    );\n}\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 590,
        "y": 1520,
        "wires": [
            [
                "d4aa2d206d5fdf83"
            ]
        ]
    },
    {
        "id": "4a7915c4254053f8",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "d": true,
        "name": "inOhmData",
        "links": [
            "ffb3be6558e2f16d"
        ],
        "x": 245,
        "y": 1520,
        "wires": [
            [
                "d3d65a0a1041c0ef"
            ]
        ]
    },
    {
        "id": "3ad932dcc7d70e79",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outOhmAck",
        "mode": "link",
        "links": [
            "2cea2d573347c0a3"
        ],
        "x": 1155,
        "y": 1520,
        "wires": []
    },
    {
        "id": "eded3cd0d41981ae",
        "type": "inject",
        "z": "a7c7ec5294135863",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 1460,
        "wires": [
            [
                "fafaf048b7ad9483",
                "d3d65a0a1041c0ef"
            ]
        ]
    },
    {
        "id": "1395b3dea3c0f393",
        "type": "comment",
        "z": "a7c7ec5294135863",
        "name": "Ohmmeter data",
        "info": "",
        "x": 320,
        "y": 1440,
        "wires": []
    },
    {
        "id": "0979857144d46bf9",
        "type": "comment",
        "z": "a7c7ec5294135863",
        "name": "Process stages",
        "info": "",
        "x": 320,
        "y": 1180,
        "wires": []
    },
    {
        "id": "5497a34add3617c2",
        "type": "comment",
        "z": "a7c7ec5294135863",
        "name": "Product data",
        "info": "",
        "x": 330,
        "y": 940,
        "wires": []
    },
    {
        "id": "1b0dab8b2d8b6f99",
        "type": "comment",
        "z": "a7c7ec5294135863",
        "name": "Plc result data",
        "info": "",
        "x": 330,
        "y": 780,
        "wires": []
    },
    {
        "id": "aa2c588a863a4056",
        "type": "csv",
        "z": "a7c7ec5294135863",
        "name": "",
        "spec": "rfc",
        "sep": ",",
        "hdrin": "",
        "hdrout": "none",
        "multi": "mult",
        "ret": "\\r\\n",
        "temp": "date,time,dt,status,value",
        "skip": "0",
        "strings": true,
        "include_empty_strings": "",
        "include_null_values": "",
        "x": 870,
        "y": 1520,
        "wires": [
            [
                "4ab11d69c5f5a642"
            ]
        ]
    },
    {
        "id": "4ab11d69c5f5a642",
        "type": "function",
        "z": "a7c7ec5294135863",
        "name": "extract_ohms",
        "func": "msg.payload.reduce((acc, v) => {acc += (v.dt + 1) / 1000; v.timeStamp = acc; return acc},0.049)\nmsg.payload.forEach(function(e) {\n    [e.ohm, e.unit] = e.value.match(/([+-]?([0-9]*[.])?[0-9]+)|(\\w+)/g);\n    e.ohm = clamp(Number(e.ohm) * (e.unit === \"mOhm\" ? 1E-3 : 1),-1,100);\n});\n\nreturn msg;\n\nfunction clamp(val, min, max) {\n    return val > max ? max : val < min ? min : val;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1020,
        "y": 1520,
        "wires": [
            [
                "3ad932dcc7d70e79"
            ]
        ]
    },
    {
        "id": "d4aa2d206d5fdf83",
        "type": "split",
        "z": "a7c7ec5294135863",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "property": "payload",
        "x": 750,
        "y": 1520,
        "wires": [
            [
                "aa2c588a863a4056"
            ]
        ]
    },
    {
        "id": "7dabc1f50b1cc91b",
        "type": "s7comm read",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"15\",\"S7_Datatype\":\"B\",\"S7_Offset\":\"6600\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"6600\",\"S7_Name\":\"ohmData_1\"}",
        "s7Name": "ohmData_1",
        "topic": "data_1",
        "name": "data 1",
        "signalSetted": false,
        "none": "true",
        "repeat": "",
        "once": false,
        "x": 350,
        "y": 1600,
        "wires": [
            [
                "30424adcd5cd3a94"
            ]
        ]
    },
    {
        "id": "ffb3be6558e2f16d",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outGetOhm",
        "mode": "link",
        "links": [
            "4a7915c4254053f8"
        ],
        "x": 575,
        "y": 520,
        "wires": []
    },
    {
        "id": "4c147073df63d385",
        "type": "debug",
        "z": "a7c7ec5294135863",
        "name": "debug 4",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1240,
        "y": 320,
        "wires": []
    },
    {
        "id": "d530debf90794e70",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outGetOhmStage",
        "mode": "link",
        "links": [
            "0fce602cf14e4c1d"
        ],
        "x": 575,
        "y": 560,
        "wires": []
    },
    {
        "id": "0fce602cf14e4c1d",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "d": true,
        "name": "inOhmStage",
        "links": [
            "d530debf90794e70"
        ],
        "x": 245,
        "y": 1480,
        "wires": [
            [
                "fafaf048b7ad9483"
            ]
        ]
    },
    {
        "id": "950164b780fa14d3",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "outStartAq",
        "mode": "link",
        "links": [
            "03e7101a0147b8c0"
        ],
        "x": 575,
        "y": 360,
        "wires": []
    },
    {
        "id": "e664c3d33c87e427",
        "type": "file in",
        "z": "a7c7ec5294135863",
        "name": "",
        "filename": "/appcache/ps2000/result_file.json",
        "filenameType": "str",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1120,
        "y": 620,
        "wires": [
            [
                "50591a9bfab375b0",
                "f025faa8bcc5189d"
            ]
        ]
    },
    {
        "id": "f025faa8bcc5189d",
        "type": "debug",
        "z": "a7c7ec5294135863",
        "name": "debug 2",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1440,
        "y": 440,
        "wires": []
    },
    {
        "id": "a70ee8adec49fb6b",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inSetOrder",
        "links": [],
        "x": 295,
        "y": 1720,
        "wires": [
            [
                "aec5286ae04bc13c"
            ]
        ]
    },
    {
        "id": "7286cce46d6251d8",
        "type": "s7comm write",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"23\",\"S7_Datatype\":\"STRING\",\"S7_Offset\":\"256\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"254\",\"S7_Name\":\"productOrder\"}",
        "s7Name": "productOrder",
        "topic": "set_order",
        "name": "",
        "signalSetted": false,
        "x": 680,
        "y": 1720,
        "wires": [
            [
                "aec5286ae04bc13c"
            ]
        ]
    },
    {
        "id": "aec5286ae04bc13c",
        "type": "function",
        "z": "a7c7ec5294135863",
        "name": "compose_payload",
        "func": "switch(msg.topic) {\n    case \"set_order\":\n        return [context.get(\"msg_ret\"),null];\n    case \"order\":\n        context.set(\"msg_ret\", msg);\n        const value = [msg.payload];\n        return [null, { payload: { \"value\": value }}];\n}\n\nreturn;",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1720,
        "wires": [
            [
                "297cd64b2ced6fde"
            ],
            [
                "7286cce46d6251d8"
            ]
        ]
    },
    {
        "id": "1fd565c40afdd133",
        "type": "debug",
        "z": "a7c7ec5294135863",
        "name": "debug 8",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 960,
        "y": 920,
        "wires": []
    },
    {
        "id": "297cd64b2ced6fde",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "retSetOrder",
        "mode": "return",
        "links": [],
        "x": 555,
        "y": 1700,
        "wires": []
    },
    {
        "id": "4b73052aac644e5f",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inSetProduct",
        "links": [],
        "x": 295,
        "y": 1860,
        "wires": [
            [
                "7caa4f63ceed4814"
            ]
        ]
    },
    {
        "id": "6810321db0f2bac0",
        "type": "s7comm write",
        "z": "a7c7ec5294135863",
        "connection": "3cb7f915b2dc54d4",
        "payload": "{\"S7_Type\":\"DB\",\"S7_DBnum\":\"23\",\"S7_Datatype\":\"STRING\",\"S7_Offset\":\"0\",\"S7_BitOffset\":\"0\",\"S7_Quantity\":\"254\",\"S7_Name\":\"productType\"}",
        "s7Name": "productType",
        "topic": "set_product",
        "name": "",
        "signalSetted": false,
        "x": 670,
        "y": 1860,
        "wires": [
            [
                "7caa4f63ceed4814"
            ]
        ]
    },
    {
        "id": "7caa4f63ceed4814",
        "type": "function",
        "z": "a7c7ec5294135863",
        "name": "compose_payload",
        "func": "switch(msg.topic) {\n    case \"set_product\":\n        return [context.get(\"msg_ret\"),null];\n    case \"product\":\n        context.set(\"msg_ret\", msg);\n        const value = [msg.payload];\n        return [null, { payload: { \"value\": value }}];\n}\n\nreturn;",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 1860,
        "wires": [
            [
                "bd8a8b474ab9f6fa"
            ],
            [
                "6810321db0f2bac0"
            ]
        ]
    },
    {
        "id": "bd8a8b474ab9f6fa",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 555,
        "y": 1840,
        "wires": []
    },
    {
        "id": "3fe6cbb983baf291",
        "type": "delay",
        "z": "a7c7ec5294135863",
        "name": "",
        "pauseType": "delay",
        "timeout": "0.5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 870,
        "y": 640,
        "wires": [
            [
                "e664c3d33c87e427"
            ]
        ]
    },
    {
        "id": "05639a7b3ca71415",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "recall_session",
        "rules": [
            {
                "t": "set",
                "p": "_session",
                "pt": "msg",
                "to": "session",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1240,
        "y": 260,
        "wires": [
            [
                "081f4f5260792cc4"
            ]
        ]
    },
    {
        "id": "5e0e7b6c807841c7",
        "type": "link in",
        "z": "a7c7ec5294135863",
        "name": "inStarted",
        "links": [
            "b202a0b79dc00822"
        ],
        "x": 915,
        "y": 260,
        "wires": [
            [
                "e6ac04902e440a72"
            ]
        ]
    },
    {
        "id": "0ad8baea941ce172",
        "type": "link out",
        "z": "a7c7ec5294135863",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "6739d8b2b161e960"
        ],
        "x": 765,
        "y": 600,
        "wires": []
    },
    {
        "id": "e6ac04902e440a72",
        "type": "change",
        "z": "a7c7ec5294135863",
        "name": "send Read",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[\"BROKER\",\"Read\"]",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1030,
        "y": 260,
        "wires": [
            [
                "05639a7b3ca71415"
            ]
        ]
    },
    {
        "id": "6ad9f8fe51b00404",
        "type": "tcp request",
        "z": "8e125f4bb2233c4b",
        "name": "Keysight",
        "server": "192.168.100.40",
        "port": "5025",
        "out": "sit",
        "ret": "string",
        "splitc": " ",
        "newline": "\\n",
        "trim": false,
        "tls": "",
        "x": 940,
        "y": 320,
        "wires": [
            [
                "abec206283b51702",
                "24a657f02e0623cc",
                "7b40623be5dab74c"
            ]
        ]
    },
    {
        "id": "adb835c4488c62eb",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "*IDN?",
        "payloadType": "str",
        "x": 230,
        "y": 500,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "24a657f02e0623cc",
        "type": "debug",
        "z": "8e125f4bb2233c4b",
        "name": "debug 15",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1160,
        "y": 240,
        "wires": []
    },
    {
        "id": "86a1addd6b05c7e9",
        "type": "template",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "{{payload}}\n",
        "output": "str",
        "x": 800,
        "y": 320,
        "wires": [
            [
                "6ad9f8fe51b00404"
            ]
        ]
    },
    {
        "id": "d947e0c281f411dd",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": ":SYSTem:ERRor?",
        "payloadType": "str",
        "x": 190,
        "y": 540,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "83dcbc8192bf3261",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "*CLS",
        "payloadType": "str",
        "x": 230,
        "y": 820,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "6b62d88b4706e5be",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "CONF:FRES 100",
        "payloadType": "str",
        "x": 200,
        "y": 980,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "6aeb43fc4cd6fb6c",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "FRES:NPLC 1",
        "payloadType": "str",
        "x": 210,
        "y": 1060,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "f7b9f028ec8aed34",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "READ?",
        "payloadType": "str",
        "x": 230,
        "y": 900,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "ea90242de8dbef58",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "TRIG:SOUR BUS",
        "payloadType": "str",
        "x": 200,
        "y": 1100,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "d83c4d5db58e98ad",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SAMP:COUN 1200",
        "payloadType": "str",
        "x": 190,
        "y": 1140,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "3a148075fd2436df",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "*TST?",
        "payloadType": "str",
        "x": 230,
        "y": 620,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "d9aa90f9bd29e14f",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "fetch",
        "payload": "FETCh?",
        "payloadType": "str",
        "x": 210,
        "y": 860,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "0c58c5f02bf7d2af",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "CONFigure?",
        "payloadType": "str",
        "x": 210,
        "y": 580,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "c03c1614d4921b3b",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "SAMPle:COUNt?",
        "payloadType": "str",
        "x": 200,
        "y": 660,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "e075e32166223285",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "STATus:OPERation:CONDition?",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "STATus:OPERation:CONDition?",
        "payloadType": "str",
        "x": 150,
        "y": 700,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "3176655e92150d8c",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "init",
        "payload": "INIT",
        "payloadType": "str",
        "x": 730,
        "y": 640,
        "wires": [
            [
                "890dc1b7a0db9559"
            ]
        ]
    },
    {
        "id": "92df400a1176b6af",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "*TRG",
        "payloadType": "str",
        "x": 530,
        "y": 480,
        "wires": [
            [
                "785430a804dd544e",
                "ad5a45dc6ce146cb"
            ]
        ]
    },
    {
        "id": "90568d68bc030060",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "LRN",
        "payload": "*LRN?",
        "payloadType": "str",
        "x": 210,
        "y": 780,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "6daa16e5c62b79d9",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "*RST",
        "payloadType": "str",
        "x": 230,
        "y": 740,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "1c15eb510a416636",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "TRIG:DEL?",
        "payloadType": "str",
        "x": 210,
        "y": 1200,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "1b373c1844c34251",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "TRIG:DEL 0",
        "payloadType": "str",
        "x": 210,
        "y": 1240,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "4e92870b1ed7616c",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "FRES:NPLC?",
        "payloadType": "str",
        "x": 210,
        "y": 940,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "ec8296a33de11b6a",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "ABORt",
        "payloadType": "str",
        "x": 230,
        "y": 460,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "87edb2a16a31e5f8",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "FRES:NPLC 0.2",
        "payloadType": "str",
        "x": 200,
        "y": 1020,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "a75bd5fa7922a1d2",
        "type": "function",
        "z": "8e125f4bb2233c4b",
        "name": "setup",
        "func": "const cmds = [\n    \":CONFigure:FRESistance 100\",\n    \":SENSe:FRESistance:NPLCycles 0.02\",\n    \"RESolution .1\",\n    \"NULL:VAL:AUTO 0\",\n    \":TRIGger:SOURce BUS\",\n    \"DELay 0\",\n    \"COUNt 1\",\n    \":SAMPle:COUNt 1000\"\n]\n\nmsg.payload = cmds.join(\";\")\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 900,
        "wires": [
            [
                "45fd1b302d36c817"
            ]
        ]
    },
    {
        "id": "c7b90ce0eecd772a",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "setup",
        "x": 690,
        "y": 940,
        "wires": [
            [
                "a75bd5fa7922a1d2"
            ]
        ]
    },
    {
        "id": "abec206283b51702",
        "type": "function",
        "z": "8e125f4bb2233c4b",
        "name": "split",
        "func": "switch (msg.topic) {\n    case \"init\":\n        context.set(\"data\", []);\n        break;\n    case \"fetch\":\n        const data = context.get(\"data\");\n        const str = msg.payload.replace(/#[0-9]*/,\"\")\n        data.push(...str.split(\",\"))\n        msg.values = data\n        break;\n    case \"chart\":\n        msg.payload = context.get(\"data\").map((v, i) => ({\"ohm\" : v, \"timeStamp\": i*0.001}));\n    default:\n        \n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 220,
        "wires": [
            [
                "24a657f02e0623cc",
                "50569988e31e1b6a"
            ]
        ]
    },
    {
        "id": "0ff0a96ffa07d3cb",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "DATA:POINTs?",
        "payloadType": "str",
        "x": 200,
        "y": 380,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "1f3ecaa6b12f660c",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "fetch",
        "payload": "R? 100",
        "payloadType": "str",
        "x": 210,
        "y": 420,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "c787154f93759d44",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "chart",
        "x": 710,
        "y": 80,
        "wires": [
            [
                "abec206283b51702"
            ]
        ]
    },
    {
        "id": "50569988e31e1b6a",
        "type": "switch",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "chart",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1130,
        "y": 100,
        "wires": [
            [
                "40fc1add38bf0fa4"
            ]
        ]
    },
    {
        "id": "44b2773015a17528",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "FRES:NULL:VAL:AUTO?",
        "payloadType": "str",
        "x": 170,
        "y": 1300,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "05111daf31d8a4fd",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "DATA:POINTs?",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "DATA:POINTs?",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "count",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 440,
        "y": 140,
        "wires": [
            [
                "05d2c12d7ed830ac"
            ]
        ]
    },
    {
        "id": "4af2a7f9baa40c9e",
        "type": "switch",
        "z": "8e125f4bb2233c4b",
        "name": "more than 0",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gt",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 310,
        "y": 200,
        "wires": [
            [
                "060c872521cea92a"
            ],
            [
                "5ad6ca969d214195"
            ]
        ]
    },
    {
        "id": "060c872521cea92a",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "R? 100",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "R? 200",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "fetch",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 460,
        "y": 180,
        "wires": [
            [
                "05d2c12d7ed830ac"
            ]
        ]
    },
    {
        "id": "db15cdbf95aa3802",
        "type": "switch",
        "z": "8e125f4bb2233c4b",
        "name": "switch topic",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "fetch",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "count",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 150,
        "y": 160,
        "wires": [
            [
                "05111daf31d8a4fd"
            ],
            [
                "4af2a7f9baa40c9e"
            ]
        ],
        "outputLabels": [
            "fetch",
            "count"
        ]
    },
    {
        "id": "5949405f717e37f5",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "start fetch",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 240,
        "y": 80,
        "wires": [
            [
                "05111daf31d8a4fd"
            ]
        ]
    },
    {
        "id": "35e2f1f20d7f4b16",
        "type": "file",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "filename": "/appcache/dump",
        "filenameType": "str",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 450,
        "y": 60,
        "wires": [
            []
        ]
    },
    {
        "id": "ec1e9ae789a59ae2",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "init",
        "x": 710,
        "y": 120,
        "wires": [
            [
                "abec206283b51702"
            ]
        ]
    },
    {
        "id": "f06b5de3bd310dc5",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "CONF:VOLT:DC 10,0.001",
        "payloadType": "str",
        "x": 170,
        "y": 1340,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "785430a804dd544e",
        "type": "delay",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "pauseType": "delay",
        "timeout": "1.6",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 690,
        "y": 540,
        "wires": [
            [
                "58e607e25cf09126"
            ]
        ]
    },
    {
        "id": "5ad6ca969d214195",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "chart:",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "chart",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 450,
        "y": 220,
        "wires": [
            [
                "abec206283b51702"
            ]
        ]
    },
    {
        "id": "25671ed83c8ee80d",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "init:INIT",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "INIT",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "init",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 760,
        "wires": [
            [
                "890dc1b7a0db9559"
            ]
        ]
    },
    {
        "id": "f81d7b5de52842aa",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "*TRG",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "*TRG",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 520,
        "wires": [
            [
                "785430a804dd544e",
                "ad5a45dc6ce146cb"
            ]
        ]
    },
    {
        "id": "defa32b61e14e01a",
        "type": "link in",
        "z": "8e125f4bb2233c4b",
        "name": "inKeysightInit",
        "links": [
            "4cf4e1b1835209e1"
        ],
        "x": 585,
        "y": 680,
        "wires": [
            [
                "10c55f778fc6720c",
                "b4557b6f0e617ce5"
            ]
        ]
    },
    {
        "id": "9b92d07c68abaa58",
        "type": "link in",
        "z": "8e125f4bb2233c4b",
        "name": "inKeysightTrigger",
        "links": [
            "46a3c3149898b41f"
        ],
        "x": 445,
        "y": 520,
        "wires": [
            [
                "f81d7b5de52842aa"
            ]
        ]
    },
    {
        "id": "40fc1add38bf0fa4",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outOhm",
        "mode": "link",
        "links": [
            "2cea2d573347c0a3"
        ],
        "x": 1245,
        "y": 100,
        "wires": []
    },
    {
        "id": "02b930634876cbec",
        "type": "link in",
        "z": "8e125f4bb2233c4b",
        "name": "inKeysighSetup",
        "links": [
            "ab059ae988157308"
        ],
        "x": 595,
        "y": 840,
        "wires": [
            [
                "6b4a0ed209498954",
                "01a9c5903635a158"
            ]
        ]
    },
    {
        "id": "6c10d414560d57f2",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "setup:",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "setup",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 690,
        "y": 900,
        "wires": [
            [
                "a75bd5fa7922a1d2"
            ]
        ]
    },
    {
        "id": "a6745eff0df89cde",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "STATus:OPERation?",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "STATus:OPERation:CONDition?",
        "payloadType": "str",
        "x": 190,
        "y": 340,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "58e607e25cf09126",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outStartFetch",
        "mode": "link",
        "links": [
            "72b6232cb60ad0bb"
        ],
        "x": 795,
        "y": 540,
        "wires": []
    },
    {
        "id": "72b6232cb60ad0bb",
        "type": "link in",
        "z": "8e125f4bb2233c4b",
        "name": "inStartFetch",
        "links": [
            "58e607e25cf09126"
        ],
        "x": 295,
        "y": 120,
        "wires": [
            [
                "05111daf31d8a4fd"
            ]
        ]
    },
    {
        "id": "10c55f778fc6720c",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "init:ABORt",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "ABORt",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "init",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 680,
        "wires": [
            [
                "890dc1b7a0db9559"
            ]
        ]
    },
    {
        "id": "837f688704689569",
        "type": "link in",
        "z": "8e125f4bb2233c4b",
        "name": "inKeysight",
        "links": [
            "45fd1b302d36c817",
            "890dc1b7a0db9559",
            "05d2c12d7ed830ac",
            "2f158accf0bf7681",
            "ad5a45dc6ce146cb"
        ],
        "x": 705,
        "y": 320,
        "wires": [
            [
                "86a1addd6b05c7e9"
            ]
        ]
    },
    {
        "id": "7b40623be5dab74c",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outKeysight",
        "mode": "link",
        "links": [
            "5a940fdf001f040a"
        ],
        "x": 1095,
        "y": 320,
        "wires": []
    },
    {
        "id": "45fd1b302d36c817",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outCmdKeysight",
        "mode": "link",
        "links": [
            "837f688704689569"
        ],
        "x": 855,
        "y": 860,
        "wires": []
    },
    {
        "id": "890dc1b7a0db9559",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outInitKeysight",
        "mode": "link",
        "links": [
            "837f688704689569",
            "e35a81558c3c216d"
        ],
        "x": 855,
        "y": 700,
        "wires": []
    },
    {
        "id": "e35a81558c3c216d",
        "type": "link in",
        "z": "8e125f4bb2233c4b",
        "name": "inKeyDataFunc",
        "links": [
            "890dc1b7a0db9559"
        ],
        "x": 895,
        "y": 140,
        "wires": [
            [
                "abec206283b51702"
            ]
        ]
    },
    {
        "id": "5a940fdf001f040a",
        "type": "link in",
        "z": "8e125f4bb2233c4b",
        "name": "inKeysightData",
        "links": [
            "7b40623be5dab74c"
        ],
        "x": 105,
        "y": 120,
        "wires": [
            [
                "db15cdbf95aa3802"
            ]
        ]
    },
    {
        "id": "05d2c12d7ed830ac",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outCmdKeysight",
        "mode": "link",
        "links": [
            "837f688704689569"
        ],
        "x": 555,
        "y": 160,
        "wires": []
    },
    {
        "id": "2f158accf0bf7681",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outCmdKeysight",
        "mode": "link",
        "links": [
            "837f688704689569"
        ],
        "x": 355,
        "y": 340,
        "wires": []
    },
    {
        "id": "ad5a45dc6ce146cb",
        "type": "link out",
        "z": "8e125f4bb2233c4b",
        "name": "outCmdKeysight",
        "mode": "link",
        "links": [
            "837f688704689569"
        ],
        "x": 685,
        "y": 480,
        "wires": []
    },
    {
        "id": "b4557b6f0e617ce5",
        "type": "delay",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 710,
        "y": 720,
        "wires": [
            [
                "25671ed83c8ee80d"
            ]
        ]
    },
    {
        "id": "ed75205fea3a735e",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 500,
        "y": 740,
        "wires": [
            [
                "10c55f778fc6720c",
                "b4557b6f0e617ce5"
            ]
        ]
    },
    {
        "id": "6b4a0ed209498954",
        "type": "change",
        "z": "8e125f4bb2233c4b",
        "name": "setup:ABORt",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "ABORt",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "setup",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 820,
        "wires": [
            [
                "45fd1b302d36c817"
            ]
        ]
    },
    {
        "id": "01a9c5903635a158",
        "type": "delay",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "pauseType": "delay",
        "timeout": "20",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 710,
        "y": 860,
        "wires": [
            [
                "6c10d414560d57f2"
            ]
        ]
    },
    {
        "id": "d9f95b42cdaeb025",
        "type": "inject",
        "z": "8e125f4bb2233c4b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "TRIG:SOUR MAN",
        "payloadType": "str",
        "x": 430,
        "y": 1100,
        "wires": [
            [
                "2f158accf0bf7681"
            ]
        ]
    },
    {
        "id": "745dac0558d14053",
        "type": "link in",
        "z": "c4157bddbbb8817a",
        "name": "logik in",
        "links": [
            "50591a9bfab375b0"
        ],
        "x": 205,
        "y": 660,
        "wires": [
            [
                "969366744754724e"
            ]
        ]
    },
    {
        "id": "53611f05496fa6df",
        "type": "json",
        "z": "c4157bddbbb8817a",
        "name": "",
        "property": "payload",
        "action": "str",
        "pretty": true,
        "x": 1150,
        "y": 420,
        "wires": [
            [
                "364fe0205ba99901"
            ]
        ]
    },
    {
        "id": "473f610c8720497b",
        "type": "function",
        "z": "c4157bddbbb8817a",
        "name": "format_data",
        "func": "const every_nth = (arr, nth) => arr.filter((e, i) => i % nth === nth - 1);\n\nconst data = ['stage_results', flow.get('stage', 'file'), msg.payload.setup, msg.payload.results]\n\nconst sig = msg.payload.signals\nconst graph = sig.x.map((v, i) => ({timestamp: v, a: sig.a_y[i], b: sig.b_y[i]})).filter((e, i) => i % 1000 === 1000 - 1)\n\ndata[3].signal = graph\n\nmsg.data = data\nreturn [msg, {payload: graph}];\n",
        "outputs": 2,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 700,
        "wires": [
            [
                "7871ad14a913e153"
            ],
            []
        ]
    },
    {
        "id": "364fe0205ba99901",
        "type": "link out",
        "z": "c4157bddbbb8817a",
        "name": "to extension out",
        "mode": "link",
        "links": [
            "5aa597c1af9984f8"
        ],
        "x": 1245,
        "y": 420,
        "wires": []
    },
    {
        "id": "869b2be746ba232b",
        "type": "json",
        "z": "c4157bddbbb8817a",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 510,
        "y": 660,
        "wires": [
            [
                "473f610c8720497b"
            ]
        ]
    },
    {
        "id": "969366744754724e",
        "type": "change",
        "z": "c4157bddbbb8817a",
        "name": "",
        "rules": [
            {
                "t": "change",
                "p": "payload",
                "pt": "msg",
                "from": "NaN",
                "fromt": "str",
                "to": "null",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 340,
        "y": 660,
        "wires": [
            [
                "869b2be746ba232b"
            ]
        ]
    },
    {
        "id": "a58fc1681de37f39",
        "type": "change",
        "z": "c4157bddbbb8817a",
        "name": "insertOne",
        "rules": [
            {
                "t": "set",
                "p": "operation",
                "pt": "msg",
                "to": "insertOne",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[$globalContext(\"session.product\")]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "payload[0].timestamp",
                "pt": "msg",
                "to": "iso",
                "tot": "date"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 780,
        "y": 480,
        "wires": [
            [
                "43ee3d72e8e6ab80"
            ]
        ]
    },
    {
        "id": "43ee3d72e8e6ab80",
        "type": "link call",
        "z": "c4157bddbbb8817a",
        "name": "call_database",
        "links": [
            "09d2343f773e9140"
        ],
        "linkType": "static",
        "timeout": "10",
        "x": 1140,
        "y": 500,
        "wires": [
            [
                "0921376389a5713e",
                "03e2ac170e048ae8"
            ]
        ]
    },
    {
        "id": "2241bdeb4b5e79e8",
        "type": "change",
        "z": "c4157bddbbb8817a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(file)::currentId",
                "pt": "flow",
                "to": "payload.insertedId",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1550,
        "y": 480,
        "wires": [
            []
        ]
    },
    {
        "id": "0921376389a5713e",
        "type": "switch",
        "z": "c4157bddbbb8817a",
        "name": "",
        "property": "payload.insertedId",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1390,
        "y": 480,
        "wires": [
            [
                "2241bdeb4b5e79e8"
            ]
        ]
    },
    {
        "id": "6afdfaf5619f77bb",
        "type": "link in",
        "z": "c4157bddbbb8817a",
        "name": "inProductEntry",
        "links": [
            "4667f931d82fbdd7"
        ],
        "x": 635,
        "y": 480,
        "wires": [
            [
                "a58fc1681de37f39"
            ]
        ]
    },
    {
        "id": "2ffe4bcbb54e1f72",
        "type": "function",
        "z": "c4157bddbbb8817a",
        "name": "update_flow_data",
        "func": "const stageIndex = global.get(\"session.process.stages.active\");\nconst stage = global.get(`session.process.stages.stages[${stageIndex}]`);\nconst product = global.get(\"session.product\");\n\nflow.set(\"actStage\", stage);\nflow.set(\"stageIndex\", stageIndex)\nflow.set(\"product\", product);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 770,
        "y": 420,
        "wires": [
            [
                "6e26f7ce11cd04a4",
                "382754232d5b53fe"
            ]
        ]
    },
    {
        "id": "e672d7208e27a12e",
        "type": "link in",
        "z": "c4157bddbbb8817a",
        "name": "inStageUpdate",
        "links": [
            "58926eb4cedd25af",
            "7b31415877960626"
        ],
        "x": 545,
        "y": 320,
        "wires": [
            [
                "2ffe4bcbb54e1f72"
            ]
        ]
    },
    {
        "id": "6e26f7ce11cd04a4",
        "type": "function",
        "z": "c4157bddbbb8817a",
        "name": "start_aquisition",
        "func": "const stage = flow.get(\"actStage\");\nconst product = flow.get(\"product\");\nconst [a,b,[c,d,[recPulses]]] = json_or_null(msg.received) || [null, null, [null, null, [null]]]\nconst pulses = stage?.component === \"B\" ? stage?.count : stage?.component === \"I\" ? product.features.innerShaft.resolution : product.features.outerShaft.resolution\n\n\nif (stage.measurement === \"S\" || msg.payload === \"StartAq\") {\n    flow.set(\"aqStage\", flow.get(\"stageIndex\"))\n    msg.payload = [\"\", \"StartAq\", pulses || recPulses]\n    return msg;\n} \n\nreturn\n\nfunction json_or_null(json_string)\n{\n    let json_object = null;\n    \n    try\n    {\n        json_object = JSON.parse(json_string);\n    }\n    \n    catch (e)\n    {\n        return null;\n    }\n    \n    return json_object;\n}\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1000,
        "y": 420,
        "wires": [
            [
                "53611f05496fa6df"
            ]
        ]
    },
    {
        "id": "bb8ee15e0a80636c",
        "type": "link in",
        "z": "c4157bddbbb8817a",
        "name": "inDataUpdate",
        "links": [
            "b202a0b79dc00822"
        ],
        "x": 635,
        "y": 540,
        "wires": [
            [
                "a9926d13056a53ff"
            ]
        ]
    },
    {
        "id": "1cbd7476662d574f",
        "type": "debug",
        "z": "c4157bddbbb8817a",
        "name": "debug 3",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 820,
        "wires": []
    },
    {
        "id": "a9926d13056a53ff",
        "type": "function",
        "z": "c4157bddbbb8817a",
        "name": "update_data_set_plc",
        "func": "const {ObjectId} = global.get(\"mongodb\");\n\nconst activeStage = flow.get(\"stageIndex\")\n\nconst _data = {\n            setup: flow.get(\"actStage\"),\n            values: global.get(\"session.process.data.plc\")\n}\n\nmsg.operation = 'updateOne'\n\nmsg.payload = [{ '_id': new ObjectId(flow.get('currentId', 'file')) }, { '$set': { [`stage_data.${[activeStage]}.plc.setup`]: { ..._data.setup }, [`stage_data.${[activeStage]}.plc.values`]:  [..._data.values]  }}]\nmsg.field = \"strain\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 540,
        "wires": [
            [
                "4a622033fd22118c"
            ]
        ]
    },
    {
        "id": "78f38647b7449688",
        "type": "inject",
        "z": "c4157bddbbb8817a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 500,
        "y": 460,
        "wires": [
            [
                "a9926d13056a53ff"
            ]
        ]
    },
    {
        "id": "7871ad14a913e153",
        "type": "function",
        "z": "c4157bddbbb8817a",
        "name": "update_data_set_osc",
        "func": "const {ObjectId} = global.get(\"mongodb\");\n\nconst aqStage = flow.get(\"aqStage\")\n\nconst _data = {\n            setup: msg.data[2],\n            values: msg.data[3]\n}\n\n\nmsg.operation = 'updateOne'\n\nmsg.payload = [{'_id': new ObjectId(flow.get('currentId', 'file'))}, {'$set': { [`stage_data.${[aqStage]}.osc`] : {..._data} }}]\nmsg.field = \"osc\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 660,
        "wires": [
            [
                "4a622033fd22118c"
            ]
        ]
    },
    {
        "id": "e6c2deb76fed0b9b",
        "type": "inject",
        "z": "c4157bddbbb8817a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 500,
        "y": 420,
        "wires": [
            [
                "a58fc1681de37f39"
            ]
        ]
    },
    {
        "id": "a9d3dc6839caf278",
        "type": "inject",
        "z": "c4157bddbbb8817a",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 500,
        "y": 380,
        "wires": [
            [
                "2ffe4bcbb54e1f72"
            ]
        ]
    },
    {
        "id": "e1d4efc4d5efde43",
        "type": "function",
        "z": "c4157bddbbb8817a",
        "name": "update_data_set_ohm",
        "func": "const {ObjectId} = global.get(\"mongodb\");\n\nconst activeStage = flow.get(\"stageIndex\");\n\nconst _data = msg.payload\n\nmsg.operation = 'updateOne'\n\nmsg.payload = [{'_id': new ObjectId(flow.get('currentId', 'file'))}, {'$set': { [`stage_data.${[activeStage]}.ohm`] : _data }}]\nmsg.field = \"ohm\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 780,
        "y": 600,
        "wires": [
            [
                "4a622033fd22118c"
            ]
        ]
    },
    {
        "id": "03e2ac170e048ae8",
        "type": "debug",
        "z": "c4157bddbbb8817a",
        "name": "debug 1",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1480,
        "y": 540,
        "wires": []
    },
    {
        "id": "2cea2d573347c0a3",
        "type": "link in",
        "z": "c4157bddbbb8817a",
        "name": "inOhmUpdate",
        "links": [
            "3ad932dcc7d70e79",
            "40fc1add38bf0fa4"
        ],
        "x": 635,
        "y": 600,
        "wires": [
            [
                "e1d4efc4d5efde43"
            ]
        ]
    },
    {
        "id": "03e7101a0147b8c0",
        "type": "link in",
        "z": "c4157bddbbb8817a",
        "name": "inStartAq",
        "links": [
            "950164b780fa14d3"
        ],
        "x": 675,
        "y": 280,
        "wires": [
            [
                "d17c41d7b5177332"
            ]
        ]
    },
    {
        "id": "d17c41d7b5177332",
        "type": "change",
        "z": "c4157bddbbb8817a",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "received",
                "pt": "msg",
                "to": "payload",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "StartAq",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 800,
        "y": 340,
        "wires": [
            [
                "6e26f7ce11cd04a4"
            ]
        ]
    },
    {
        "id": "933f114c0b9919b8",
        "type": "function",
        "z": "c4157bddbbb8817a",
        "name": "record_data_globally",
        "func": "const querry = msg.payload[1].$set\nconst keys = Object.keys(querry)\nvar path = \"\"\n\nkeys.forEach(function (key) {\n    global.set(key, querry[key]);\n    path = key;\n});\n\nmsg.path = path\nmsg.topic = \"data\"\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1160,
        "y": 600,
        "wires": [
            [
                "e0ad06c96ad243c0",
                "03e2ac170e048ae8"
            ]
        ]
    },
    {
        "id": "e0ad06c96ad243c0",
        "type": "link out",
        "z": "c4157bddbbb8817a",
        "name": "outDataUpdated",
        "mode": "link",
        "links": [
            "3d64c50fa540eed8"
        ],
        "x": 1355,
        "y": 600,
        "wires": []
    },
    {
        "id": "382754232d5b53fe",
        "type": "switch",
        "z": "c4157bddbbb8817a",
        "name": "",
        "property": "actStage.measurement",
        "propertyType": "flow",
        "rules": [
            {
                "t": "eq",
                "v": "H",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 990,
        "y": 320,
        "wires": [
            [
                "1f83e0ffaec52868"
            ]
        ]
    },
    {
        "id": "46a3c3149898b41f",
        "type": "link out",
        "z": "c4157bddbbb8817a",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "6739d8b2b161e960",
            "9b92d07c68abaa58"
        ],
        "x": 1245,
        "y": 320,
        "wires": []
    },
    {
        "id": "1f83e0ffaec52868",
        "type": "delay",
        "z": "c4157bddbbb8817a",
        "name": "",
        "pauseType": "delay",
        "timeout": "1",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1140,
        "y": 320,
        "wires": [
            [
                "46a3c3149898b41f"
            ]
        ]
    },
    {
        "id": "ebde08458e44bf71",
        "type": "mongodb4",
        "z": "0e117d41da2683ed",
        "clientNode": "b286894fefbfc7bc",
        "mode": "collection",
        "collection": "testrun",
        "operation": "",
        "output": "toArray",
        "maxTimeMS": "0",
        "handleDocId": false,
        "name": "",
        "x": 230,
        "y": 260,
        "wires": [
            [
                "e491d2a69e3036d0"
            ]
        ]
    },
    {
        "id": "09d2343f773e9140",
        "type": "link in",
        "z": "0e117d41da2683ed",
        "name": "database in",
        "links": [],
        "x": 75,
        "y": 260,
        "wires": [
            [
                "ebde08458e44bf71",
                "624dbc29306c2682"
            ]
        ]
    },
    {
        "id": "e491d2a69e3036d0",
        "type": "link out",
        "z": "0e117d41da2683ed",
        "name": "database return",
        "mode": "return",
        "links": [],
        "x": 395,
        "y": 260,
        "wires": []
    },
    {
        "id": "624dbc29306c2682",
        "type": "debug",
        "z": "0e117d41da2683ed",
        "name": "debug 13",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 240,
        "y": 340,
        "wires": []
    },
    {
        "id": "79c07bea4075b2c3",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inProcessOhm",
        "links": [],
        "x": 295,
        "y": 300,
        "wires": [
            [
                "1e90ac505c682e8c"
            ]
        ]
    },
    {
        "id": "3d0c344abedcfeba",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 685,
        "y": 300,
        "wires": []
    },
    {
        "id": "1e90ac505c682e8c",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "process ohm",
        "func": "const math = global.get(\"mathjs\")\nconst factor = 3\n\nmsg.segments = [];\n\nvar segment = []\nvar segment_start\n\nmsg.payload.forEach(function(el, i, ar){\n    el.ohm = parseFloat(el.ohm).toFixed(3);\n    el.ohm = validate(el.ohm);    \n    if(!Number.isNaN(el.ohm)){\n        segment.push(el.ohm);\n        if(segment.length === 1) {\n            segment_start = i\n        }\n    } else {\n        if(segment.length > 1){\n            const mean = math.mean(segment);\n            const std = math.std(segment)\n            const upper = mean + factor * std;\n            segment.forEach(function(v, j){\n                ar[segment_start + j].ohm = validate(v,upper, 0);\n            });\n            msg.segments.push({values: segment, mean: mean, std: std, index: segment_start})\n        }\n        segment = []\n    }\n})\n\nmsg.topic = \"ohm\" + (msg.channel ? `_${msg.channel}` : \"\" )\n\nreturn msg;\n\nfunction validate(x, high = 1000000000, low = -10) {\n    const y = x > high || x < low ? NaN : x;\n    return y;\n}\n\nfunction clamp(x, high = 20, low = -10) {\n    const y = math.max(math.min(x, high), low);\n    return y;\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 300,
        "wires": [
            [
                "3d0c344abedcfeba"
            ]
        ]
    },
    {
        "id": "30bf3e2256761f16",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "evaluate torque",
        "func": "const math = global.get(\"mathjs\")\nconst roi = {start: 0.18, end: 1.2}\n\nvar component\nswitch (msg.component) {\n    case \"button\":\n    case \"inner\":\n    case \"outer\":\n        component = msg.component;\n        break;\n    case \"B\":\n        component = \"button\";\n        break;\n    case \"I\":\n        component = \"inner\";\n        break;\n    case \"O\":\n        component = \"outer\";\n        break;\n}\n\n\nconst strain = msg.payload.filter(({ timeStamp }) => (timeStamp > roi.start && timeStamp < roi.end)).map(({ strain }) => (strain))\nconst detents = findPeaks(strain);\n\nconst values = [];\nconst crt = {};\ncrt.component = component\n\ncrt.measurement = \"detents\"\ncrt.label = \"Detents\";\ncrt.value = detents.length;\nvalues.push({ ...crt });\n\ncrt.measurement = \"torque\"\ncrt.label = \"Mean torque\";\ncrt.value = math.mean(detents).toFixed(3);\nvalues.push({ ...crt });\n\ncrt.measurement = \"detent_torque\"\ncrt.label = \"Max torque\";\ncrt.value = math.max(detents).toFixed(3);\nvalues.push({ ...crt });\n\ncrt.label = \"Min torque\";\ncrt.value = math.min(detents).toFixed(3);\nvalues.push({ ...crt });\n\nmsg.payload = [...values]\n\nreturn msg;\n\n\n\n/**\n* @param {any[]} chart\n*/\nfunction findPeaks(chart) {\n    return chart.reduce((/** @type {array} */ agg, /** @type {number} */ current, /** @type {number} */ i) => {\n        const prev = chart[i - 1];\n        const next = chart[i + 1];\n        return current > prev && current >= next ? [...agg, current] : agg;\n    }, []);\n}\n\n\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 640,
        "wires": [
            [
                "cf8fffd08dc5f9bd"
            ]
        ]
    },
    {
        "id": "6f2eb3f0c9e5ca90",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inEvalTorque",
        "links": [],
        "x": 295,
        "y": 640,
        "wires": [
            [
                "30bf3e2256761f16"
            ]
        ]
    },
    {
        "id": "534f5dd902ce0950",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "link out 1",
        "mode": "return",
        "links": [],
        "x": 705,
        "y": 640,
        "wires": []
    },
    {
        "id": "0644ecb9e4b471d9",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "round first value",
        "func": "const fix = (ob, d) => Object.keys(ob).forEach(function (k) {\n    ob[k] = ob[k]?.toFixed(3)\n})\n\nfix(msg.payload[0])\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 180,
        "wires": [
            [
                "6e6dafdc8b5c046a"
            ]
        ]
    },
    {
        "id": "5a97b52d1b69900a",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inRoundFirst",
        "links": [],
        "x": 295,
        "y": 180,
        "wires": [
            [
                "0644ecb9e4b471d9"
            ]
        ]
    },
    {
        "id": "6e6dafdc8b5c046a",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "outRoundFirst",
        "mode": "return",
        "links": [],
        "x": 595,
        "y": 180,
        "wires": []
    },
    {
        "id": "1c01fb5e95c68584",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "evaluate button force",
        "func": "const math = global.get(\"mathjs\")\n\nvar component\nswitch (msg.component) {\n    case \"button\":\n    case \"inner\":\n    case \"outer\":\n        component = msg.component;\n        break;\n    case \"B\":\n        component = \"button\";\n        break;\n    case \"I\":\n        component = \"inner\";\n        break;\n    case \"O\":\n        component = \"outer\";\n        break;\n}\n\nconst force = [];\nconst time = [];\nconst pos = [];\n\nmsg.payload.forEach(function({strain, timeStamp, position}){\n    force.push(strain);\n    time.push(timeStamp);\n    pos.push(position);\n});\n\n/*Eliminate all values after force max (button bottoming out)*/\nlet peak = math.max(force);\nlet deb = peak;\nlet peakInd = force.findIndex((v) => v === peak) - 1 ;\nlet debi = peakInd;\n\nforce.splice(peakInd);\ntime.splice(peakInd);\npos.splice(peakInd);\n\n/*Find peak*/\npeak = math.min(force);\npeakInd = 0;\nconst span = 6;\nconst prev = math.floor(span / 2);\n\nconst debmeans = [];\nfor (let i = 0 + prev; i < force.length - prev - 1; i++) {\n    const v = force[i];\n    const roll = math.max(...force.slice(i - prev, i), ...force.slice(i + 1, i + prev)); /*math.mean(force.slice(i - prev, i + prev));  */ \n    if (v > roll) {\n        peak = v;\n        peakInd = i;\n        debmeans.push({force: v, roll: roll});\n    };\n};\n\nconst touchInd = force.findIndex((v) => v > 0.1);\nconst vally = force.slice(peakInd + 1).find((v) => v >= peak)/*math.min(force.slice(peakInd));*/\nconst vallyInd = force.slice(peakInd).findIndex((v) => v === vally) + peakInd;\n\n\nconst values = [];\nconst crt = {};\ncrt.component = component\n\ncrt.measurement = \"force\"\ncrt.label = \"Actuation force\";\ncrt.value = peak.toFixed(3);\nvalues.push({ ...crt });\n\ncrt.measurement = \"travel\"\ncrt.label = \"Travel\";\ncrt.value = math.abs(pos[vallyInd] - pos[touchInd]).toFixed(3);\nvalues.push({ ...crt });\n\nmsg.payload = [...values]\nmsg.debug = {\n    max: deb,\n    maxIndex: debi,\n    peak: peak,\n    peakIndex: peakInd,\n    valley: vally,\n    valleyIndex: vallyInd,\n    posValley: pos[vallyInd],\n    posPeak: pos[peakInd],\n    touchIndex: touchInd,\n    touchPos: pos[touchInd],\n    timeMax: time[debi],\n    rolling: debmeans\n};\n\nreturn msg;\n\n\n\n/**\n* @param {any[]} chart\n*/\nfunction findPeaks(chart) {\n    return chart.reduce((/** @type {array} */ agg, /** @type {number} */ current, /** @type {number} */ i) => {\n        const prev = chart[i - 1];\n        const next = chart[i + 1];\n        return current > prev && current >= next ? [...agg, current] : agg;\n    }, []);\n}\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/*\nconst values = msg.payload\nconst data = global.get(\"session.features.button.value\")\nconst math = global.get('mathjs')\nconst tools = global.get(\"settings.limits.tools\", \"file\")\nconst findPeaks = chart => chart.reduce((agg, current, i) => {\n    const prev = chart[i - 1];\n    const next = chart[i + 1];\n    return current > prev + 0.05 && current >= next + 0.05 ? [...agg, current] : agg;\n}, []);\n\nconst strain = values.map(({ strain }) => (strain))\nconst position = values.map(({ position }) => (position))\n\nconst peaks = findPeaks(strain)\nconst start = strain.findIndex(f => f > strain[0] + 0.1)\nconst end = peaks.length === 2 ? strain.slice(peaks[0]?.ind, peaks[1]?.ind).findIndex((f, i, ar) => f < ar[i-1] && f <= ar[i+1]) : 0\nconst force = peaks.length === 2 ? peaks[0] : 0\nconst travel = math.abs(end - start)\n\nconst f_lims = tools.window.relative_multiply(data.force, data.force_limit)\nconst t_lims = tools.window.relative_offset(data.travel, data.travel_limit)\n\nmsg.payload = {\n    \"peaks\" : peaks,\n    \"ends\": [start, end],\n    \"force\": force,\n    \"travel\" : travel,\n    \"f_lims\" : f_lims,\n    \"t_lims\" : t_lims,\n    \"status_force\": tools.in_window(force, f_lims),\n    \"status_travel\": tools.in_window(travel, t_lims),\n}\n\nreturn msg;\n\n    */\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 440,
        "wires": [
            [
                "7b0650e87ffd0265",
                "c91a57369e8b58eb"
            ]
        ]
    },
    {
        "id": "c9b9a5158a951c7a",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inEvalForce",
        "links": [],
        "x": 295,
        "y": 440,
        "wires": [
            [
                "1c01fb5e95c68584",
                "c91a57369e8b58eb"
            ]
        ]
    },
    {
        "id": "50c8987fb61c1c81",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "link out 4",
        "mode": "return",
        "links": [],
        "x": 695,
        "y": 440,
        "wires": []
    },
    {
        "id": "249acd8ab13290c2",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "IIR filter",
        "func": "// Source - https://stackoverflow.com/a/50215122\n// Posted by nPn\n// Retrieved 2026-01-14, License - CC BY-SA 4.0\nconst data = context.get(\"data\") ?? {}\n\ndata[msg.topc] = msg.payload\n\nconst {x, b0, b1, b2, a1, a2} = data\n\nconst y = x.reduce(function(acc, v, i) {\n    acc.push(b0 * x[i] + b1 * x[i - 1] + b2 * x[i - 2] - a1 * acc[i - 1] - a2 * acc[i - 2])\n    return acc\n},[])\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1200,
        "y": 380,
        "wires": [
            []
        ]
    },
    {
        "id": "ab9fec2190343da0",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "chart options -dataZoom",
        "func": "const ui_update = msg.ui_update ?? {}\nconst chartOptions = ui_update.chartOptions ?? {}\nconst add = {\n    dataZoom: {\n        type: 'inside'\n    }\n}\n\nObject.assign(chartOptions, add)\nmsg.ui_update = Object.assign(ui_update, chartOptions)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 280,
        "wires": [
            [
                "3532702b342c8d67"
            ]
        ]
    },
    {
        "id": "8f25963e1553108e",
        "type": "inject",
        "z": "f0b99c790d575624",
        "name": "type: line",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 1000,
        "y": 300,
        "wires": [
            [
                "ab9fec2190343da0"
            ]
        ]
    },
    {
        "id": "3532702b342c8d67",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "chart options -yAxis",
        "func": "const ui_update = msg.ui_update ?? {}\nconst chartOptions = ui_update.chartOptions ?? {}\nconst add = {\n    yAxis: {\n            position: 'left',\n            max: 100\n        }\n}\n\nObject.assign(chartOptions, add)\nmsg.ui_update = Object.assign(ui_update, chartOptions)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 280,
        "wires": [
            []
        ]
    },
    {
        "id": "809b78b216878b13",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "evaluate resullt",
        "func": "const testplan = global.get(\"testplan\")\n\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 420,
        "wires": [
            []
        ]
    },
    {
        "id": "841d97932ba447ba",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "set testplan",
        "func": "const features = global.get(\"session.features\")\nconst settings = global.get(\"settings\", \"file\")\nconst window = settings.limits.tools.window\n\nconst testplan = {}\n\nfor (const [feature_name, feature] of Object.entries(features).filter(([n, v]) => v.type !== \"info\")) {\n    const template = settings.data.feature_types[feature.type]\n    const enabler = template.find((e) => e?.enabler === true)\n    if (feature.value[enabler?.key] !== 0 || enabler === undefined) {\n        testplan[feature_name] = {}\n        for (const [key, value] of Object.entries(feature.value)) {\n            const model = template.find((t) => t.key === key)\n            if (model.scope === \"nominal\") {\n                const lim = model.limit_type === \"absolute\" ? 0 : feature.value[key + \"_limit\"]\n                testplan[feature_name][key] = window[model.limit_type](value, lim)\n            }\n        }\n    }\n}\n\nglobal.set(\"testplan\", testplan);",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 840,
        "wires": [
            []
        ]
    },
    {
        "id": "bfc91c984110e66c",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "evaluate ohm",
        "func": "const math = global.get(\"mathjs\")\nconst { in_window: within } = global.get(\"settings.limits.tools\", \"file\")\nconst factor = 2\n\nvar component\nswitch(msg.component){\n    case \"button\":\n    case \"inner\":\n    case \"outer\":\n        component = msg.component;\n        break;\n    case \"B\":\n        component = \"button\";\n        break;\n    case \"I\":\n        component = \"inner\";\n        break;\n    case \"O\":\n        component = \"outer\";\n        break;\n}\n\n\nconst values = [];\nconst crt = {};\ncrt.component = component;\ncrt.measurement = \"resistance\"\ncrt.label = \"Resistance\" + ( component === \"button\" ? \"\" : ` ${ msg.channel}`);\n/* Get maximum resistance mean value (mean of segment) */\ncrt.value = NaN;\nmsg.segments.forEach(function(seg) {\n    const mean = (math.mean(seg.values.filter((v) => within(v, [0, seg.mean + factor*seg.std])))).toFixed(3);\n    crt.value = Number.isNaN(crt.value) ? mean : math.max(crt.value, mean);\n});\n\nvalues.push({...crt});\n\nmsg.payload = values\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 340,
        "wires": [
            [
                "4a7541e8351a1dc8"
            ]
        ]
    },
    {
        "id": "20b75578bda09947",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 685,
        "y": 340,
        "wires": []
    },
    {
        "id": "67ce2bb6658b16a1",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inEvalOhm",
        "links": [],
        "x": 295,
        "y": 340,
        "wires": [
            [
                "bfc91c984110e66c"
            ]
        ]
    },
    {
        "id": "afa681053145fae2",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inSetTestplan",
        "links": [
            "93927a51db297807"
        ],
        "x": 305,
        "y": 840,
        "wires": [
            [
                "841d97932ba447ba"
            ]
        ]
    },
    {
        "id": "cc73ea3b870e8294",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "check product",
        "func": "const product = global.get(\"current.product\");\nconst extract = global.get(\"settings.data.prod_extract\", \"file\");\n\nmsg.result = extract(msg.payload, product)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 800,
        "wires": [
            [
                "71cf39e66d6e715b"
            ]
        ]
    },
    {
        "id": "71cf39e66d6e715b",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 565,
        "y": 800,
        "wires": []
    },
    {
        "id": "00926f7c3cf1f2f8",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inCheckProduct",
        "links": [],
        "x": 305,
        "y": 800,
        "wires": [
            [
                "cc73ea3b870e8294"
            ]
        ]
    },
    {
        "id": "56c8c62de4c7044f",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inEvalOscEnc",
        "links": [],
        "x": 295,
        "y": 600,
        "wires": [
            [
                "64e1f40bcbccc24e"
            ]
        ]
    },
    {
        "id": "64e1f40bcbccc24e",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "evaluate osc encoder",
        "func": "const math = global.get(\"mathjs\")\n\nvar component\nswitch(msg.component){\n    case \"button\":\n    case \"inner\":\n    case \"outer\":\n        component = msg.component;\n        break;\n    case \"B\":\n        component = \"button\";\n        break;\n    case \"I\":\n        component = \"inner\";\n        break;\n    case \"O\":\n        component = \"outer\";\n        break;\n}\n\nconst values = [];\nconst crt = {};\ncrt.component = component;\n\ncrt.measurement = \"phase\";\ncrt.label = \"Phase shift\";\ncrt.value = msg.payload[\"phase_delta\"].toFixed(3);\nvalues.push({...crt});\n\ncrt.measurement = \"pulses\";\ncrt.label = \"PPR A\";\ncrt.value = msg.payload[\"A_peak_cnt\"];\nvalues.push({...crt});\n\ncrt.measurement = \"pulses\"\ncrt.label = \"PPR B\";\ncrt.value = msg.payload[\"B_peak_cnt\"];\nvalues.push({...crt});\n\ncrt.measurement = \"bounce\"\ncrt.label = \"Max bounce A\";\ncrt.value = math.max(msg.payload[\"A_bounces\"]).toFixed(3);\nvalues.push({...crt});\n\ncrt.measurement = \"bounce\"\ncrt.label = \"Max bounce B\";\ncrt.value = math.max(msg.payload[\"B_bounces\"]).toFixed(3);\nvalues.push({...crt});\n\ncrt.label = \"Duty cycle A\";\ncrt.value = msg.payload[\"A_duty_cycle\"].toFixed(3);\ncrt.limits = [crt.value, crt.value];\nvalues.push({...crt});\ndelete crt.limits;\n\ncrt.label = \"Duty cycle B\";\ncrt.value = msg.payload[\"B_duty_cycle\"].toFixed(3);\ncrt.limits = [crt.value, crt.value];\nvalues.push({...crt});\ndelete crt.limits;\n\nmsg.payload = [...values]\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 440,
        "y": 600,
        "wires": [
            [
                "443be428983fb08d"
            ]
        ]
    },
    {
        "id": "482565c00ad0a035",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 705,
        "y": 600,
        "wires": []
    },
    {
        "id": "c91a57369e8b58eb",
        "type": "debug",
        "z": "f0b99c790d575624",
        "name": "debug 6",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 820,
        "y": 380,
        "wires": []
    },
    {
        "id": "60f27802fdf278b3",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "evaluate",
        "func": "const math = global.get(\"mathjs\");\nconst result = global.get(\"result\") ?? {evaluations: 0, passes: 0};\nconst testplan = global.get(\"testplan\");\nconst { in_window: within } = global.get(\"settings.limits.tools\", \"file\");\n\nmsg.payload.forEach(function(m){\n    m.limits = m.limits ?? testplan[m.component][m.measurement];\n    m.result = within(m.value, m.limits);\n    m.lower = pretty(math.min(m.limits));\n    m.upper = pretty(math.max(m.limits));\n\n    result.evaluations += 1;\n    result.passes += m.result ? 1 : 0;\n\n});\n\nglobal.set(\"result\", result);\n\nreturn msg;\n\nfunction pretty(n) {\n    return Number.isInteger(n) ? n : n.toFixed(3);\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 420,
        "y": 940,
        "wires": [
            [
                "87192abd4f7858c7"
            ]
        ]
    },
    {
        "id": "63adbc2a9627ab24",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inEval",
        "links": [],
        "x": 305,
        "y": 940,
        "wires": [
            [
                "60f27802fdf278b3"
            ]
        ]
    },
    {
        "id": "87192abd4f7858c7",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 555,
        "y": 940,
        "wires": []
    },
    {
        "id": "cf8fffd08dc5f9bd",
        "type": "link call",
        "z": "f0b99c790d575624",
        "name": "",
        "links": [
            "63adbc2a9627ab24"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 640,
        "wires": [
            [
                "534f5dd902ce0950"
            ]
        ]
    },
    {
        "id": "443be428983fb08d",
        "type": "link call",
        "z": "f0b99c790d575624",
        "name": "",
        "links": [
            "63adbc2a9627ab24"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 600,
        "wires": [
            [
                "482565c00ad0a035"
            ]
        ]
    },
    {
        "id": "4a7541e8351a1dc8",
        "type": "link call",
        "z": "f0b99c790d575624",
        "name": "",
        "links": [
            "63adbc2a9627ab24"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 590,
        "y": 340,
        "wires": [
            [
                "20b75578bda09947"
            ]
        ]
    },
    {
        "id": "2e375ada350af0ee",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "add chart options",
        "func": "const ui_update = msg.ui_update ?? {};\nconst chartOptions = ui_update.chartOptions ?? {};\nconst add = {...msg.add};\n\nObject.assign(chartOptions, add)\nmsg.ui_update = Object.assign(ui_update, chartOptions)\n\ndelete msg.add\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 760,
        "wires": [
            [
                "7dcdf7800e903e91"
            ]
        ]
    },
    {
        "id": "abe424a059218064",
        "type": "change",
        "z": "f0b99c790d575624",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "add",
                "pt": "msg",
                "to": "{\"title\":{\"text\":\"asdfg\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1210,
        "y": 640,
        "wires": [
            [
                "9e1bc29552bca619"
            ]
        ]
    },
    {
        "id": "0f169113fbf063e9",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inAddOption",
        "links": [],
        "x": 1095,
        "y": 760,
        "wires": [
            [
                "2e375ada350af0ee"
            ]
        ]
    },
    {
        "id": "7dcdf7800e903e91",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 1365,
        "y": 760,
        "wires": []
    },
    {
        "id": "77bd049b74d61001",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inAddTitle",
        "links": [],
        "x": 1095,
        "y": 640,
        "wires": [
            [
                "abe424a059218064"
            ]
        ]
    },
    {
        "id": "1c98371d958a6ce2",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 1495,
        "y": 640,
        "wires": []
    },
    {
        "id": "9e1bc29552bca619",
        "type": "link call",
        "z": "f0b99c790d575624",
        "name": "",
        "links": [
            "0f169113fbf063e9"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1370,
        "y": 640,
        "wires": [
            [
                "1c98371d958a6ce2"
            ]
        ]
    },
    {
        "id": "af49f171cc59544b",
        "type": "change",
        "z": "f0b99c790d575624",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "add",
                "pt": "msg",
                "to": "{\"yAxis\":{\"position\":\"right\"}}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1210,
        "y": 700,
        "wires": [
            [
                "ca69232c1d44271e"
            ]
        ]
    },
    {
        "id": "1b4353799567be35",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inAddAxisPos",
        "links": [],
        "x": 1095,
        "y": 700,
        "wires": [
            [
                "af49f171cc59544b"
            ]
        ]
    },
    {
        "id": "af02f99675da3f31",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 1495,
        "y": 700,
        "wires": []
    },
    {
        "id": "ca69232c1d44271e",
        "type": "link call",
        "z": "f0b99c790d575624",
        "name": "",
        "links": [
            "0f169113fbf063e9"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1370,
        "y": 700,
        "wires": [
            [
                "af02f99675da3f31"
            ]
        ]
    },
    {
        "id": "df51a182d24ba8c5",
        "type": "function",
        "z": "f0b99c790d575624",
        "name": "evaluate osc button",
        "func": "const math = global.get(\"mathjs\")\n\nvar component\nswitch(msg.component){\n    case \"button\":\n    case \"inner\":\n    case \"outer\":\n        component = msg.component;\n        break;\n    case \"B\":\n        component = \"button\";\n        break;\n    case \"I\":\n        component = \"inner\";\n        break;\n    case \"O\":\n        component = \"outer\";\n        break;\n}\n\nconst values = [];\nconst crt = {};\ncrt.component = component;\n\ncrt.measurement = \"bounce\"\ncrt.label = \"Max bounce\";\ncrt.value = math.max([...msg.payload[\"A_bounces\"], -1]).toFixed(3);\nvalues.push({...crt});\n\nmsg.payload = [...values]\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 430,
        "y": 480,
        "wires": [
            [
                "8cb84c62972c9f62"
            ]
        ]
    },
    {
        "id": "8cb84c62972c9f62",
        "type": "link call",
        "z": "f0b99c790d575624",
        "name": "",
        "links": [
            "63adbc2a9627ab24"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 480,
        "wires": [
            [
                "f761d2bcc2f74721"
            ]
        ]
    },
    {
        "id": "f761d2bcc2f74721",
        "type": "link out",
        "z": "f0b99c790d575624",
        "name": "ret",
        "mode": "return",
        "links": [],
        "x": 695,
        "y": 480,
        "wires": []
    },
    {
        "id": "bb9409d2a0b115aa",
        "type": "link in",
        "z": "f0b99c790d575624",
        "name": "inEvalOscBut",
        "links": [],
        "x": 295,
        "y": 480,
        "wires": [
            [
                "df51a182d24ba8c5"
            ]
        ]
    },
    {
        "id": "7b0650e87ffd0265",
        "type": "link call",
        "z": "f0b99c790d575624",
        "name": "",
        "links": [
            "63adbc2a9627ab24"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 440,
        "wires": [
            [
                "50c8987fb61c1c81"
            ]
        ]
    },
    {
        "id": "f4f2fb073ad2baf1",
        "type": "ui-control",
        "z": "a6c85f6538755b0c",
        "name": "",
        "ui": "86cea779c465227a",
        "events": "all",
        "x": 380,
        "y": 180,
        "wires": [
            [
                "26df795f70aac6ed",
                "50dbf2d4971dba85"
            ]
        ]
    },
    {
        "id": "28afbc673cc0e8dc",
        "type": "link in",
        "z": "a6c85f6538755b0c",
        "name": "inUi",
        "links": [
            "5e51d43694ee4944"
        ],
        "x": 275,
        "y": 180,
        "wires": [
            [
                "f4f2fb073ad2baf1"
            ]
        ]
    },
    {
        "id": "26df795f70aac6ed",
        "type": "link out",
        "z": "a6c85f6538755b0c",
        "name": "outUi",
        "mode": "link",
        "links": [
            "90dc1519d61ce087",
            "150473f2c686409d",
            "e361215bc8c832ec"
        ],
        "x": 485,
        "y": 180,
        "wires": []
    },
    {
        "id": "50dbf2d4971dba85",
        "type": "debug",
        "z": "a6c85f6538755b0c",
        "name": "debug 12",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 620,
        "y": 300,
        "wires": []
    },
    {
        "id": "3a0ea380c5a06a29",
        "type": "ui-template",
        "z": "a6c85f6538755b0c",
        "group": "",
        "page": "",
        "ui": "86cea779c465227a",
        "name": "Product data",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "<template>\n    <Teleport v-if=\"mounted\" to=\"#app-bar-actions\">\n        <v-btn variant=\"text\" :ripple=\"false\" @click=\"req()\">\n            <div class=\"nrdb-ui-text-label\"> \n                Current product type: \n            </div>\n            <div class=\"nrdb-ui-text-value\">\n                {{ msg.product }}\n            </div>\n        </v-btn>\n    </Teleport>\n</template>\n<script>\n    export default {\n        data() {\n            return {\n                mounted: false\n            }\n        },\n        mounted() {\n            this.mounted = true\n        },\n        methods: {\n            req: function () {\n                this.send({ payload: 'Settings' })\n        }\n        }\n        \n    }\n</script>",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "widget:ui",
        "className": "",
        "x": 390,
        "y": 500,
        "wires": [
            [
                "50dbf2d4971dba85",
                "f4f2fb073ad2baf1"
            ]
        ]
    },
    {
        "id": "7913fa0b46089759",
        "type": "change",
        "z": "a6c85f6538755b0c",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "product",
                "pt": "msg",
                "to": "$globalContext(\"current.product.name\")",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 220,
        "y": 500,
        "wires": [
            [
                "3a0ea380c5a06a29"
            ]
        ]
    },
    {
        "id": "191a57a0a0470de1",
        "type": "inject",
        "z": "a6c85f6538755b0c",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 420,
        "wires": [
            [
                "7913fa0b46089759"
            ]
        ]
    },
    {
        "id": "1553f42182fe9185",
        "type": "link in",
        "z": "a6c85f6538755b0c",
        "name": "link in 1",
        "links": [
            "874b939d0b06ddf6"
        ],
        "x": 155,
        "y": 460,
        "wires": [
            [
                "7913fa0b46089759"
            ]
        ]
    },
    {
        "id": "abbc0944b6949531",
        "type": "ui-template",
        "z": "a6c85f6538755b0c",
        "group": "",
        "page": "",
        "ui": "86cea779c465227a",
        "name": "Table with remove button",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": "td[data-column-key=\"remove\"] button.v-btn {\n    background-color: rgba(255, 0, 0, 0.551) !important;\n}\n\n\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "site:style",
        "className": "",
        "x": 410,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "72dc3b96a2db6694",
        "type": "ui-template",
        "z": "a6c85f6538755b0c",
        "group": "",
        "page": "",
        "ui": "86cea779c465227a",
        "name": "big_text",
        "order": 0,
        "width": 0,
        "height": 0,
        "head": "",
        "format": ".big_text {\n    font-size: x-large !important;\n}\n\n\n",
        "storeOutMessages": true,
        "passthru": false,
        "resendOnRefresh": true,
        "templateScope": "site:style",
        "className": "",
        "x": 360,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "a4cc879c4d28527a",
        "type": "debug",
        "z": "0637f22188042045",
        "name": "debug 7",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 540,
        "y": 980,
        "wires": []
    },
    {
        "id": "31b312cbae942fc4",
        "type": "ui-text-input",
        "z": "0637f22188042045",
        "group": "6f6a6db0185ac9a4",
        "name": "product",
        "label": "Product",
        "order": 3,
        "width": 2,
        "height": "1",
        "topic": "product",
        "topicType": "str",
        "mode": "text",
        "tooltip": "",
        "delay": 300,
        "passthru": false,
        "sendOnDelay": false,
        "sendOnBlur": false,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "sendOnClear": false,
        "icon": "",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "x": 140,
        "y": 120,
        "wires": [
            [
                "014a23b36f2b2e80"
            ]
        ]
    },
    {
        "id": "fcb25608bd09682b",
        "type": "ui-text-input",
        "z": "0637f22188042045",
        "group": "6f6a6db0185ac9a4",
        "name": "order",
        "label": "Order",
        "order": 4,
        "width": "1",
        "height": "1",
        "topic": "order",
        "topicType": "str",
        "mode": "text",
        "tooltip": "Order number",
        "delay": 300,
        "passthru": false,
        "sendOnDelay": false,
        "sendOnBlur": false,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "sendOnClear": false,
        "icon": "",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "x": 130,
        "y": 260,
        "wires": [
            [
                "7949c9e9025be6c9"
            ]
        ]
    },
    {
        "id": "b9195f648eb6d99b",
        "type": "ui-notification",
        "z": "0637f22188042045",
        "ui": "86cea779c465227a",
        "position": "top center",
        "colorDefault": true,
        "color": "#000000",
        "displayTime": "10",
        "showCountdown": true,
        "outputs": 1,
        "allowDismiss": true,
        "dismissText": "Confirm",
        "allowConfirm": false,
        "confirmText": "Confirm",
        "raw": false,
        "className": "",
        "name": "input_error",
        "x": 1310,
        "y": 40,
        "wires": [
            []
        ]
    },
    {
        "id": "efe279013f6c1ce5",
        "type": "ui-table",
        "z": "0637f22188042045",
        "group": "6f6a6db0185ac9a4",
        "name": "",
        "label": "",
        "order": 1,
        "width": "",
        "height": "",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "Article",
                "key": "type",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Order",
                "key": "order",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Time stamp",
                "key": "timestamp",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Operator",
                "key": "operator",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "",
        "mobileBreakpointType": "none",
        "action": "replace",
        "className": "",
        "x": 890,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "937d7b67602d88ba",
        "type": "function",
        "z": "0637f22188042045",
        "name": "update_session",
        "func": "const math = global.get('mathjs')\nconst strain_mem = context.get(\"strain\")\nconst ret = [{}, {}, {}]\nconst fields = context.get(\"fields\")\nconst { session = { product: { type: \"default\", order: \"default\", operator: \"default\", timestamp: \"default\" } } } =  { session : global.get(\"session\") }\nconst operator = global.get(\"operator\", \"file\")\nconst tools = global.get(\"settings.limits.tools\", \"file\")\n\nsession.product.operator = operator;\nif (msg.topic === \"order\") session.product.order = msg.payload;\nObject.assign(fields, (({ type, order, operator }) => ({ type, order, operator }))(session.product))\nfields.timestamp = (([d, t = \"0:0:0.0Z\"]) => d + \" \" + t.match(/[^.]+/))(session.product.timestamp.split(\"T\"))\n\ncontext.set(\"fields\", fields)\n\nret[0].payload = fields\nret[1] = {\n    payload: ((session.process?.stages.active / (session.process?.stages.count - 1)) * 100) || 0\n}\n\n\nif (msg.topic === \"data\") {\n    const path = msg.path.split(\".\");\n    const entry = global.get(path.slice(0, 2).join(\".\"));\n    const stage = global.get(`session.process.stages.stages[${path[1]}]`)\n\n    ret[2] = {\n        features: session.product.features,\n        component: stage.component,\n        field: msg.field,\n        measurement: stage.measurement,\n        payload: global.get(msg.path)\n    }\n\n    switch (msg.field) {\n        case \"strain\":\n            ret[2].series = [\"strain\", \"position\"];\n            if(strain_mem[stage.component]){\n                ret[2] = {};\n            }\n            strain_mem[stage.component] = true;\n            context.set(\"strain\", strain_mem);\n            break;\n        case \"ohm\":\n            ret[2].channel = stage.channel;\n            \n            /*switch (stage.component) {\n                case \"I\":\n                case \"O\":\n                    ret[2].series = [\"ohm_A\", \"ohm_B\"]\n                    ret[2].payload.forEach(function (el) {\n                        el[\"ohm_\" + stage.channel] = parseFloat(el.ohm).toFixed(2)\n                    });\n                    break;\n                case \"B\":\n                    ret[2].series = [\"ohm\"]\n            }*/ \n            \n            break;\n        case \"osc\":\n            const vals = ret[2].payload.values\n            ret[2].payload = vals;\n            ret[2].graph = vals[\"signal\"];\n            break;\n    }\n\n}\n\n\nif (msg.topic === \"productData\") {\n    \n    if(!msg.sim){\n        global.set(\"stage_data\", []);\n    }\n    \n    context.set(\"strain\", { \"B\": false, \"I\": false, \"O\": false });\n    ret[2] = {\n        component: \"all\",\n        field: \"all\",\n        topic: \"reset\",\n        payload: []\n    }\n\n    global.set(\"result\", {evaluations: 0, passes: 0});\n}\n\nreturn ret;\n\n\n",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nif (context.get(\"fields\") === undefined){\n    context.set(\"fields\", {})\n}\n\ncontext.set(\"strain\", {\"B\":false, \"I\":false, \"O\":false});",
        "finalize": "",
        "libs": [],
        "x": 540,
        "y": 580,
        "wires": [
            [
                "efe279013f6c1ce5",
                "d984f1c52bbb7a42",
                "eb24925af8cfb7a4"
            ],
            [
                "8766ed8d27633676",
                "71b166778f546dd1"
            ],
            [
                "667dfded88646090",
                "94317c601856da8b"
            ]
        ]
    },
    {
        "id": "d898d0581b758bc1",
        "type": "ui-text-input",
        "z": "0637f22188042045",
        "group": "6f6a6db0185ac9a4",
        "name": "",
        "label": "Operator",
        "order": 2,
        "width": "1",
        "height": "1",
        "topic": "operator",
        "topicType": "str",
        "mode": "text",
        "tooltip": "Input operator name",
        "delay": 300,
        "passthru": true,
        "sendOnDelay": false,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "sendOnClear": false,
        "icon": "",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "x": 140,
        "y": 300,
        "wires": [
            [
                "7949c9e9025be6c9"
            ]
        ]
    },
    {
        "id": "90b9b323522d2ea4",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(file)::operator",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 470,
        "y": 340,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "3d64c50fa540eed8",
        "type": "link in",
        "z": "0637f22188042045",
        "name": "inUpdateHomeTable",
        "links": [
            "4667f931d82fbdd7",
            "58926eb4cedd25af",
            "7b31415877960626",
            "e0ad06c96ad243c0",
            "337ebe561ce901c5"
        ],
        "x": 465,
        "y": 660,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "5a12dcb34b6c43ce",
        "type": "ui-table",
        "z": "0637f22188042045",
        "group": "9a2350a4f1394335",
        "name": "",
        "label": "",
        "order": 1,
        "width": 4,
        "height": null,
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "Total",
                "key": "total",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Pass",
                "key": "pass",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Fail",
                "key": "fail",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "",
        "mobileBreakpointType": "none",
        "action": "replace",
        "className": "",
        "x": 890,
        "y": 1180,
        "wires": [
            []
        ]
    },
    {
        "id": "3aa0b64653eda525",
        "type": "function",
        "z": "0637f22188042045",
        "name": "update_statistics",
        "func": "const fields = context.get(\"fields\")\nvar { total = 0, pass = 0, fail = 0 } = global.get(\"statistics\") || {}\nconst { product: { order } } = global.get(\"session\");\n\n\nconst _order = context.get(\"order\");\nif (order !== _order || msg.topic === \"reset_stats\") {\n    total = 0,\n        pass = 0,\n        fail = 0\n}\ncontext.set(\"order\", order)\n\nswitch (msg.topic) {\n    case \"pass\":\n        pass++\n        total++\n        break;\n    case \"fail\":\n        fail++\n        total++\n        break;\n}\n\n\nObject.assign(fields, { total, pass, fail })\ncontext.set(\"fields\", fields)\n\nglobal.set(\"statistics\", fields)\nmsg.payload = fields\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nif (context.get(\"fields\") === undefined){\n    context.set(\"fields\", {})\n}\n\nif (context.get(\"order\") === undefined) {\n    context.set(\"order\", \"default\")\n}",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 1180,
        "wires": [
            [
                "5a12dcb34b6c43ce"
            ]
        ]
    },
    {
        "id": "8903da3cbb47b090",
        "type": "ui-button",
        "z": "0637f22188042045",
        "group": "9a2350a4f1394335",
        "name": "",
        "label": "Reset stats",
        "order": 2,
        "width": "1",
        "height": 1,
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "reset_stats",
        "topicType": "str",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 530,
        "y": 1140,
        "wires": [
            [
                "3aa0b64653eda525"
            ]
        ]
    },
    {
        "id": "2a57a0ea5c87a6ed",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "button osc",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.1.osc",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "osc",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 240,
        "y": 420,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "fbe36f1e226dba9c",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "89a4f69b951b98f3",
        "name": "Strain",
        "label": "",
        "order": 1,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "X axis",
        "xAxisProperty": "timeStamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "strain",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 1770,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "431ed7dbddda23c1",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "89a4f69b951b98f3",
        "name": "osc",
        "label": "",
        "order": 2,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "time [ms]",
        "xAxisProperty": "timestamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "a",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 1930,
        "y": 340,
        "wires": [
            []
        ]
    },
    {
        "id": "e60529c29388a55d",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "bf198eb6e69ac543",
        "name": "torq",
        "label": "",
        "order": 1,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "X axis",
        "xAxisProperty": "timeStamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "strain",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 1970,
        "y": 1120,
        "wires": [
            []
        ]
    },
    {
        "id": "41b53a65de1ae8c8",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "3378c67758bc3e77",
        "name": "torq",
        "label": "",
        "order": 1,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "X axis",
        "xAxisProperty": "timeStamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "strain",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 1970,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "8d5085360fba77b8",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "component",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "B",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "I",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "O",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "all",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1130,
        "y": 820,
        "wires": [
            [
                "306efb849d6df3d9"
            ],
            [
                "123365e1c8c710d0"
            ],
            [
                "e22b4f8b5c8ad657"
            ],
            [
                "e22b4f8b5c8ad657",
                "123365e1c8c710d0",
                "306efb849d6df3d9"
            ]
        ]
    },
    {
        "id": "8766ed8d27633676",
        "type": "ui-progress",
        "z": "0637f22188042045",
        "group": "9a2350a4f1394335",
        "name": "",
        "label": "Progress",
        "order": 3,
        "width": 3,
        "height": "1",
        "color": "",
        "className": "",
        "x": 900,
        "y": 600,
        "wires": []
    },
    {
        "id": "306efb849d6df3d9",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "field",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "osc",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ohm",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "strain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "all",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1390,
        "y": 480,
        "wires": [
            [
                "8a221b81fbf66af6",
                "c2169002f9f739b0"
            ],
            [
                "4ff63434385e91c2",
                "f10baba8d1dc3b51"
            ],
            [
                "fb2163a63962c65a",
                "db943a9a91ef3d10"
            ],
            [
                "431ed7dbddda23c1",
                "fbe36f1e226dba9c",
                "4ff63434385e91c2",
                "6535ec5645ee3d86"
            ]
        ]
    },
    {
        "id": "123365e1c8c710d0",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "field",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "osc",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ohm",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "strain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "all",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1390,
        "y": 940,
        "wires": [
            [
                "3bf7c063266c881e",
                "71af1acb608e11d5"
            ],
            [
                "1eeaac36ce803431",
                "b0a451924c10c06d"
            ],
            [
                "853b6e62af78fc23",
                "8a2fccfa807293cf"
            ],
            [
                "e60529c29388a55d",
                "afb8edb64542587a",
                "b0a451924c10c06d",
                "8020914300043d42"
            ]
        ]
    },
    {
        "id": "e22b4f8b5c8ad657",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "field",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "osc",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "ohm",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "strain",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "all",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1390,
        "y": 1340,
        "wires": [
            [
                "355c0d9ab901b821",
                "94b36821f1d1c8df"
            ],
            [
                "d78bf3b6bf078a39",
                "849047333c306cdf"
            ],
            [
                "10158d57ee57b061",
                "07fb0f9c0e03e4c1"
            ],
            [
                "41b53a65de1ae8c8",
                "00827fb8b783f10a",
                "d78bf3b6bf078a39",
                "cc61ef53d87fc729"
            ]
        ]
    },
    {
        "id": "853b6e62af78fc23",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "6f2eb3f0c9e5ca90"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1970,
        "y": 1000,
        "wires": [
            [
                "8020914300043d42"
            ]
        ]
    },
    {
        "id": "10158d57ee57b061",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "6f2eb3f0c9e5ca90"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1830,
        "y": 1480,
        "wires": [
            [
                "cc61ef53d87fc729"
            ]
        ]
    },
    {
        "id": "7949c9e9025be6c9",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "e_type",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "order",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "operator",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 290,
        "y": 280,
        "wires": [
            [],
            [
                "a7b839bc616c55da"
            ],
            [
                "90b9b323522d2ea4"
            ]
        ]
    },
    {
        "id": "a7b839bc616c55da",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "setOrder",
        "links": [
            "a70ee8adec49fb6b"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 440,
        "y": 280,
        "wires": [
            [
                "147ff6e0138cd3f0"
            ]
        ]
    },
    {
        "id": "147ff6e0138cd3f0",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "session.product.order",
                "pt": "global",
                "to": "payload.values[0]",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 670,
        "y": 280,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "1b66859a540ad827",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "result",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "invalid",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 450,
        "y": 120,
        "wires": [
            [
                "adb1841767b874f2"
            ],
            [
                "d4a4243ebe2971fd",
                "1b18b33396f8659c"
            ]
        ]
    },
    {
        "id": "adb1841767b874f2",
        "type": "template",
        "z": "0637f22188042045",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Input error: Product undefined!\nCheck features in settings page.",
        "output": "str",
        "x": 600,
        "y": 80,
        "wires": [
            [
                "9219cb1ab5ee34fc"
            ]
        ]
    },
    {
        "id": "903ba0d996bcb9d8",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "setProduct",
        "links": [
            "4b73052aac644e5f"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 830,
        "y": 140,
        "wires": [
            [
                "337ebe561ce901c5"
            ]
        ]
    },
    {
        "id": "d4a4243ebe2971fd",
        "type": "change",
        "z": "0637f22188042045",
        "name": "set session features",
        "rules": [
            {
                "t": "set",
                "p": "session.features",
                "pt": "global",
                "to": "result",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "session.product.type",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 620,
        "y": 140,
        "wires": [
            [
                "903ba0d996bcb9d8"
            ]
        ]
    },
    {
        "id": "337ebe561ce901c5",
        "type": "link out",
        "z": "0637f22188042045",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "3d64c50fa540eed8"
        ],
        "x": 945,
        "y": 140,
        "wires": []
    },
    {
        "id": "1b18b33396f8659c",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 160,
        "y": 160,
        "wires": [
            [
                "31b312cbae942fc4"
            ]
        ]
    },
    {
        "id": "afb8edb64542587a",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "bf198eb6e69ac543",
        "name": "osc",
        "label": "",
        "order": 2,
        "chartType": "line",
        "category": "[\"a\", \"b\"]",
        "categoryType": "json",
        "xAxisLabel": "time [ms]",
        "xAxisProperty": "timestamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "ohm",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 2170,
        "y": 800,
        "wires": [
            []
        ]
    },
    {
        "id": "00827fb8b783f10a",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "3378c67758bc3e77",
        "name": "osc",
        "label": "",
        "order": 2,
        "chartType": "line",
        "category": "[\"a\", \"b\"]",
        "categoryType": "json",
        "xAxisLabel": "time [ms]",
        "xAxisProperty": "timestamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "ohm",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 2150,
        "y": 1300,
        "wires": [
            []
        ]
    },
    {
        "id": "355c0d9ab901b821",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "graph",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1840,
        "y": 1300,
        "wires": [
            [
                "97b3790a6d625b96"
            ]
        ]
    },
    {
        "id": "3bf7c063266c881e",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "graph",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1860,
        "y": 800,
        "wires": [
            [
                "45de40a2c877ff2f"
            ]
        ]
    },
    {
        "id": "683dc6e49ca1f856",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "result",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "invalid",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 790,
        "y": 420,
        "wires": [
            [
                "0d104c1ae4779704"
            ],
            [
                "285059415ba49c5d"
            ]
        ]
    },
    {
        "id": "285059415ba49c5d",
        "type": "change",
        "z": "0637f22188042045",
        "name": "set session features",
        "rules": [
            {
                "t": "set",
                "p": "session.features",
                "pt": "global",
                "to": "result",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "session.product.type",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 960,
        "y": 420,
        "wires": [
            [
                "93927a51db297807"
            ]
        ]
    },
    {
        "id": "8a221b81fbf66af6",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "graph",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "delete",
                "p": "graph",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1620,
        "y": 340,
        "wires": [
            [
                "bf988939f0eb35f2"
            ]
        ]
    },
    {
        "id": "bf988939f0eb35f2",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "5a97b52d1b69900a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1790,
        "y": 340,
        "wires": [
            [
                "431ed7dbddda23c1"
            ]
        ]
    },
    {
        "id": "cf234364c43a34f8",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "outer osc",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.7.osc",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "osc",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 240,
        "y": 460,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "b0a451924c10c06d",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "bf198eb6e69ac543",
        "name": "Ohmmeter",
        "label": "",
        "order": 3,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "X axis",
        "xAxisProperty": "timeStamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "ohm",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 2130,
        "y": 1080,
        "wires": [
            []
        ]
    },
    {
        "id": "97b3790a6d625b96",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "5a97b52d1b69900a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2010,
        "y": 1300,
        "wires": [
            [
                "00827fb8b783f10a"
            ]
        ]
    },
    {
        "id": "45de40a2c877ff2f",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "5a97b52d1b69900a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2030,
        "y": 800,
        "wires": [
            [
                "afb8edb64542587a"
            ]
        ]
    },
    {
        "id": "8a2fccfa807293cf",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "5a97b52d1b69900a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1830,
        "y": 1120,
        "wires": [
            [
                "e60529c29388a55d"
            ]
        ]
    },
    {
        "id": "07fb0f9c0e03e4c1",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "5a97b52d1b69900a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1830,
        "y": 1640,
        "wires": [
            [
                "41b53a65de1ae8c8"
            ]
        ]
    },
    {
        "id": "30ce2e13ee66ed32",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "outer strain",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.7.plc.values",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "strain",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 240,
        "y": 500,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "98cb8635c470c413",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "button strain",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.0.plc.values",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "strain",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 250,
        "y": 380,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "bccca76e7ee582a9",
        "type": "function",
        "z": "0637f22188042045",
        "name": "chart options -dataZoom",
        "func": "const ui_update = msg.ui_update ?? {}\nconst chartOptions = ui_update.chartOptions ?? {}\nconst add = {\n    dataZoom: {\n        type: 'inside'\n    }\n}\n\nObject.assign(chartOptions, add)\nui_update.chartOptions = chartOptions;\nmsg.ui_update = ui_update;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 880,
        "wires": [
            [
                "8d5085360fba77b8"
            ]
        ]
    },
    {
        "id": "96db3978031895b7",
        "type": "ui-button",
        "z": "0637f22188042045",
        "group": "38ddce4a31197555",
        "name": "",
        "label": "Result",
        "order": 1,
        "width": 2,
        "height": 3,
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "big_text",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 690,
        "y": 1220,
        "wires": [
            []
        ]
    },
    {
        "id": "667dfded88646090",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "case ohm",
        "property": "field",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ohm",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 680,
        "y": 800,
        "wires": [
            [
                "2d485e7378541c14"
            ],
            [
                "694442544535cd79"
            ]
        ]
    },
    {
        "id": "d78bf3b6bf078a39",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "3378c67758bc3e77",
        "name": "Ohmmeter",
        "label": "",
        "order": 3,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "X axis",
        "xAxisProperty": "timeStamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "ohm",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 2130,
        "y": 1640,
        "wires": [
            []
        ]
    },
    {
        "id": "2d485e7378541c14",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "process ohm",
        "links": [
            "79c07bea4075b2c3"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 830,
        "y": 760,
        "wires": [
            [
                "694442544535cd79"
            ]
        ]
    },
    {
        "id": "4ff63434385e91c2",
        "type": "ui-chart",
        "z": "0637f22188042045",
        "group": "89a4f69b951b98f3",
        "name": "Ohmmeter",
        "label": "",
        "order": 3,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "X axis",
        "xAxisProperty": "timeStamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "ohm",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "append",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": 2,
        "height": 3,
        "className": "",
        "interpolation": "smooth",
        "x": 1790,
        "y": 580,
        "wires": [
            []
        ]
    },
    {
        "id": "fb2163a63962c65a",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "5a97b52d1b69900a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1610,
        "y": 620,
        "wires": [
            [
                "fbe36f1e226dba9c"
            ]
        ]
    },
    {
        "id": "70caadcea072777c",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "check product",
        "links": [
            "00926f7c3cf1f2f8"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 760,
        "y": 460,
        "wires": [
            [
                "683dc6e49ca1f856"
            ]
        ]
    },
    {
        "id": "014a23b36f2b2e80",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "check product",
        "links": [
            "00926f7c3cf1f2f8"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 300,
        "y": 120,
        "wires": [
            [
                "1b66859a540ad827",
                "d984f1c52bbb7a42"
            ]
        ]
    },
    {
        "id": "93927a51db297807",
        "type": "link out",
        "z": "0637f22188042045",
        "name": "outFeaturesSet",
        "mode": "link",
        "links": [
            "afa681053145fae2"
        ],
        "x": 1095,
        "y": 420,
        "wires": []
    },
    {
        "id": "1eeaac36ce803431",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "67ce2bb6658b16a1"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1970,
        "y": 960,
        "wires": [
            [
                "8020914300043d42"
            ]
        ]
    },
    {
        "id": "036776c9dc73207b",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "inner ohm A",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.2.ohm",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "ohm",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 250,
        "y": 540,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "cefe10bd2b4ddd80",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "inner ohm B",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.3.ohm",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "ohm",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 250,
        "y": 580,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "71af1acb608e11d5",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "56c8c62de4c7044f"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1980,
        "y": 920,
        "wires": [
            [
                "8020914300043d42"
            ]
        ]
    },
    {
        "id": "e18e6c29929170ba",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "inner osc",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.4.osc",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "osc",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 240,
        "y": 620,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "849047333c306cdf",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "67ce2bb6658b16a1"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1830,
        "y": 1440,
        "wires": [
            [
                "cc61ef53d87fc729"
            ]
        ]
    },
    {
        "id": "94b36821f1d1c8df",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "56c8c62de4c7044f"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1840,
        "y": 1400,
        "wires": [
            [
                "cc61ef53d87fc729"
            ]
        ]
    },
    {
        "id": "13e1a51b2ebcf21c",
        "type": "ui-table",
        "z": "0637f22188042045",
        "group": "3378c67758bc3e77",
        "name": "Results",
        "label": "",
        "order": 4,
        "width": 4,
        "height": "",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "Measurement",
                "key": "label",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Status",
                "key": "result",
                "keyType": "key",
                "type": "tickcross",
                "width": "",
                "align": "start"
            },
            {
                "title": "Lower limit",
                "key": "lower",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Value",
                "key": "value",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Upper limit",
                "key": "upper",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "append",
        "className": "",
        "x": 2360,
        "y": 1400,
        "wires": [
            []
        ]
    },
    {
        "id": "247148b3adf6b567",
        "type": "ui-table",
        "z": "0637f22188042045",
        "group": "bf198eb6e69ac543",
        "name": "Results",
        "label": "",
        "order": 4,
        "width": 4,
        "height": "",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "Measurement",
                "key": "label",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Status",
                "key": "result",
                "keyType": "key",
                "type": "tickcross",
                "width": "",
                "align": "start"
            },
            {
                "title": "Lower limit",
                "key": "lower",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Value",
                "key": "value",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Upper limit",
                "key": "upper",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "append",
        "className": "",
        "x": 2360,
        "y": 920,
        "wires": [
            []
        ]
    },
    {
        "id": "ce29f9e1a0795538",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "inner strain",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "path",
                "v": "stage_data.4.plc.values",
                "vt": "str"
            },
            {
                "p": "field",
                "v": "strain",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "data",
        "x": 240,
        "y": 660,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "6fa6c107ae8efe85",
        "type": "function",
        "z": "0637f22188042045",
        "name": "simulate",
        "func": "if (!context.get(\"disabled\")) {\n    context.set(\"disabled\", true);\n    node.status({ text: \"started\" });\n    global.set(\"session.process.stages.active\", 0);\n    node.send(msg);\n    \n    const data = global.get(\"sim\");\n    global.set(\"stage_data\", data);\n    const dict = {\n        \"S\": {\n            path: \"osc\",\n            field: \"osc\",\n        },\n        \"H\": {\n            path: \"ohm\",\n            field: \"ohm\"\n        }\n    }\n    const send = {\n        topic: \"data\"\n    }\n    const cnt = Object.keys(data).length * 2;\n    var i = 0\n\n    let intervalId = setInterval(sim, 1000)\n\n    function sim() {\n        const j = Math.floor(i / 2);\n        const sel = i % 2;\n        node.status({ fill: \"red\", shape: \"ring\", text: `simulating ${j}:${sel}` });\n\n        switch (sel) {\n            case 0:\n                send.path = `stage_data.${j}.plc.values`;\n                send.field = \"strain\";\n                node.send(send);\n                break;\n            case 1:\n                global.set(\"session.process.stages.active\", j);\n                const type = data[j].plc.setup.measurement;\n                send.path = `stage_data.${j}.` + dict[type].path;\n                send.field = dict[type].field;\n                node.send(send);\n                break;\n        }\n\n        i++;\n        if (i >= cnt) {\n            clearInterval(intervalId);\n            intervalId = null;\n            node.done();\n            node.status({ fill: \"green\", shape: \"dot\", text: \"done\" });\n            context.set(\"disabled\", false);\n        }\n    }\n\n} else {\n    node.status({ fill: \"yellow\", shape: \"ring\", text: \"disabled\" });\n}\n\n\n\nreturn;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 260,
        "y": 800,
        "wires": [
            [
                "937d7b67602d88ba"
            ]
        ]
    },
    {
        "id": "69b6dbe76684d3ac",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            },
            {
                "p": "sim",
                "v": "true",
                "vt": "bool"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "productData",
        "x": 110,
        "y": 800,
        "wires": [
            [
                "6fa6c107ae8efe85"
            ]
        ]
    },
    {
        "id": "0eac7f2727c502b3",
        "type": "ui-table",
        "z": "0637f22188042045",
        "group": "89a4f69b951b98f3",
        "name": "Results",
        "label": "",
        "order": 4,
        "width": 4,
        "height": "",
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "Measurement",
                "key": "label",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Status",
                "key": "result",
                "keyType": "key",
                "type": "tickcross",
                "width": "",
                "align": "start"
            },
            {
                "title": "Lower limit",
                "key": "lower",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Value",
                "key": "value",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Upper limit",
                "key": "upper",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "append",
        "className": "",
        "x": 2000,
        "y": 460,
        "wires": [
            []
        ]
    },
    {
        "id": "c2169002f9f739b0",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "bb9409d2a0b115aa"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1700,
        "y": 460,
        "wires": [
            [
                "6535ec5645ee3d86"
            ]
        ]
    },
    {
        "id": "f10baba8d1dc3b51",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "67ce2bb6658b16a1"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1690,
        "y": 500,
        "wires": [
            [
                "6535ec5645ee3d86"
            ]
        ]
    },
    {
        "id": "0d104c1ae4779704",
        "type": "template",
        "z": "0637f22188042045",
        "name": "",
        "field": "payload",
        "fieldType": "msg",
        "format": "handlebars",
        "syntax": "mustache",
        "template": "Input error: Product error!\nCheck PLC product selection.",
        "output": "str",
        "x": 920,
        "y": 380,
        "wires": [
            [
                "36be27abe7646662"
            ]
        ]
    },
    {
        "id": "36be27abe7646662",
        "type": "link out",
        "z": "0637f22188042045",
        "name": "outProdErr",
        "mode": "link",
        "links": [
            "2c9f6f19ec5c61f5"
        ],
        "x": 1015,
        "y": 380,
        "wires": []
    },
    {
        "id": "2c9f6f19ec5c61f5",
        "type": "link in",
        "z": "0637f22188042045",
        "name": "inErrPopup",
        "links": [
            "9219cb1ab5ee34fc",
            "36be27abe7646662"
        ],
        "x": 1195,
        "y": 40,
        "wires": [
            [
                "b9195f648eb6d99b"
            ]
        ]
    },
    {
        "id": "9219cb1ab5ee34fc",
        "type": "link out",
        "z": "0637f22188042045",
        "name": "outProdErr",
        "mode": "link",
        "links": [
            "2c9f6f19ec5c61f5"
        ],
        "x": 705,
        "y": 80,
        "wires": []
    },
    {
        "id": "db943a9a91ef3d10",
        "type": "link call",
        "z": "0637f22188042045",
        "name": "",
        "links": [
            "c9b9a5158a951c7a"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1690,
        "y": 540,
        "wires": [
            [
                "6535ec5645ee3d86"
            ]
        ]
    },
    {
        "id": "94317c601856da8b",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "reset",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 230,
        "y": 1220,
        "wires": [
            [
                "033358371fd9f7db"
            ]
        ]
    },
    {
        "id": "033358371fd9f7db",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update",
                "pt": "msg",
                "to": "{\"buttonColor\":\"#a0a0a0\",\"label\":\"Testing...\"}",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 1220,
        "wires": [
            [
                "96db3978031895b7"
            ]
        ]
    },
    {
        "id": "45582da0e79a1e77",
        "type": "function",
        "z": "0637f22188042045",
        "name": "final status",
        "func": "const result = global.get(\"result\");\n\nif(result.evaluations === result.passes){\n    msg.topic = \"pass\";\n    msg.ui_update = {\n        buttonColor: \"green\",\n        label: \"PASS\",\n    }\n} else {\n    msg.topic = \"fail\";\n    msg.ui_update = {\n        buttonColor: \"red\",\n        label: \"FAIL\",\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 530,
        "y": 1180,
        "wires": [
            [
                "96db3978031895b7",
                "3aa0b64653eda525"
            ]
        ]
    },
    {
        "id": "71b166778f546dd1",
        "type": "switch",
        "z": "0637f22188042045",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "gte",
                "v": "100",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 230,
        "y": 1180,
        "wires": [
            [
                "fb2ed88808b50d9e"
            ]
        ]
    },
    {
        "id": "fb2ed88808b50d9e",
        "type": "delay",
        "z": "0637f22188042045",
        "name": "",
        "pauseType": "delay",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 360,
        "y": 1180,
        "wires": [
            [
                "45582da0e79a1e77",
                "a4cc879c4d28527a"
            ]
        ]
    },
    {
        "id": "dfdd8bbb6c0cfb21",
        "type": "inject",
        "z": "0637f22188042045",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 340,
        "y": 1120,
        "wires": [
            [
                "45582da0e79a1e77"
            ]
        ]
    },
    {
        "id": "e1698367414bdec3",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "result.passes",
                "pt": "global",
                "to": "11",
                "tot": "num"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 610,
        "y": 1060,
        "wires": [
            [
                "45582da0e79a1e77"
            ]
        ]
    },
    {
        "id": "d984f1c52bbb7a42",
        "type": "debug",
        "z": "0637f22188042045",
        "name": "debug 10",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 460,
        "y": 60,
        "wires": []
    },
    {
        "id": "eb24925af8cfb7a4",
        "type": "change",
        "z": "0637f22188042045",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.type",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 760,
        "y": 500,
        "wires": [
            [
                "70caadcea072777c"
            ]
        ]
    },
    {
        "id": "47babeaec6ba982e",
        "type": "debug",
        "z": "0ba5db83a2227bb8",
        "name": "debug 16",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 740,
        "y": 240,
        "wires": []
    },
    {
        "id": "4a04139635ab3faf",
        "type": "ui-chart",
        "z": "0ba5db83a2227bb8",
        "group": "8c7f35716465254a",
        "name": "",
        "label": "",
        "order": 1,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "",
        "xAxisProperty": "x",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "y",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "12",
        "height": "5",
        "className": "",
        "interpolation": "linear",
        "x": 900,
        "y": 500,
        "wires": [
            []
        ]
    },
    {
        "id": "92869e08978834b2",
        "type": "ui-button",
        "z": "0ba5db83a2227bb8",
        "group": "3ebbad412a47acd4",
        "name": "",
        "label": "Calculate",
        "order": 2,
        "width": 0,
        "height": 0,
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "iconPosition": "left",
        "payload": "[]",
        "payloadType": "json",
        "topic": "marius",
        "topicType": "str",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 300,
        "y": 540,
        "wires": [
            [
                "7fcefdf3c5186bb0"
            ]
        ]
    },
    {
        "id": "7fcefdf3c5186bb0",
        "type": "function",
        "z": "0ba5db83a2227bb8",
        "name": "function 1",
        "func": "const ret = [{}, {}, {}];\n\nconst math = global.get(\"mathjs\");\nconst data = global.get(\"stage_data.2.plc.values\");\n\nswitch (msg.topic) {\n    case \"coef\":\n        context.set(\"coef\", msg.payload);\n        break;\n    case \"ind\":\n        context.set(\"ind\", msg.payload);\n        break;\n    default:\n        ret[0].payload = data.map(function (d) {\n            return { x: d.timeStamp, y: d.strain };\n        });\n\n        const fft = math.fft(data.map((d) => d.strain));\n\n        ret[2].payload = fft.map(function (d, i) {\n            return { re: d.re, im: d.im, x: i }\n        })\n        ret[2].topic = [\"re\", \"im\"];\n\n        const ind = context.get(\"ind\");\n        const coef = context.get(\"coef\");\n        fft[ind].re *= coef;\n        fft[ind].im *= coef;\n\n        if(ind === 0 && coef === 0) {\n            fft.forEach(function(e,i) {\n                if(i > 0 && i < 200) {\n                    fft[i].re *= 0.01;\n                    fft[i].im *= 0.01;\n                }\n            });\n        };\n\n\n        const ifft = math.ifft(fft);  /*fft.map((t) => t.re) */\n\n        ret[1].payload = ifft.map(function (d, i) {\n            return { y: d.re, x: ret[0].payload[i].x }\n        })\n\n}\n\nreturn ret;",
        "outputs": 3,
        "timeout": 0,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\ncontext.set(\"coef\", 0);\ncontext.set(\"ind\", 1);\n",
        "finalize": "",
        "libs": [],
        "x": 500,
        "y": 540,
        "wires": [
            [
                "47babeaec6ba982e",
                "efcb46c5edea9ad6"
            ],
            [
                "47babeaec6ba982e",
                "c10dee6c0c89b16c"
            ],
            [
                "d02e161b8645405f",
                "47babeaec6ba982e"
            ]
        ]
    },
    {
        "id": "1544c5e22844d7ee",
        "type": "ui-chart",
        "z": "0ba5db83a2227bb8",
        "group": "8c7f35716465254a",
        "name": "",
        "label": "",
        "order": 2,
        "chartType": "line",
        "category": "",
        "categoryType": "none",
        "xAxisLabel": "",
        "xAxisProperty": "x",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "y",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "12",
        "height": "5",
        "className": "",
        "interpolation": "linear",
        "x": 900,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "efcb46c5edea9ad6",
        "type": "function",
        "z": "0ba5db83a2227bb8",
        "name": "chart options -dataZoom",
        "func": "const ui_update = msg.ui_update ?? {}\nconst chartOptions = ui_update.chartOptions ?? {}\nconst add = {\n    dataZoom: {\n        type: 'inside'\n    }\n}\n\nObject.assign(chartOptions, add)\nui_update.chartOptions = chartOptions;\nmsg.ui_update = Object.assign(ui_update, chartOptions)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 460,
        "wires": [
            [
                "4a04139635ab3faf"
            ]
        ]
    },
    {
        "id": "c10dee6c0c89b16c",
        "type": "function",
        "z": "0ba5db83a2227bb8",
        "name": "chart options -dataZoom",
        "func": "const ui_update = msg.ui_update ?? {}\nconst chartOptions = ui_update.chartOptions ?? {}\nconst add = {\n    dataZoom: {\n        type: 'inside'\n    }\n}\n\nObject.assign(chartOptions, add)\nui_update.chartOptions = chartOptions;\nmsg.ui_update = Object.assign(ui_update, chartOptions)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 600,
        "wires": [
            [
                "1544c5e22844d7ee"
            ]
        ]
    },
    {
        "id": "a9999bc228ac6113",
        "type": "ui-chart",
        "z": "0ba5db83a2227bb8",
        "group": "8c7f35716465254a",
        "name": "",
        "label": "",
        "order": 3,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "x",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "y",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "12",
        "height": "5",
        "className": "",
        "interpolation": "linear",
        "x": 900,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "d02e161b8645405f",
        "type": "function",
        "z": "0ba5db83a2227bb8",
        "name": "chart options -dataZoom",
        "func": "const ui_update = msg.ui_update ?? {}\nconst chartOptions = ui_update.chartOptions ?? {}\nconst add = {\n    dataZoom: {\n        type: 'inside'\n    }\n}\n\nObject.assign(chartOptions, add)\nui_update.chartOptions = chartOptions;\nmsg.ui_update = Object.assign(ui_update, chartOptions)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 910,
        "y": 700,
        "wires": [
            [
                "a9999bc228ac6113"
            ]
        ]
    },
    {
        "id": "af3104f9069cf2c5",
        "type": "ui-number-input",
        "z": "0ba5db83a2227bb8",
        "group": "3ebbad412a47acd4",
        "name": "",
        "label": "FFT index",
        "order": 3,
        "width": 0,
        "height": 0,
        "topic": "ind",
        "topicType": "str",
        "min": 0,
        "max": "499",
        "step": 1,
        "tooltip": "",
        "passthru": true,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "icon": "",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "spinner": "default",
        "x": 300,
        "y": 460,
        "wires": [
            [
                "7fcefdf3c5186bb0"
            ]
        ]
    },
    {
        "id": "e9c94eb1bb4d9827",
        "type": "ui-number-input",
        "z": "0ba5db83a2227bb8",
        "group": "3ebbad412a47acd4",
        "name": "",
        "label": "FFT coef",
        "order": 1,
        "width": 0,
        "height": 0,
        "topic": "coef",
        "topicType": "str",
        "min": 0,
        "max": "10",
        "step": "0.01",
        "tooltip": "",
        "passthru": true,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "icon": "",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "spinner": "default",
        "x": 300,
        "y": 500,
        "wires": [
            [
                "7fcefdf3c5186bb0"
            ]
        ]
    },
    {
        "id": "93ee2f1602a0ed6c",
        "type": "ui-form",
        "z": "85a0c31e48c798bf",
        "name": "",
        "group": "26cc4e226e9df6bb",
        "label": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "From",
                "key": "from",
                "type": "date",
                "required": false,
                "rows": null
            },
            {
                "label": "To",
                "key": "to",
                "type": "date",
                "required": false,
                "rows": null
            },
            {
                "label": "Type",
                "key": "type",
                "type": "dropdown",
                "required": false,
                "rows": null
            },
            {
                "label": "Order",
                "key": "order",
                "type": "dropdown",
                "required": false,
                "rows": null
            }
        ],
        "formValue": {
            "from": "",
            "to": "",
            "type": "",
            "order": ""
        },
        "payload": "",
        "submit": "search",
        "cancel": "clear",
        "resetOnSubmit": false,
        "topic": "queryForm",
        "topicType": "str",
        "splitLayout": true,
        "className": "",
        "passthru": false,
        "dropdownOptions": [],
        "x": 350,
        "y": 460,
        "wires": [
            [
                "87ccc1ce19e89219"
            ]
        ]
    },
    {
        "id": "3bb054fda693b6bd",
        "type": "ui-button",
        "z": "85a0c31e48c798bf",
        "group": "26cc4e226e9df6bb",
        "name": "",
        "label": "Update types",
        "order": 1,
        "width": 0,
        "height": 0,
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "topic",
        "topicType": "msg",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 110,
        "y": 380,
        "wires": [
            [
                "a41d6d9c4686dbfe"
            ]
        ]
    },
    {
        "id": "c8641b6d0e0d5594",
        "type": "link call",
        "z": "85a0c31e48c798bf",
        "name": "call_database",
        "links": [
            "09d2343f773e9140"
        ],
        "linkType": "static",
        "timeout": "10",
        "x": 640,
        "y": 460,
        "wires": [
            [
                "87b37c9dbbfa572a",
                "c255229e7db1d672",
                "14509f6701be1fc6"
            ]
        ]
    },
    {
        "id": "87ccc1ce19e89219",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "find",
        "func": "const query = { }\n\naddIfDefined(msg.payload.from, \"timestamp\", \"$gt\")\naddIfDefined(msg.payload.to, \"timestamp\", \"$lt\")\naddIfDefined(msg.payload.type, \"type\")\naddIfDefined(msg.payload.order, \"order\")\n\nmsg.operation = \"find\"\n\nmsg.payload = [query]\n\nreturn msg;\n\nfunction addIfDefined(value, attr, op = \"\", q = query) {\n    if (value !== \"\") {\n        if (op !== \"\") {\n            Object.assign(q, {[attr] : { [op] : value }})       \n        } else \n        q[attr] = value\n    }\n    return \n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 470,
        "y": 460,
        "wires": [
            [
                "c8641b6d0e0d5594"
            ]
        ]
    },
    {
        "id": "c255229e7db1d672",
        "type": "ui-table",
        "z": "85a0c31e48c798bf",
        "group": "26cc4e226e9df6bb",
        "name": "",
        "label": "Search results",
        "order": 3,
        "width": 0,
        "height": 0,
        "maxrows": "20",
        "passthru": false,
        "autocols": false,
        "showSearch": true,
        "deselect": true,
        "selectionType": "click",
        "columns": [
            {
                "title": "Type",
                "key": "type",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Order",
                "key": "order",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Time of testing",
                "key": "timestamp",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "",
        "mobileBreakpointType": "none",
        "action": "replace",
        "className": "",
        "x": 860,
        "y": 460,
        "wires": [
            [
                "a549655cd4b8fa9d",
                "52278dc01e9440cb"
            ]
        ]
    },
    {
        "id": "a41d6d9c4686dbfe",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[[\"type\"],[\"order\"]]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "operation",
                "pt": "msg",
                "to": "distinct",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 360,
        "y": 380,
        "wires": [
            [
                "dbbc43243a23dcb9"
            ]
        ]
    },
    {
        "id": "c167b05807886994",
        "type": "link call",
        "z": "85a0c31e48c798bf",
        "name": "call_database",
        "links": [
            "09d2343f773e9140"
        ],
        "linkType": "static",
        "timeout": "10",
        "x": 700,
        "y": 380,
        "wires": [
            [
                "254a6ad072de36cf"
            ]
        ]
    },
    {
        "id": "2d214b273b88755f",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update.dropdownOptions",
                "pt": "msg",
                "to": "[\t    $map(msg.payload[0], function($x) {{\"dropdown\":\"type\",\"value\":$x,\"label\":$x}}),\t    $map(msg.payload[1], function($x) {{\"dropdown\":\"order\",\"value\":$x,\"label\":$x}})\t]\t\t",
                "tot": "jsonata"
            },
            {
                "t": "delete",
                "p": "payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1040,
        "y": 380,
        "wires": [
            [
                "93ee2f1602a0ed6c"
            ]
        ]
    },
    {
        "id": "dbbc43243a23dcb9",
        "type": "split",
        "z": "85a0c31e48c798bf",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": 1,
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "property": "payload",
        "x": 530,
        "y": 380,
        "wires": [
            [
                "c167b05807886994"
            ]
        ]
    },
    {
        "id": "254a6ad072de36cf",
        "type": "join",
        "z": "85a0c31e48c798bf",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": false,
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 870,
        "y": 380,
        "wires": [
            [
                "2d214b273b88755f"
            ]
        ]
    },
    {
        "id": "6acc34f68fe7d1e1",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update.options",
                "pt": "msg",
                "to": "$map(\t   msg.payload.stage_results,\t   function($x) {{\"value\":$x.*,\"label\":$keys($x)}} \t)\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 440,
        "wires": [
            [
                "f144de5ed2e31ac4"
            ]
        ]
    },
    {
        "id": "a549655cd4b8fa9d",
        "type": "switch",
        "z": "85a0c31e48c798bf",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "hask",
                "v": "stage_results",
                "vt": "str"
            },
            {
                "t": "hask",
                "v": "stage_data",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 1010,
        "y": 460,
        "wires": [
            [
                "6acc34f68fe7d1e1"
            ],
            [
                "4662a75cd903356a"
            ],
            [
                "87b37c9dbbfa572a"
            ]
        ]
    },
    {
        "id": "f144de5ed2e31ac4",
        "type": "ui-button-group",
        "z": "85a0c31e48c798bf",
        "name": "",
        "group": "08a4c47b7bced26d",
        "order": 1,
        "width": "4",
        "height": "2",
        "label": "Select stage",
        "className": "",
        "rounded": true,
        "useThemeColors": true,
        "passthru": false,
        "options": [
            {
                "label": "",
                "icon": "",
                "value": "option_0",
                "valueType": "str",
                "color": "#009933"
            },
            {
                "label": "",
                "icon": "",
                "value": "option_1",
                "valueType": "str",
                "color": "#999999"
            }
        ],
        "topic": "topic",
        "topicType": "msg",
        "x": 1410,
        "y": 460,
        "wires": [
            [
                "585297eb4357824b"
            ]
        ]
    },
    {
        "id": "f8d736e68bd97453",
        "type": "ui-table",
        "z": "85a0c31e48c798bf",
        "group": "08a4c47b7bced26d",
        "name": "stage setup",
        "label": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "maxrows": 0,
        "passthru": false,
        "autocols": true,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [],
        "mobileBreakpoint": "",
        "mobileBreakpointType": "none",
        "action": "replace",
        "className": "",
        "x": 2570,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "988021bccfb44b4c",
        "type": "switch",
        "z": "85a0c31e48c798bf",
        "name": "",
        "property": "payload.setup",
        "propertyType": "msg",
        "rules": [
            {
                "t": "istype",
                "v": "array",
                "vt": "array"
            },
            {
                "t": "hask",
                "v": "component",
                "vt": "str"
            },
            {
                "t": "istype",
                "v": "object",
                "vt": "object"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 4,
        "x": 1590,
        "y": 460,
        "wires": [
            [
                "a7643881722cd6bd"
            ],
            [
                "97271c1ee68ea070"
            ],
            [
                "eaa1836fdd4f1616"
            ],
            [
                "f23cd05e36b04a28"
            ]
        ]
    },
    {
        "id": "a7643881722cd6bd",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "get_time_series",
        "func": "const series = []\nconst stage = {}\nconst comp = msg.payload.setup[0]\nconst meas = msg.payload.setup[1]\nconst dict = {\n    component: {\n        label: \"Component\",\n        \"B\": \"Button\",\n        \"I\": \"Inner shaft\",\n        \"O\": \"Outer shaft\"\n    },\n    measurement: {\n        label: \"Measurement\",\n        \"H\": \"Ohmmeter\",\n        \"S\": \"Oscilloscope\"\n    },\n    special: {\n        \"B\": \"Press count\",\n        \"I\": \"Channel\",\n        \"O\": \"Channel\"\n    },\n    displacement:{\n        \"B\": \"Press distance\",\n        \"I\": \"Rotations\",\n        \"O\": \"Rotations\"\n    },\n    velocity:{\n        \"B\": \"Press speed\",\n        \"I\": \"Rpm\",\n        \"O\": \"Rpm\"\n    }\n\n}\n\nconst header = [\n        \"component\",\n        \"measurement\",\n        \"special\",\n        \"special\",\n        \"displacement\",\n        \"velocity\"\n]\n\nmsg.payload.setup.forEach(function(element, index) {\n    switch (index) {\n        case 0:\n        case 1:\n            stage[`${dict[header[index]].label}`] = dict[`${header[index]}`][`${element}`];\n            break; \n        case 3:\n            if (comp !== \"B\") break;\n        case 2:\n        case 4:\n        case 5:\n            stage[`${dict[header[index]][comp]}`] = element;\n            break;\n    }\n});\n\nmsg.payload.values[1].forEach(function (element) {\n    const row ={}\n    element.forEach(function(e, i) {\n        row[`${msg.payload.values[0][i]}`] = e\n    });\n    series.push(row)\n});\n\nmsg.payload.series = series.slice(0, -1)\nmsg.payload.stage = stage\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 400,
        "wires": [
            [
                "03cf50641a8c630c"
            ]
        ]
    },
    {
        "id": "03cf50641a8c630c",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "currentStage",
                "pt": "flow",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1980,
        "y": 420,
        "wires": [
            [
                "4d673a36ae5f87dd",
                "86d627a20f38b280"
            ]
        ]
    },
    {
        "id": "eaa1836fdd4f1616",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "get_osc_data",
        "func": "const stage = {}\n\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 560,
        "wires": [
            [
                "1798016310ef2c57"
            ]
        ]
    },
    {
        "id": "4d673a36ae5f87dd",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "currentStage.stage",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2200,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "20542ba1e7f761a4",
        "type": "ui-table",
        "z": "85a0c31e48c798bf",
        "group": "08a4c47b7bced26d",
        "name": "values",
        "label": "",
        "order": 3,
        "width": 0,
        "height": 0,
        "maxrows": 0,
        "passthru": false,
        "autocols": true,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [],
        "mobileBreakpoint": "",
        "mobileBreakpointType": "none",
        "action": "replace",
        "className": "",
        "x": 2550,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "86d627a20f38b280",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "currentStage.series",
                "tot": "flow",
                "dc": true
            },
            {
                "t": "set",
                "p": "view",
                "pt": "msg",
                "to": "view",
                "tot": "flow",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2200,
        "y": 400,
        "wires": [
            [
                "9ecfe569bfcf333a"
            ]
        ]
    },
    {
        "id": "87b37c9dbbfa572a",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "reset_tables",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "[]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 520,
        "wires": [
            [
                "10bab48e7c420909",
                "f144de5ed2e31ac4"
            ]
        ]
    },
    {
        "id": "10bab48e7c420909",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outResetTable",
        "mode": "link",
        "links": [
            "8f253266627cbfa4",
            "c35c9c2d338283df"
        ],
        "x": 1305,
        "y": 520,
        "wires": []
    },
    {
        "id": "8f253266627cbfa4",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inStageSetup",
        "links": [
            "10bab48e7c420909",
            "21a8c894e9bc4a6a"
        ],
        "x": 2325,
        "y": 220,
        "wires": [
            [
                "f8d736e68bd97453"
            ]
        ]
    },
    {
        "id": "1798016310ef2c57",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "currentOsc",
                "pt": "flow",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1950,
        "y": 560,
        "wires": [
            [
                "b57ec2c2be269038",
                "b195258165790965"
            ]
        ]
    },
    {
        "id": "b57ec2c2be269038",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "currentOsc.setup",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2160,
        "y": 520,
        "wires": [
            []
        ]
    },
    {
        "id": "b195258165790965",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "currentOsc.values",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2160,
        "y": 560,
        "wires": [
            []
        ]
    },
    {
        "id": "37a7f15b42e4d3ad",
        "type": "ui-chart",
        "z": "85a0c31e48c798bf",
        "group": "5f03761aafa114cc",
        "name": "",
        "label": "collated, normalized",
        "order": 2,
        "chartType": "line",
        "category": "series",
        "categoryType": "msg",
        "xAxisLabel": "X axis",
        "xAxisProperty": "x",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "series[0]",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "5",
        "height": "5",
        "className": "",
        "interpolation": "smooth",
        "x": 2620,
        "y": 940,
        "wires": [
            []
        ]
    },
    {
        "id": "9d01def7b3b6be1d",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "extract",
                "pt": "msg",
                "to": "[\"\", \"strain\"]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2540,
        "y": 560,
        "wires": [
            [
                "e670ae406f1e73af"
            ]
        ]
    },
    {
        "id": "36a53855fcf46dba",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "extract",
                "pt": "msg",
                "to": "[\"ohm\", \"strain\", \"position\"]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2540,
        "y": 520,
        "wires": [
            [
                "e670ae406f1e73af"
            ]
        ]
    },
    {
        "id": "e670ae406f1e73af",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "extract_and_normalize",
        "func": "const math = global.get('mathjs')\n\nmsg.extract.filter((v) => v !== \"\").forEach(function(attr) {\n\n    const extract = msg.payload.filter(v => v[attr] !== undefined).map(v => v[attr])\n\n    if (extract.length > 1) {\n\n        const normed = normalize(extract)\n\n        msg.payload.forEach(function (el, i) {\n            el[attr] = normed[i]\n        });\n    }\n\n});\n\nreturn msg;\n\n\nfunction normalize(arr) {\n    const mean = math.mean(arr)\n    const std = math.std(arr)\n    return math.map(arr, x => (x - mean)/std)\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2740,
        "y": 440,
        "wires": [
            []
        ]
    },
    {
        "id": "ab25bbdd5fe82ffb",
        "type": "ui-button-group",
        "z": "85a0c31e48c798bf",
        "name": "",
        "group": "5f03761aafa114cc",
        "order": 1,
        "width": 6,
        "height": 1,
        "label": "View type",
        "className": "",
        "rounded": true,
        "useThemeColors": true,
        "passthru": true,
        "options": [
            {
                "label": "X = Time",
                "icon": "",
                "value": "time",
                "valueType": "str",
                "color": "#009933"
            },
            {
                "label": "X = Position",
                "icon": "",
                "value": "position",
                "valueType": "str",
                "color": "#999999"
            }
        ],
        "topic": "selectView",
        "topicType": "str",
        "x": 700,
        "y": 880,
        "wires": [
            [
                "e1f1c9ed849d7837"
            ]
        ]
    },
    {
        "id": "af409250702c19a9",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "view",
                "pt": "flow",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2010,
        "y": 380,
        "wires": [
            [
                "86d627a20f38b280"
            ]
        ]
    },
    {
        "id": "0a3970c205050c09",
        "type": "switch",
        "z": "85a0c31e48c798bf",
        "name": "",
        "property": "view",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "timeStamp",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "position",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2390,
        "y": 540,
        "wires": [
            [
                "36a53855fcf46dba",
                "f4379867a3ea722c"
            ],
            [
                "9d01def7b3b6be1d"
            ]
        ]
    },
    {
        "id": "ecba115984f1aa50",
        "type": "ui-chart",
        "z": "85a0c31e48c798bf",
        "group": "5f03761aafa114cc",
        "name": "",
        "label": "abs. values",
        "order": 3,
        "chartType": "line",
        "category": "series",
        "categoryType": "msg",
        "xAxisLabel": "X axis",
        "xAxisProperty": "x",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "5",
        "height": "5",
        "className": "",
        "interpolation": "smooth",
        "x": 2410,
        "y": 980,
        "wires": [
            []
        ]
    },
    {
        "id": "9ecfe569bfcf333a",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "set_axis",
        "func": "msg.payload.forEach(function(element) {\n    element.axis = element[`${msg.view}`]\n});\nmsg.action = \"replace\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2400,
        "y": 460,
        "wires": [
            [
                "0a3970c205050c09"
            ]
        ]
    },
    {
        "id": "14509f6701be1fc6",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "reset view type",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "time",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 560,
        "wires": [
            [
                "17aefc05b1be602f"
            ]
        ]
    },
    {
        "id": "97271c1ee68ea070",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "get_time_series",
        "func": "const series = []\nconst stage = {}\nconst comp = msg.payload.setup[0]\nconst meas = msg.payload.setup[1]\nconst dict = {\n    component: {\n        label: \"Component\",\n        \"B\": \"Button\",\n        \"I\": \"Inner shaft\",\n        \"O\": \"Outer shaft\"\n    },\n    measurement: {\n        label: \"Measurement\",\n        \"H\": \"Ohmmeter\",\n        \"S\": \"Oscilloscope\"\n    },\n    special: {\n        \"B\": \"Press count\",\n        \"I\": \"Channel\",\n        \"O\": \"Channel\"\n    },\n    displacement:{\n        \"B\": \"Press distance\",\n        \"I\": \"Rotations\",\n        \"O\": \"Rotations\"\n    },\n    velocity:{\n        \"B\": \"Press speed\",\n        \"I\": \"Rpm\",\n        \"O\": \"Rpm\"\n    }\n\n}\n\nconst header = [\n        \"component\",\n        \"measurement\",\n        \"special\",\n        \"special\",\n        \"displacement\",\n        \"velocity\"\n]\n\n\n\n\nmsg.payload.series = msg.payload.values\nmsg.payload.stage = msg.payload.setup\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 460,
        "wires": [
            [
                "03cf50641a8c630c"
            ]
        ]
    },
    {
        "id": "4662a75cd903356a",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "ui_update.options",
                "pt": "msg",
                "to": "[\t   $each(\t       payload.stage_data,\t       function($val, $nam) {{ \"value\":$val, \"label\":$nam } }\t)\t]\t\t",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "enabled",
                "pt": "msg",
                "to": "true",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 480,
        "wires": [
            [
                "f144de5ed2e31ac4"
            ]
        ]
    },
    {
        "id": "cc208150589d69e5",
        "type": "debug",
        "z": "85a0c31e48c798bf",
        "name": "debug 5",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3060,
        "y": 680,
        "wires": []
    },
    {
        "id": "f23cd05e36b04a28",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "get_time_series",
        "func": "msg.payload.series = msg.payload.plc.values.map(({ ohm, ...rest }) => rest);\nmsg.payload.stage = msg.payload.plc.setup\n\nconst lim = last(msg.payload.series).timeStamp;\n\nmsg.payload.plc.ohm?.forEach(function(v, i, ar) {\n    if (v.timeStamp > lim) delete ar[i];\n});\n\n\n\nreturn msg;\n\nfunction last(arr) {\n    return arr[arr.length - 1]\n}",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1760,
        "y": 500,
        "wires": [
            [
                "03cf50641a8c630c",
                "24e6a2d307f9a389"
            ]
        ]
    },
    {
        "id": "73771af9926343a9",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "action",
                "pt": "msg",
                "to": "append",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2520,
        "y": 680,
        "wires": [
            [
                "3b1f41df59da5a85"
            ]
        ]
    },
    {
        "id": "3b1f41df59da5a85",
        "type": "delay",
        "z": "85a0c31e48c798bf",
        "name": "",
        "pauseType": "delay",
        "timeout": "200",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 2690,
        "y": 680,
        "wires": [
            [
                "e670ae406f1e73af",
                "cc208150589d69e5"
            ]
        ]
    },
    {
        "id": "f4379867a3ea722c",
        "type": "switch",
        "z": "85a0c31e48c798bf",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "selectView",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 2370,
        "y": 620,
        "wires": [
            [
                "e6fc034ca26f3237"
            ]
        ]
    },
    {
        "id": "e6fc034ca26f3237",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "ohm",
                "tot": "flow",
                "dc": true
            },
            {
                "t": "set",
                "p": "extract",
                "pt": "msg",
                "to": "[\"ohm\", \"strain\", \"position\"]",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2520,
        "y": 620,
        "wires": [
            [
                "73771af9926343a9"
            ]
        ]
    },
    {
        "id": "24e6a2d307f9a389",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$map(\t   payload.plc.ohm.$sift(\t       function($v, $k) {$k = \"ohm\" or $k = \"timeStamp\"}\t   ),\t   function($v) {$merge([$v, {\"axis\" : $v.timeStamp}])}\t)",
                "tot": "jsonata",
                "dc": true
            },
            {
                "t": "set",
                "p": "extract",
                "pt": "msg",
                "to": "[\"ohm\", \"strain\", \"position\"]",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "ohm_series",
                "pt": "flow",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2300,
        "y": 720,
        "wires": [
            [
                "73771af9926343a9"
            ]
        ]
    },
    {
        "id": "90dc1519d61ce087",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inUiEvent",
        "links": [
            "26df795f70aac6ed"
        ],
        "x": 145,
        "y": 440,
        "wires": [
            [
                "912c6069fc5242a6"
            ]
        ]
    },
    {
        "id": "fca49527d7503362",
        "type": "switch",
        "z": "85a0c31e48c798bf",
        "name": "",
        "property": "name",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "Database",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 110,
        "y": 520,
        "wires": [
            [
                "87b37c9dbbfa572a",
                "a41d6d9c4686dbfe",
                "14509f6701be1fc6"
            ]
        ]
    },
    {
        "id": "912c6069fc5242a6",
        "type": "switch",
        "z": "85a0c31e48c798bf",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "change",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 110,
        "y": 480,
        "wires": [
            [
                "fca49527d7503362"
            ]
        ]
    },
    {
        "id": "17aefc05b1be602f",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outResetView",
        "mode": "link",
        "links": [
            "347928b681ea11cd"
        ],
        "x": 1305,
        "y": 560,
        "wires": []
    },
    {
        "id": "347928b681ea11cd",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inResetView",
        "links": [
            "17aefc05b1be602f"
        ],
        "x": 575,
        "y": 900,
        "wires": [
            [
                "ab25bbdd5fe82ffb",
                "e1f1c9ed849d7837"
            ]
        ]
    },
    {
        "id": "3810c72c74757af6",
        "type": "debug",
        "z": "85a0c31e48c798bf",
        "name": "debug 11",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2140,
        "y": 1240,
        "wires": []
    },
    {
        "id": "3d5490e19f71c9f1",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "set flow data",
        "func": "flow.set(\"data\", {});\n\nconst data = flow.get(\"data\")\n\ndata.plc = msg.payload.plc.values\ndata.setup = msg.payload.plc.setup\ndata.ohm = msg.payload?.ohm\ndata.osc = msg.payload?.osc\n\nswitch(undefined){\n    case data.ohm:\n        msg.extra = \"osc\";\n        break;\n    case data.osc:\n        msg.extra = \"ohm\";\n        break;\n\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 800,
        "wires": [
            [
                "8151311b1f3eb043",
                "3e98591e425d8f56"
            ]
        ]
    },
    {
        "id": "cc399444a3495527",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "get stage setup",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "data.setup",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1180,
        "y": 1100,
        "wires": [
            [
                "21a8c894e9bc4a6a"
            ]
        ]
    },
    {
        "id": "d1f36aee0fcb8ae3",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "get plc data",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "data.plc",
                "tot": "flow",
                "dc": true
            },
            {
                "t": "set",
                "p": "axis",
                "pt": "msg",
                "to": "axis",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "series",
                "pt": "msg",
                "to": "series",
                "tot": "flow"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 1140,
        "wires": [
            [
                "fd0bf8a85cece4fb"
            ]
        ]
    },
    {
        "id": "21a8c894e9bc4a6a",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outStageSetup",
        "mode": "link",
        "links": [
            "8f253266627cbfa4"
        ],
        "x": 1295,
        "y": 1100,
        "wires": []
    },
    {
        "id": "c35c9c2d338283df",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inValues",
        "links": [
            "10bab48e7c420909"
        ],
        "x": 2325,
        "y": 280,
        "wires": [
            [
                "20542ba1e7f761a4"
            ]
        ]
    },
    {
        "id": "fcb9b62b0baf64c2",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "get ohm data",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "data.ohm",
                "tot": "flow",
                "dc": true
            },
            {
                "t": "set",
                "p": "series",
                "pt": "msg",
                "to": "[\"ohm\", \"\"]",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 1180,
        "wires": [
            [
                "c9303123b2647487"
            ]
        ]
    },
    {
        "id": "e5fdda48a21f356c",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "get osc data",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "data.osc.values.signal",
                "tot": "flow"
            },
            {
                "t": "set",
                "p": "series",
                "pt": "msg",
                "to": "[\"a\",\"b\"]",
                "tot": "json"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1170,
        "y": 1220,
        "wires": [
            [
                "fcb1be472a444a7f"
            ]
        ]
    },
    {
        "id": "e1f1c9ed849d7837",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "axis and series",
        "func": "switch (msg.payload) {\n    case \"time\":\n        msg.axis = \"timeStamp\"\n        msg.series = [\"strain\", \"position\"]\n        break;\n    case \"position\":\n        msg.axis = \"position\";\n        msg.series = [\"strain\", \"\"]\n        break;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 900,
        "wires": [
            [
                "51442a907f816608"
            ]
        ]
    },
    {
        "id": "6db37fcb97b81b6e",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outChangeView",
        "mode": "link",
        "links": [
            "a8ccf417fe6d5dac"
        ],
        "x": 1155,
        "y": 900,
        "wires": []
    },
    {
        "id": "a8ccf417fe6d5dac",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inGetPlcData",
        "links": [
            "6db37fcb97b81b6e",
            "8151311b1f3eb043"
        ],
        "x": 1065,
        "y": 1140,
        "wires": [
            [
                "d1f36aee0fcb8ae3"
            ]
        ]
    },
    {
        "id": "8151311b1f3eb043",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outSetFlowData",
        "mode": "link",
        "links": [
            "84632c8af1a51905",
            "a8ccf417fe6d5dac"
        ],
        "x": 1685,
        "y": 780,
        "wires": []
    },
    {
        "id": "84632c8af1a51905",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inGetStageSetup",
        "links": [
            "8151311b1f3eb043"
        ],
        "x": 1065,
        "y": 1100,
        "wires": [
            [
                "cc399444a3495527"
            ]
        ]
    },
    {
        "id": "7d26955ff8ee9e16",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inGetOhmData",
        "links": [
            "6a38fee3849bb4d4"
        ],
        "x": 1065,
        "y": 1180,
        "wires": [
            [
                "fcb9b62b0baf64c2"
            ]
        ]
    },
    {
        "id": "0a1fba668950be30",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inGetOscData",
        "links": [
            "4f97e3bba69af8ac"
        ],
        "x": 1065,
        "y": 1220,
        "wires": [
            [
                "e5fdda48a21f356c"
            ]
        ]
    },
    {
        "id": "fd0bf8a85cece4fb",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outGetPlcData",
        "mode": "link",
        "links": [
            "58e7aa859c9243b2"
        ],
        "x": 1295,
        "y": 1140,
        "wires": []
    },
    {
        "id": "255f27afec09c997",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outGetOhmData",
        "mode": "link",
        "links": [
            "295b0e9412db2e89"
        ],
        "x": 1455,
        "y": 1180,
        "wires": []
    },
    {
        "id": "b0dba75b5deecb07",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outGetOscData",
        "mode": "link",
        "links": [
            "295b0e9412db2e89"
        ],
        "x": 1455,
        "y": 1220,
        "wires": []
    },
    {
        "id": "3e98591e425d8f56",
        "type": "switch",
        "z": "85a0c31e48c798bf",
        "name": "check extra",
        "property": "extra",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "ohm",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "osc",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1710,
        "y": 820,
        "wires": [
            [
                "6a38fee3849bb4d4"
            ],
            [
                "4f97e3bba69af8ac"
            ]
        ]
    },
    {
        "id": "6a38fee3849bb4d4",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outOhm",
        "mode": "link",
        "links": [
            "7d26955ff8ee9e16"
        ],
        "x": 1805,
        "y": 800,
        "wires": []
    },
    {
        "id": "4f97e3bba69af8ac",
        "type": "link out",
        "z": "85a0c31e48c798bf",
        "name": "outOsc",
        "mode": "link",
        "links": [
            "0a1fba668950be30"
        ],
        "x": 1805,
        "y": 840,
        "wires": []
    },
    {
        "id": "5059d830a059caad",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "normalize series",
        "func": "const math = global.get('mathjs')\n\nmsg.series.forEach(function (key) {\n    if (key) {\n        const norm = normalize(msg.payload.map((el) => el[key]))\n        msg.payload.forEach(function (el, i) {\n            el[key] = norm[i];\n        });\n    }\n\n});\n\nreturn msg;\n\nfunction normalize(arr) {\n    const mean = math.mean(arr)\n    const std = math.std(arr)\n    return math.map(arr, x => (x - mean) / std)\n}\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2420,
        "y": 940,
        "wires": [
            [
                "37a7f15b42e4d3ad"
            ]
        ]
    },
    {
        "id": "51442a907f816608",
        "type": "change",
        "z": "85a0c31e48c798bf",
        "name": "set flow axis",
        "rules": [
            {
                "t": "set",
                "p": "axis",
                "pt": "flow",
                "to": "axis",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "series",
                "pt": "flow",
                "to": "series",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1050,
        "y": 900,
        "wires": [
            [
                "6db37fcb97b81b6e"
            ]
        ]
    },
    {
        "id": "295b0e9412db2e89",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inExtraChart",
        "links": [
            "255f27afec09c997",
            "b0dba75b5deecb07"
        ],
        "x": 2115,
        "y": 1020,
        "wires": [
            [
                "9ea54660171fce8c",
                "3810c72c74757af6"
            ]
        ]
    },
    {
        "id": "58e7aa859c9243b2",
        "type": "link in",
        "z": "85a0c31e48c798bf",
        "name": "inStrainChart",
        "links": [
            "fd0bf8a85cece4fb"
        ],
        "x": 2115,
        "y": 980,
        "wires": [
            [
                "b972eb10d0ed2cd5"
            ]
        ]
    },
    {
        "id": "9ea54660171fce8c",
        "type": "ui-chart",
        "z": "85a0c31e48c798bf",
        "group": "5f03761aafa114cc",
        "name": "Extra",
        "label": "",
        "order": 4,
        "chartType": "line",
        "category": "series",
        "categoryType": "msg",
        "xAxisLabel": "X axis",
        "xAxisProperty": "timeStamp",
        "xAxisPropertyType": "property",
        "xAxisType": "linear",
        "xAxisFormat": "",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "",
        "yAxisPropertyType": "property",
        "ymin": "",
        "ymax": "",
        "bins": 10,
        "action": "replace",
        "stackSeries": false,
        "pointShape": "circle",
        "pointRadius": 4,
        "showLegend": true,
        "removeOlder": 1,
        "removeOlderUnit": "3600",
        "removeOlderPoints": "",
        "colors": [
            "#0095ff",
            "#ff0000",
            "#ff7f0e",
            "#2ca02c",
            "#a347e1",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "5",
        "height": "6",
        "className": "",
        "interpolation": "smooth",
        "x": 2230,
        "y": 1020,
        "wires": [
            []
        ]
    },
    {
        "id": "b972eb10d0ed2cd5",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "set x axis",
        "func": "msg.payload.forEach(function(el) {\n    el.x = el[msg.axis];\n    delete el[msg.axis]\n})\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2240,
        "y": 980,
        "wires": [
            [
                "5059d830a059caad",
                "ecba115984f1aa50"
            ]
        ]
    },
    {
        "id": "fcb1be472a444a7f",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "adjust key",
        "func": "msg.payload.forEach(function(el){\n    if(el.timestamp){\n        el.timeStamp = el.timestamp;\n        delete el.timestamp;\n    };\n})\n\nif(flow.get(\"data.setup.component\") === \"B\"){\n    msg.series = [\"a\", \"\"];\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1320,
        "y": 1220,
        "wires": [
            [
                "b0dba75b5deecb07"
            ]
        ]
    },
    {
        "id": "585297eb4357824b",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "chart options -dataZoom",
        "func": "const ui_update = msg.ui_update ?? {}\nconst chartOptions = ui_update.chartOptions ?? {}\nconst add = {\n    dataZoom: {\n        type: 'inside'\n    }\n}\n\nObject.assign(chartOptions, add)\nui_update.chartOptions = chartOptions;\nmsg.ui_update = Object.assign(ui_update, chartOptions)\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1450,
        "y": 760,
        "wires": [
            [
                "3d5490e19f71c9f1"
            ]
        ]
    },
    {
        "id": "c9303123b2647487",
        "type": "link call",
        "z": "85a0c31e48c798bf",
        "name": "process ohm",
        "links": [
            "79c07bea4075b2c3"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1330,
        "y": 1180,
        "wires": [
            [
                "255f27afec09c997"
            ]
        ]
    },
    {
        "id": "52278dc01e9440cb",
        "type": "function",
        "z": "85a0c31e48c798bf",
        "name": "load to sim",
        "func": "switch (msg.topic) {\n    case \"enable\":\n        context.set(\"enable\", true);\n        node.status({fill:\"green\",shape:\"dot\",text:\"enabled\"});\n        break;\n    default:\n        if (context.get(\"enable\")) {\n            \n            global.set(\"sim\", msg.payload.stage_data);\n            context.set(\"enable\", false)\n            node.status({fill:\"yellow\",shape:\"ring\",text:\"disabled\"});\n        }\n        break;\n}\n\nreturn;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "// Code added here will be run once\n// whenever the node is started.\nnode.status({ fill: \"yellow\", shape: \"ring\", text: \"disabled\" });\n",
        "finalize": "",
        "libs": [],
        "x": 970,
        "y": 740,
        "wires": [
            []
        ]
    },
    {
        "id": "af24d71131cc15d3",
        "type": "inject",
        "z": "85a0c31e48c798bf",
        "name": "",
        "props": [
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "enable",
        "x": 690,
        "y": 680,
        "wires": [
            [
                "52278dc01e9440cb"
            ]
        ]
    },
    {
        "id": "8435f37c02a9e26b",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "name": "set_global",
        "func": "global.set(msg.path, msg.payload, msg.store || null);\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 280,
        "wires": [
            [
                "874b939d0b06ddf6"
            ]
        ]
    },
    {
        "id": "92ac2da453fade23",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "name": "get_global",
        "func": "msg.payload = global.get(`${msg.path}`, msg.store || null);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1210,
        "y": 320,
        "wires": [
            [
                "f8496cdf5dd086c9"
            ]
        ]
    },
    {
        "id": "874b939d0b06ddf6",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "name": "outUpdateViews",
        "mode": "link",
        "links": [
            "e361215bc8c832ec",
            "1553f42182fe9185"
        ],
        "x": 1375,
        "y": 280,
        "wires": []
    },
    {
        "id": "32c2e30c04b0a7cb",
        "type": "inject",
        "z": "aecf9ba551ec4a57",
        "g": "32c9d68b1d798fbc",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 1120,
        "wires": [
            [
                "d4219e24a88dc0e8",
                "b19da3d04cf94fc2"
            ]
        ]
    },
    {
        "id": "d4219e24a88dc0e8",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "32c9d68b1d798fbc",
        "name": "set_settings_tools",
        "func": "const math = global.get(\"mathjs\");\n\nmsg.path = \"settings.limits.tools\"\nmsg.store = \"file\"\n\nmsg.payload = {\n\n    in_window: (x, ar) => ((x >= math.min(ar)) && (x <= math.max(ar))),\n\n    window: {\n        relative_multiply: (x, d) => [x*(1-d), x*(1+d)],\n        relative_offset: (x, d) => [x - d , x + d],\n        absolute: (x, d) => [d, x],\n        strict: (x, d) => [x, x]\n    },\n\n    labels: {\n        relative_multiply : \"Relative, multiply [x(1-d), x(1+d)]\",\n        relative_offset : \"Relative, [x-d, x+d]\",\n        absolute : \"Absolute, set values [d, x]\",\n        strict: \"Strict value, [x, x]\"\n    }\n    \n}\n\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1120,
        "wires": [
            [
                "eaa2da6793b55f40"
            ]
        ]
    },
    {
        "id": "d7e034faf7f8dad2",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "name": "inSetGlobal",
        "links": [
            "eaa2da6793b55f40",
            "acd4787a8b6262f8"
        ],
        "x": 1105,
        "y": 280,
        "wires": [
            [
                "8435f37c02a9e26b"
            ]
        ]
    },
    {
        "id": "8cde3623a591ad28",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "products",
        "rules": [
            {
                "t": "set",
                "p": "path",
                "pt": "msg",
                "to": "settings.products",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "store",
                "pt": "msg",
                "to": "file",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 200,
        "y": 360,
        "wires": [
            [
                "5516c6e781361bc2"
            ]
        ]
    },
    {
        "id": "e361215bc8c832ec",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "inUpdateOptions",
        "links": [
            "26df795f70aac6ed",
            "874b939d0b06ddf6"
        ],
        "x": 85,
        "y": 360,
        "wires": [
            [
                "8cde3623a591ad28"
            ]
        ]
    },
    {
        "id": "67aacb4aa043bedf",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "name": "options_from_payload",
        "func": "const obj = msg.payload\n\nmsg.ui_update = {\n    dropdownOptions: Object.keys(obj).map((k) => ({ \"dropdown\": msg.dropdown, \"value\": {[k] : obj[k]}, \"label\": k}))\n}\n\ndelete  msg.payload\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1240,
        "y": 200,
        "wires": [
            [
                "36566b03234291f8"
            ]
        ]
    },
    {
        "id": "e9512ee1d52c98e6",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "name": "inOptFromPayload",
        "links": [],
        "x": 1105,
        "y": 200,
        "wires": [
            [
                "67aacb4aa043bedf"
            ]
        ]
    },
    {
        "id": "36566b03234291f8",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "name": "retOptFromPayload",
        "mode": "return",
        "links": [],
        "x": 1385,
        "y": 200,
        "wires": []
    },
    {
        "id": "f7ac8e854a829e1f",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "name": "inGetGlobal",
        "links": [],
        "x": 1105,
        "y": 320,
        "wires": [
            [
                "92ac2da453fade23"
            ]
        ]
    },
    {
        "id": "f8496cdf5dd086c9",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "name": "retGetGlobal",
        "mode": "return",
        "links": [],
        "x": 1375,
        "y": 320,
        "wires": []
    },
    {
        "id": "eaa2da6793b55f40",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "g": "32c9d68b1d798fbc",
        "name": "outSetTools",
        "mode": "link",
        "links": [
            "d7e034faf7f8dad2"
        ],
        "x": 535,
        "y": 1120,
        "wires": []
    },
    {
        "id": "5516c6e781361bc2",
        "type": "link call",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "",
        "links": [
            "f7ac8e854a829e1f"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 190,
        "y": 400,
        "wires": [
            [
                "318ffbd6feb78037"
            ]
        ]
    },
    {
        "id": "318ffbd6feb78037",
        "type": "link call",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "get table",
        "links": [
            "e3a15eeffab2d03c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 200,
        "y": 440,
        "wires": [
            [
                "f47cbfc45fced655"
            ]
        ]
    },
    {
        "id": "acd4787a8b6262f8",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "outSetProduct",
        "mode": "link",
        "links": [
            "d7e034faf7f8dad2"
        ],
        "x": 825,
        "y": 300,
        "wires": []
    },
    {
        "id": "624a2e68fe5f9cd6",
        "type": "switch",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "action",
        "property": "column",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "remove",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "edit",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 3,
        "x": 570,
        "y": 440,
        "wires": [
            [],
            [
                "1c0bdfa30262cea9"
            ],
            [
                "1c0bdfa30262cea9",
                "6d84d370604bcb7f"
            ]
        ],
        "outputLabels": [
            "remove",
            "edit",
            "select"
        ]
    },
    {
        "id": "f2e3a0db8dea4a4b",
        "type": "debug",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "debug 14",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 800,
        "y": 780,
        "wires": []
    },
    {
        "id": "f47cbfc45fced655",
        "type": "ui-table",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "group": "328519736c0eac55",
        "name": "",
        "label": "Types",
        "order": 1,
        "width": 0,
        "height": 0,
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "click",
        "columns": [
            {
                "title": "Name",
                "key": "name",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 390,
        "y": 360,
        "wires": [
            [
                "877013ed22113b66"
            ]
        ]
    },
    {
        "id": "7584e069307a8773",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "name": "table_from_payload",
        "func": "const obj = msg.payload ?? {}\n\nmsg.payload = obj.entries?.()\nmsg.payload ??= Object.entries(obj)\nmsg.payload = [...msg.payload].map(([k,v]) => ({\"name\" : k, \"value\" : v}))\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1230,
        "y": 240,
        "wires": [
            [
                "7da985dbc23dfe63"
            ]
        ]
    },
    {
        "id": "e3a15eeffab2d03c",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "name": "inTabFromPayload",
        "links": [],
        "x": 1105,
        "y": 240,
        "wires": [
            [
                "7584e069307a8773"
            ]
        ]
    },
    {
        "id": "7da985dbc23dfe63",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "name": "retTabFromPayload",
        "mode": "return",
        "links": [],
        "x": 1385,
        "y": 240,
        "wires": []
    },
    {
        "id": "8e817885a6d0c3b5",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "name": "show/hide group",
        "func": "msg.payload = {\n    groups: {\n        [msg.topic]: [{ group: msg.payload }]\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1220,
        "y": 360,
        "wires": [
            [
                "5e51d43694ee4944"
            ]
        ]
    },
    {
        "id": "5e51d43694ee4944",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "name": "show/hideOut",
        "mode": "link",
        "links": [
            "28afbc673cc0e8dc"
        ],
        "x": 1335,
        "y": 360,
        "wires": []
    },
    {
        "id": "29df1b190491358c",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "#:(file)::settings.products.E37",
                "pt": "global",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1230,
        "y": 640,
        "wires": [
            []
        ]
    },
    {
        "id": "b1fa3db369e573c5",
        "type": "inject",
        "z": "aecf9ba551ec4a57",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 1160,
        "y": 560,
        "wires": [
            [
                "777eb230740da37f"
            ]
        ]
    },
    {
        "id": "877013ed22113b66",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "get selected",
        "rules": [
            {
                "t": "set",
                "p": "name",
                "pt": "msg",
                "to": "payload.name",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "path",
                "pt": "msg",
                "to": "\"settings.products.\" & name",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "store",
                "pt": "msg",
                "to": "file",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 410,
        "y": 400,
        "wires": [
            [
                "a4325849565fb5be"
            ]
        ]
    },
    {
        "id": "a4325849565fb5be",
        "type": "link call",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "",
        "links": [
            "f7ac8e854a829e1f"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 410,
        "y": 440,
        "wires": [
            [
                "624a2e68fe5f9cd6"
            ]
        ]
    },
    {
        "id": "6d84d370604bcb7f",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "set current",
        "rules": [
            {
                "t": "set",
                "p": "path",
                "pt": "msg",
                "to": "current.product",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload.name",
                "pt": "msg",
                "to": "name",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "delete",
                "p": "store",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 300,
        "wires": [
            [
                "acd4787a8b6262f8"
            ]
        ]
    },
    {
        "id": "92184b1fbbb492a6",
        "type": "ui-table",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "group": "328519736c0eac55",
        "name": "",
        "label": "Features",
        "order": 2,
        "width": 0,
        "height": 0,
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "click",
        "columns": [
            {
                "title": "Name",
                "key": "label",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Type",
                "key": "type",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 340,
        "y": 620,
        "wires": [
            [
                "6613ee3a67759dd0"
            ]
        ]
    },
    {
        "id": "f17665e77a438a74",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "set flow.edit",
        "rules": [
            {
                "t": "set",
                "p": "edit.product",
                "pt": "flow",
                "to": "payload",
                "tot": "msg"
            },
            {
                "t": "set",
                "p": "edit.path",
                "pt": "flow",
                "to": "path",
                "tot": "msg",
                "dc": true
            },
            {
                "t": "set",
                "p": "edit.store",
                "pt": "flow",
                "to": "store",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 580,
        "wires": [
            [
                "420103eb5538d470"
            ]
        ]
    },
    {
        "id": "9e98aeca1cb9eca4",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "name": "inShowHide",
        "links": [
            "953994fd1285bde1"
        ],
        "x": 1105,
        "y": 360,
        "wires": [
            [
                "8e817885a6d0c3b5"
            ]
        ]
    },
    {
        "id": "420103eb5538d470",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "get features",
        "func": "msg = {\n     payload : flow.get(\"edit.product.features\")\n    }\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 580,
        "wires": [
            [
                "d3a57847349e12ca"
            ]
        ]
    },
    {
        "id": "7f188de42da84111",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "inEdit",
        "links": [
            "1c0bdfa30262cea9"
        ],
        "x": 85,
        "y": 580,
        "wires": [
            [
                "f17665e77a438a74"
            ]
        ]
    },
    {
        "id": "1c0bdfa30262cea9",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "outEdit",
        "mode": "link",
        "links": [
            "7f188de42da84111"
        ],
        "x": 695,
        "y": 440,
        "wires": []
    },
    {
        "id": "d3a57847349e12ca",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "extract index",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$map(payload, function($v, $i) {$merge([$v,{\"index\":$i}])})",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 620,
        "wires": [
            [
                "92184b1fbbb492a6"
            ]
        ]
    },
    {
        "id": "03b94af069cc8537",
        "type": "ui-form",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "edit",
        "group": "af49f759fce29780",
        "label": "",
        "order": 1,
        "width": 0,
        "height": 0,
        "options": [
            {
                "label": "Name",
                "key": "name",
                "type": "text",
                "required": true,
                "rows": null
            }
        ],
        "formValue": {
            "name": ""
        },
        "payload": "",
        "submit": "submit",
        "cancel": "clear",
        "resetOnSubmit": false,
        "topic": "",
        "topicType": "str",
        "splitLayout": true,
        "className": "",
        "passthru": false,
        "dropdownOptions": [],
        "x": 490,
        "y": 940,
        "wires": [
            [
                "f2e3a0db8dea4a4b",
                "e4eda6a9e6628f2f"
            ]
        ]
    },
    {
        "id": "ea8d11d48fdca17f",
        "type": "ui-button",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "group": "b7574cc4a83ac22e",
        "name": "new:",
        "label": "",
        "order": 3,
        "width": "1",
        "height": "1",
        "emulateClick": false,
        "tooltip": "",
        "color": "",
        "bgcolor": "",
        "className": "",
        "icon": "plus-circle",
        "iconPosition": "left",
        "payload": "",
        "payloadType": "str",
        "topic": "new",
        "topicType": "str",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 210,
        "y": 920,
        "wires": [
            [
                "1f3b495e00daba71"
            ]
        ]
    },
    {
        "id": "d22bef696024a279",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "show:EditVal",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Edit value",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "show",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 700,
        "wires": [
            [
                "953994fd1285bde1"
            ]
        ]
    },
    {
        "id": "396bfb23c28ff5b8",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "hide:EditVal",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Edit value",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "hide",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 660,
        "wires": [
            [
                "953994fd1285bde1"
            ]
        ]
    },
    {
        "id": "76313568f2a04441",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "32c9d68b1d798fbc",
        "name": "set_default_limits",
        "func": "const math = global.get(\"mathjs\");\n\nmsg.path = \"settings.limits.values\"\nmsg.store = \"file\"\n\nmsg.payload = {\n    product: {\n        button: {\n            position: [90, 60],\n            velocity: [150, 0],\n            \n        }\n    },\n    machine: {\n        \"Z Axis\": {\n            position: [150, 0],\n            velocity: [150, 0],\n            strain: [20, 0],\n        },\n        \"Rotation axis\": {\n            position: [10000, -10000],\n            velocity: [150, 0],\n            strain: [120, -120],\n        },\n    }\n\n}\n\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1080,
        "wires": [
            [
                "eaa2da6793b55f40"
            ]
        ]
    },
    {
        "id": "db5b289970cf2446",
        "type": "inject",
        "z": "aecf9ba551ec4a57",
        "g": "32c9d68b1d798fbc",
        "name": "",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "x": 150,
        "y": 1080,
        "wires": [
            [
                "76313568f2a04441"
            ]
        ]
    },
    {
        "id": "777eb230740da37f",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "name": "product:E37",
        "func": "const product = {\n    \"template\":\"^E37-[f0][f1][f2][f3][f4][f5]-[f6]$\",\n    \"features\":[\n        {\"name\":\"orientation\",\"label\":\"Orientation\",\"type\":\"info\",\"values\":{\"V\":{\"info\":\"THT vertical\"},\"C\":{\"info\":\"THT horizontal\"}}},\n        {\"name\":\"bushing\",\"label\":\"Bushing\",\"type\":\"info\",\"values\":{\"N\":{\"info\":\"Non-threaded  7 x 6 mm\"},\"T\":{\"info\":\"Threaded M7 x 0.75 x 6 mm\"}}},\n        {\"name\":\"button\",\"label\":\"Push button\",\"type\":\"button\",\"values\":{\"0\":{\"force\":0,\"travel\":0,\"z\":0,\"displacement\":0,\"velocity\":12,\"count\":1,\"resistance\":10,\"bounce\":2,\"force_limit\":0.3,\"travel_limit\":0.2,\"resistance_limit\":10,\"bounce_limit\":2},\"3\":{\"force\":3,\"travel\":0.5,\"z\":0,\"displacement\":1,\"velocity\":12,\"count\":1,\"resistance\":10,\"bounce\":2,\"force_limit\":0.3,\"travel_limit\":0.2,\"resistance_limit\":10,\"bounce_limit\":2},\"6\":{\"force\":6,\"travel\":0.5,\"z\":0,\"displacement\":1,\"velocity\":12,\"count\":1,\"resistance\":10,\"bounce\":2,\"force_limit\":0.3,\"travel_limit\":0.2,\"resistance_limit\":10,\"bounce_limit\":2},\"A\":{\"force\":10,\"travel\":0.5,\"z\":0,\"displacement\":1,\"velocity\":12,\"count\":1,\"resistance\":10,\"bounce\":2,\"force_limit\":0.3,\"travel_limit\":0.2,\"resistance_limit\":10,\"bounce_limit\":2},\"E\":{\"force\":14,\"travel\":0.5,\"z\":0,\"displacement\":1,\"velocity\":12,\"count\":1,\"resistance\":10,\"bounce\":2,\"force_limit\":0.3,\"travel_limit\":0.2,\"resistance_limit\":10,\"bounce_limit\":2}}},\n        {\"name\":\"inner\",\"label\":\"Inner shaft\",\"type\":\"encoder\",\"values\":{\"1\":{\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"detents\":32,\"pulses\":16,\"torque\":2,\"phase\":90,\"torque_limit\":0.3,\"phase_limit\":70},\"2\":{\"detents\":16,\"pulses\":8,\"torque\":1.5,\"detent_torque\":1.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"3\":{\"detents\":16,\"pulses\":8,\"torque\":2.5,\"detent_torque\":2.5,\"z\":128,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"4\":{\"detents\":32,\"pulses\":8,\"torque\":2,\"detent_torque\":2,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"5\":{\"detents\":16,\"pulses\":16,\"torque\":1.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"phase_limit\":70},\"6\":{\"detents\":16,\"pulses\":16,\"torque\":2.5,\"detent_torque\":2.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"8\":{\"detents\":0,\"pulses\":16,\"torque\":0,\"detent_torque\":0,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"9\":{\"detents\":0,\"pulses\":8,\"torque\":0,\"detent_torque\":0,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"G\":{\"detents\":16,\"pulses\":8,\"torque\":4.5,\"detent_torque\":4.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70}}},\n        {\"name\":\"outer\",\"label\":\"Outer shaft\",\"type\":\"encoder\",\"values\":{\"1\":{\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"detents\":32,\"pulses\":16,\"torque\":2,\"phase\":90,\"torque_limit\":0.3,\"phase_limit\":70},\"2\":{\"detents\":16,\"pulses\":8,\"torque\":1.5,\"detent_torque\":1.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"3\":{\"detents\":16,\"pulses\":8,\"torque\":2.5,\"detent_torque\":2.5,\"z\":128,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"4\":{\"detents\":32,\"pulses\":8,\"torque\":2,\"detent_torque\":2,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"5\":{\"detents\":16,\"pulses\":16,\"torque\":1.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"phase_limit\":70},\"6\":{\"detents\":16,\"pulses\":16,\"torque\":2.5,\"detent_torque\":2.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"8\":{\"detents\":0,\"pulses\":16,\"torque\":0,\"detent_torque\":0,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"9\":{\"detents\":0,\"pulses\":8,\"torque\":0,\"detent_torque\":0,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"A\":{\"detents\":32,\"pulses\":16,\"torque\":0.5,\"detent_torque\":0.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"B\":{\"detents\":32,\"pulses\":16,\"torque\":1,\"detent_torque\":1,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"C\":{\"detents\":32,\"pulses\":16,\"torque\":1.5,\"detent_torque\":1.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"D\":{\"detents\":32,\"pulses\":16,\"torque\":3,\"detent_torque\":3,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"E\":{\"detents\":16,\"pulses\":8,\"torque\":0.5,\"detent_torque\":0.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"F\":{\"detents\":16,\"pulses\":8,\"torque\":3.5,\"detent_torque\":3.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70},\"G\":{\"detents\":16,\"pulses\":8,\"torque\":4.5,\"detent_torque\":4.5,\"z\":0,\"displacement\":1.2,\"velocity\":60,\"resistance\":10,\"bounce\":2,\"phase\":90,\"torque_limit\":0.3,\"detent_torque_limit\":0.5,\"phase_limit\":70}}},\n        {\"name\":\"sealing\",\"label\":\"IP sealing\",\"type\":\"info\",\"values\":{\"0\":{\"info\":\"IP60\"},\"1\":{\"info\":\"IP68 shaft sealing\"},\"2\":{\"info\":\"IP68 shaft | front panel sealing\"}}},\n        {\"name\":\"shaft\",\"label\":\"Shaft type\",\"type\":\"info\",\"values\":{\"1\":{\"info\":\"Basic\"},\"2\":{\"info\":\"Inner shaft;  3 mm, same length as basic type\"}}}\n        ],\n    \"name\":\"E37\"\n}\n\nmsg.payload = product\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1170,
        "y": 600,
        "wires": [
            [
                "29df1b190491358c"
            ]
        ]
    },
    {
        "id": "f9cece5ac88ea2a7",
        "type": "ui-table",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "group": "b7574cc4a83ac22e",
        "name": "",
        "label": "",
        "order": 2,
        "width": 0,
        "height": 0,
        "maxrows": 0,
        "passthru": false,
        "autocols": false,
        "showSearch": false,
        "deselect": true,
        "selectionType": "click",
        "columns": [
            {
                "title": "Name",
                "key": "name",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Data",
                "key": "value",
                "keyType": "key",
                "type": "text",
                "width": "",
                "align": "start"
            },
            {
                "title": "Remove",
                "key": "remove",
                "keyType": "key",
                "type": "button",
                "width": "",
                "align": "start"
            }
        ],
        "mobileBreakpoint": "sm",
        "mobileBreakpointType": "defaults",
        "action": "replace",
        "className": "",
        "x": 190,
        "y": 840,
        "wires": [
            [
                "a08dcea851cda779"
            ]
        ]
    },
    {
        "id": "6613ee3a67759dd0",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "save index",
        "rules": [
            {
                "t": "set",
                "p": "edit.index",
                "pt": "flow",
                "to": "payload.index",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 190,
        "y": 660,
        "wires": [
            [
                "d81db01110179032"
            ]
        ]
    },
    {
        "id": "dbca34e49233a7d4",
        "type": "link call",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "get table",
        "links": [
            "e3a15eeffab2d03c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 360,
        "y": 760,
        "wires": [
            [
                "ca237eb130a5bdc3"
            ]
        ]
    },
    {
        "id": "5a000baa5781089c",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "hide:Values",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Values",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "hide",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 580,
        "wires": [
            [
                "953994fd1285bde1"
            ]
        ]
    },
    {
        "id": "953994fd1285bde1",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "outShowHide",
        "mode": "link",
        "links": [
            "9e98aeca1cb9eca4"
        ],
        "x": 895,
        "y": 640,
        "wires": []
    },
    {
        "id": "34b26a7ff80a850f",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "show:Values",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Values",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "show",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 770,
        "y": 620,
        "wires": [
            [
                "953994fd1285bde1"
            ]
        ]
    },
    {
        "id": "150473f2c686409d",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "inHideValues",
        "links": [
            "26df795f70aac6ed"
        ],
        "x": 545,
        "y": 580,
        "wires": [
            [
                "4f06528212ea74a0"
            ]
        ]
    },
    {
        "id": "3380c5beca686cc8",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "inShowValues",
        "links": [
            "d81db01110179032"
        ],
        "x": 665,
        "y": 620,
        "wires": [
            [
                "34b26a7ff80a850f"
            ]
        ]
    },
    {
        "id": "d81db01110179032",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "outSelectFeature",
        "mode": "link",
        "links": [
            "3380c5beca686cc8",
            "b813fb708889b927"
        ],
        "x": 295,
        "y": 660,
        "wires": []
    },
    {
        "id": "b813fb708889b927",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "inEditValues",
        "links": [
            "3d457befa2bee268",
            "d81db01110179032"
        ],
        "x": 95,
        "y": 760,
        "wires": [
            [
                "4757177110a58530"
            ]
        ]
    },
    {
        "id": "4f06528212ea74a0",
        "type": "switch",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "",
        "property": "payload",
        "propertyType": "msg",
        "rules": [
            {
                "t": "neq",
                "v": "input",
                "vt": "str"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 630,
        "y": 580,
        "wires": [
            [
                "5a000baa5781089c",
                "396bfb23c28ff5b8"
            ]
        ]
    },
    {
        "id": "a08dcea851cda779",
        "type": "switch",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "action",
        "property": "column",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "remove",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 310,
        "y": 840,
        "wires": [
            [
                "9c94e675360ccf7c"
            ],
            [
                "f90fdbbfe117b568"
            ]
        ],
        "outputLabels": [
            "remove",
            "select"
        ]
    },
    {
        "id": "9c94e675360ccf7c",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "remove component",
        "func": "\nconst edit = flow.get(\"edit\")\n\ndelete edit.product.features[edit.index].values[msg.payload.name]\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 610,
        "y": 840,
        "wires": [
            [
                "3d457befa2bee268"
            ]
        ]
    },
    {
        "id": "4757177110a58530",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "get values",
        "func": "const edit = flow.get(\"edit\")\n\nmsg = {\n     payload : edit.product.features[edit.index].values\n    }\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 210,
        "y": 760,
        "wires": [
            [
                "dbca34e49233a7d4"
            ]
        ]
    },
    {
        "id": "ca237eb130a5bdc3",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "add remove",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "$map(\t   payload,\t   function($v) {\t       $merge(\t           [\t               $v,\t               {\t                   'remove':'X'\t                }\t           ]\t       )\t   }\t)\t",
                "tot": "jsonata"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 210,
        "y": 800,
        "wires": [
            [
                "f9cece5ac88ea2a7",
                "f2e3a0db8dea4a4b",
                "d1876fc92f5ef163"
            ]
        ]
    },
    {
        "id": "b19da3d04cf94fc2",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "32c9d68b1d798fbc",
        "name": "set_settings_data",
        "func": "const math = global.get(\"mathjs\");\n\nmsg.path = \"settings.data\"\nmsg.store = \"file\"\n\nmsg.payload = {\n    feature_types : {\n        info : [\n            {\n                key: \"info\",\n                label: \"Information\",\n                type : \"text\",\n                def: \"info\"\n            }\n        ],\n        button : [\n            {\n                enabler: true,\n                scope: \"nominal\",\n                key: \"force\",\n                label: \"Force\",\n                unit: \"N\",\n                type: \"number\",\n                limit_type: \"relative_multiply\",\n                def: 0,\n            },\n            {\n                scope: \"nominal\",\n                key: \"travel\",\n                label: \"Travel\",\n                unit: \"mm\",\n                type: \"number\",\n                limit_type: \"relative_offset\",\n                def: 0\n            },\n            {\n                scope: \"process\",\n                key: \"z\",\n                label: \"Z coordinate\",\n                type: \"number\",\n                def: 0\n            },\n            {\n                scope: \"process\",\n                key: \"displacement\",\n                label: \"Press distance\",\n                type: \"number\",\n                def: 0\n            },\n            {\n                scope: \"process\",\n                key: \"velocity\",\n                label: \"Press velocity\",\n                unit: \"mm/s\",\n                type: \"number\",\n                def: 12\n            },\n            {\n                scope: \"process\",\n                key: \"count\",\n                label: \"Press count\",\n                type: \"number\",\n                def: 1\n            },\n            {\n                scope: \"nominal\",\n                key: \"resistance\",\n                label: \"Electrical resistance\",\n                unit: \"Ohm\",\n                type: \"number\",\n                def: 10,\n                limit_type: \"absolute\",\n            },\n            {\n                scope: \"nominal\",\n                key: \"bounce\",\n                label: \"Contact bounce\",\n                unit: \"ms\",\n                type: \"number\",\n                def: 2,\n                limit_type: \"absolute\",\n            },\n            {\n                scope: \"limit\",\n                key: \"force_limit\",\n                label: \"Force limit (+*/-*)\",\n                type: \"number\",\n                def: 0.3\n            },\n            {\n                scope: \"limit\",\n                key: \"travel_limit\",\n                label: \"Travel limit (+/-)\",\n                type: \"number\",\n                def: 0.2\n            },\n            {\n                scope: \"limit\",\n                key: \"resistance_limit\",\n                label: \"Resistance limit (upper)\",\n                type: \"number\",\n                def: 10\n            },\n            {\n                scope: \"limit\",\n                key: \"bounce_limit\",\n                label: \"Bounce limit (upper[ms])\",\n                type: \"number\",\n                def: 2\n            },\n        ],\n        encoder : [\n            {\n                scope: \"nominal\",\n                key: \"detents\",\n                label: \"Detents\",\n                type: \"number\",\n                def: 0,\n                limit_type: \"strict\"\n            },\n            {\n                scope: \"nominal\",\n                key: \"pulses\",\n                label: \"Resolution\",\n                type: \"number\",\n                def: 8,\n                limit_type: \"strict\"\n            },\n            {\n                scope: \"nominal\",\n                key: \"torque\",\n                label: \"Torque\",\n                type: \"number\",\n                def: 0,\n                limit_type: \"relative_multiply\"\n            },\n            {\n                scope: \"nominal\",\n                key: \"detent_torque\",\n                label: \"Detent torque\",\n                type: \"number\",\n                def: 0,\n                limit_type: \"relative_multiply\"\n            },\n            {\n                scope: \"process\",\n                key: \"z\",\n                label: \"Z coordinate\",\n                type: \"number\",\n                def: 0\n            },\n            {\n                scope: \"process\",\n                key: \"displacement\",\n                label: \"Rotations\",\n                type: \"number\",\n                def: 1.2\n            },\n            {\n                scope: \"process\",\n                key: \"velocity\",\n                label: \"Rotation velocity\",\n                unit: \"rpm\",\n                type: \"number\",\n                def: 60\n            },\n            {\n                scope: \"nominal\",\n                key: \"resistance\",\n                label: \"Electrical resistance\",\n                unit: \"Ohm\",\n                type: \"number\",\n                def: 10,\n                limit_type: \"absolute\",\n            },\n            {\n                scope: \"nominal\",\n                key: \"bounce\",\n                label: \"Contact bounce\",\n                unit: \"ms\",\n                type: \"number\",\n                def: 2,\n                limit_type: \"absolute\",\n            },\n            {\n                scope: \"nominal\",\n                key: \"phase\",\n                label: \"Phase shift\",\n                unit: \"deg\",\n                type: \"number\",\n                def: 90,\n                limit_type: \"relative_offset\",\n            },\n            {\n                scope: \"limit\",\n                key: \"torque_limit\",\n                label: \"Torque limit (+*/-*)\",\n                type: \"number\",\n                def: 0.3\n            },\n            {\n                scope: \"limit\",\n                key: \"detent_torque_limit\",\n                label: \"Detent torque limit (+*/-*)\",\n                type: \"number\",\n                def: 0.5\n            },\n            {\n                scope: \"limit\",\n                key: \"phase_limit\",\n                label: \"Phase shift limit (+/-)\",\n                type: \"number\",\n                def: 70\n            },\n        ],\n    },\n\n    prod_extract(name, prod) {\n        node.log(`name: ${name}`);\n        node.log(`product: ${prod.name}`)\n        const f = prod.features;\n        const v = (o) => `(${Object.keys(o.values).join(\"|\")})`;\n        const e = (o, k) => ((({name, values: { [k]: value }, ...r }) => ({ value, ...r }))(o));\n        const exp = new RegExp(f.reduce((acc, x, i) => acc.replace(`[f${i}]`, v(x)), prod.template));\n        const [match, ...k] = exp.exec(name) ?? [false];\n        return match ? f.reduce(function (acc, x, i) {\n            acc[x.name] = e(x, k[i]);\n            return acc;\n        }, {}) : \"invalid\";\n    },\n    \n}\n\n\nreturn msg;\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 410,
        "y": 1160,
        "wires": [
            [
                "eaa2da6793b55f40"
            ]
        ]
    },
    {
        "id": "f90fdbbfe117b568",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "modify:",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "modify",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 200,
        "y": 880,
        "wires": [
            [
                "1f3b495e00daba71"
            ]
        ]
    },
    {
        "id": "1f3b495e00daba71",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "create form",
        "func": "const {data} = global.get(\"settings\", \"file\");\nconst types = data.feature_types\nconst edit = flow.get(\"edit\");\nconst {product: prod, index: feat_ind} = edit\nconst type = prod.features[feat_ind].type\nvar {name, value} = msg?.payload \n\nswitch(type) {\n    case \"info\":\n        value ??= {\n            info: value\n        }\n}\n\nconst payload = {...value} ?? {}\nvar update = {\n    label: \"Edit value\",\n    options: []\n}\n\n\n\nswitch(msg.topic) {\n    case \"new\":\n        update.label = \"New value\";\n        update.options.push({\"type\": \"text\", \"label\": \"Symbol\", \"key\": \"name\", \"required\": true})\n        payload.name = \"\";\n        types[type].forEach(function(e) {\n            payload[e.key] = e.def;\n        });\n    case \"modify\":\n        edit.name = name\n        update.options.push(...(types[type].map((v) => ({...v, \"required\": true}))))\n}\n\nupdate.label = \"\"\nmsg.payload = payload\nmsg.ui_update = update\n\nreturn msg;\n\n/*\n\nmsg.ui_update = {\n    dropdownOptions: [\n        { \"dropdown\": \"type\", \"value\": \"button\", \"label\": \"Button\" },\n        { \"dropdown\": \"type\", \"value\": \"encoder\", \"label\": \"Encoder\" }\n    ],\n    options: [\n        { \"type\": \"text\", \"label\": \"Name\", \"key\": \"name\", \"required\": true },\n        { \"type\": \"dropdown\", \"label\": \"Type\", \"key\": \"type\", \"required\": true },\n    ],\n}\n\n\n\nconst { options: opt } = msg.ui_update\nvar strain_type = \"Force\"\nvar pulses_type = \"Repeat\"\n\nswitch (msg.payload?.type) {\n    case \"encoder\":\n        strain_type = \"Torque\"\n        pulses_type = \"Detents\"\n\n    case \"button\":\n        opt.splice(1, 1,\n            { \"type\": \"number\", \"label\": \"Position (Z)\", \"key\": \"position\", \"required\": false },\n            { \"type\": \"number\", \"label\": strain_type, \"key\": \"strain\", \"required\": false },\n            { \"type\": \"number\", \"label\": pulses_type, \"key\": \"pulses\", \"required\": false }\n        )\n        return msg;\n}\n\nmsg.payload = {\n    name: \"Name\",\n    type: \"button\"\n}\n\nreturn msg;\n*/",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 350,
        "y": 900,
        "wires": [
            [
                "d069aa2590aa031f",
                "a601fa8b67067a91",
                "f2e3a0db8dea4a4b"
            ]
        ]
    },
    {
        "id": "30e422b091f39fa3",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "inShowEdit",
        "links": [
            "d069aa2590aa031f"
        ],
        "x": 665,
        "y": 700,
        "wires": [
            [
                "d22bef696024a279"
            ]
        ]
    },
    {
        "id": "d069aa2590aa031f",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "outUpdateEdit",
        "mode": "link",
        "links": [
            "30e422b091f39fa3"
        ],
        "x": 475,
        "y": 900,
        "wires": []
    },
    {
        "id": "a601fa8b67067a91",
        "type": "delay",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "",
        "pauseType": "delay",
        "timeout": "100",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 350,
        "y": 940,
        "wires": [
            [
                "03b94af069cc8537"
            ]
        ]
    },
    {
        "id": "e4eda6a9e6628f2f",
        "type": "function",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "edit component",
        "func": "const {data} = global.get(\"settings\", \"file\");\nconst types = data.feature_types\nconst edit = flow.get(\"edit\");\nconst {product: prod, index: feat_ind} = edit\nconst feature = prod.features[feat_ind]\nvar {name = edit.name, ...rest} = msg?.payload \n\n\nfeature.values[name] = rest\n\nif(prod.name === \"E37\") {\n    if (feature.name === \"inner\") {\n        Object.assign(prod.features.find(x => x.name === \"outer\").values, feature.values)\n    } else if (feature.name === \"outer\") {\n        Object.assign(prod.features.find(x => x.name === \"inner\").values, feature.values)\n    }\n\n}\n\nglobal.set(edit.path + \".features\", prod.features, \"file\")\n\nreturn msg;\n\n",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 620,
        "y": 880,
        "wires": [
            [
                "3d457befa2bee268"
            ]
        ]
    },
    {
        "id": "d1876fc92f5ef163",
        "type": "ui-text",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "group": "b7574cc4a83ac22e",
        "order": 1,
        "width": 0,
        "height": 0,
        "name": "",
        "label": "",
        "format": "{{msg.payload}}",
        "layout": "row-left",
        "style": false,
        "font": "",
        "fontSize": 16,
        "color": "#717171",
        "wrapText": false,
        "className": "",
        "value": "(\t   $edit := $flowContext(\"edit\");\t   $edit.product.features[$edit.index].label\t)\t\t",
        "valueType": "jsonata",
        "x": 370,
        "y": 800,
        "wires": []
    },
    {
        "id": "6d3a3d61dd8734cf",
        "type": "link in",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "inHideEdit",
        "links": [
            "3d457befa2bee268"
        ],
        "x": 665,
        "y": 660,
        "wires": [
            [
                "396bfb23c28ff5b8"
            ]
        ]
    },
    {
        "id": "3d457befa2bee268",
        "type": "link out",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "outEditDone",
        "mode": "link",
        "links": [
            "6d3a3d61dd8734cf",
            "b813fb708889b927"
        ],
        "x": 815,
        "y": 860,
        "wires": []
    },
    {
        "id": "632d196f1b0465cb",
        "type": "inject",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "set default",
        "props": [],
        "repeat": "",
        "crontab": "",
        "once": true,
        "onceDelay": 0.1,
        "topic": "",
        "x": 390,
        "y": 220,
        "wires": [
            [
                "4f8bb3c473c5249f"
            ]
        ]
    },
    {
        "id": "f99e252f0a818113",
        "type": "link call",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "",
        "links": [
            "f7ac8e854a829e1f"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 390,
        "y": 300,
        "wires": [
            [
                "6d84d370604bcb7f"
            ]
        ]
    },
    {
        "id": "4f8bb3c473c5249f",
        "type": "change",
        "z": "aecf9ba551ec4a57",
        "g": "3eb3d696e34bc6e2",
        "name": "get selected",
        "rules": [
            {
                "t": "set",
                "p": "name",
                "pt": "msg",
                "to": "E37",
                "tot": "str",
                "dc": true
            },
            {
                "t": "set",
                "p": "path",
                "pt": "msg",
                "to": "\"settings.products.E37\"",
                "tot": "jsonata"
            },
            {
                "t": "set",
                "p": "store",
                "pt": "msg",
                "to": "file",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 390,
        "y": 260,
        "wires": [
            [
                "f99e252f0a818113"
            ]
        ]
    },
    {
        "id": "5239e5d08e988b30",
        "type": "inject",
        "z": "aecf9ba551ec4a57",
        "g": "91212d0a56043b3b",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 520,
        "y": 660,
        "wires": [
            [
                "5a000baa5781089c"
            ]
        ]
    },
    {
        "id": "fe36b4aab8e4b51e",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": "0",
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 80,
        "wires": [
            [
                "02df4cd3db727bea"
            ]
        ]
    },
    {
        "id": "02df4cd3db727bea",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [{name: 'marina', age: 22}];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 80,
        "wires": [
            [
                "fbdbc88728b6bb53"
            ]
        ]
    },
    {
        "id": "fbdbc88728b6bb53",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "insertOne",
        "output": "toArray",
        "maxTimeMS": "",
        "handleDocId": false,
        "name": "",
        "x": 480,
        "y": 80,
        "wires": [
            [
                "ad6bea22c0e0b689"
            ]
        ]
    },
    {
        "id": "ad6bea22c0e0b689",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 80,
        "wires": []
    },
    {
        "id": "8ee269b8753b02a1",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 140,
        "wires": [
            [
                "b3879290c479d05d"
            ]
        ]
    },
    {
        "id": "b3879290c479d05d",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [[\n    {name: 'chris', age: 22},\n    {name: 'markus', age: 22}\n]];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 140,
        "wires": [
            [
                "f5c11e1900707b1c"
            ]
        ]
    },
    {
        "id": "f5c11e1900707b1c",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "insertMany",
        "output": "toArray",
        "handleDocId": false,
        "name": "",
        "x": 490,
        "y": 140,
        "wires": [
            [
                "7a265f43dea48889"
            ]
        ]
    },
    {
        "id": "7a265f43dea48889",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 140,
        "wires": []
    },
    {
        "id": "5c8f4bef1a115679",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 260,
        "wires": [
            [
                "df0db7fed54ff2ef"
            ]
        ]
    },
    {
        "id": "df0db7fed54ff2ef",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [{name: 'marina'}, {fields: {name: 1, age: 1}}];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 260,
        "wires": [
            [
                "fb9612f0dabb7e67"
            ]
        ]
    },
    {
        "id": "fb9612f0dabb7e67",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "findOne",
        "output": "toArray",
        "handleDocId": false,
        "name": "",
        "x": 480,
        "y": 260,
        "wires": [
            [
                "fc1f0dfb426c9034"
            ]
        ]
    },
    {
        "id": "fc1f0dfb426c9034",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 260,
        "wires": []
    },
    {
        "id": "5b61665e0f5cc0c5",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 320,
        "wires": [
            [
                "91c84ba4d12fb033"
            ]
        ]
    },
    {
        "id": "91c84ba4d12fb033",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [{name: \"marina\"}];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 320,
        "wires": [
            [
                "daa4aeeeb29120ca"
            ]
        ]
    },
    {
        "id": "daa4aeeeb29120ca",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "find",
        "output": "toArray",
        "maxTimeMS": "",
        "handleDocId": false,
        "name": "find.toArray",
        "x": 490,
        "y": 320,
        "wires": [
            [
                "39ce7da42ba01b32"
            ]
        ]
    },
    {
        "id": "39ce7da42ba01b32",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 320,
        "wires": []
    },
    {
        "id": "1075d26bfd292f92",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 380,
        "wires": [
            [
                "f83a21e14acc6837"
            ]
        ]
    },
    {
        "id": "f83a21e14acc6837",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [{name: \"marina\"}];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 380,
        "wires": [
            [
                "0d76106c415ab9bc"
            ]
        ]
    },
    {
        "id": "0d76106c415ab9bc",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "find",
        "output": "forEach",
        "handleDocId": false,
        "name": "find.forEach",
        "x": 490,
        "y": 380,
        "wires": [
            [
                "6c446d0d50cd33eb"
            ]
        ]
    },
    {
        "id": "6c446d0d50cd33eb",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 380,
        "wires": []
    },
    {
        "id": "e00d5ecdcb458feb",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 440,
        "wires": [
            [
                "5a7163e6a172dec5"
            ]
        ]
    },
    {
        "id": "5a7163e6a172dec5",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [{name: \"marina\"}];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 440,
        "wires": [
            [
                "eeb034c85f0a357e"
            ]
        ]
    },
    {
        "id": "eeb034c85f0a357e",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "countDocuments",
        "output": "toArray",
        "maxTimeMS": "",
        "handleDocId": false,
        "name": "countDocuments",
        "x": 510,
        "y": 440,
        "wires": [
            [
                "2f288690a68278bd"
            ]
        ]
    },
    {
        "id": "2f288690a68278bd",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 440,
        "wires": []
    },
    {
        "id": "d5700bd465e13fa5",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payloadType": "date",
        "x": 140,
        "y": 200,
        "wires": [
            [
                "2581ad0e69bb4b74"
            ]
        ]
    },
    {
        "id": "2581ad0e69bb4b74",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [{}, {$inc: {age: 1}, $set: {aged: true}}];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 200,
        "wires": [
            [
                "ec5005a3a476c75b"
            ]
        ]
    },
    {
        "id": "ec5005a3a476c75b",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "updateMany",
        "output": "toArray",
        "handleDocId": false,
        "name": "",
        "x": 490,
        "y": 200,
        "wires": [
            [
                "513e182443df307e"
            ]
        ]
    },
    {
        "id": "513e182443df307e",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 200,
        "wires": []
    },
    {
        "id": "0f1419fe40a054a4",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 500,
        "wires": [
            [
                "103caed91230c198"
            ]
        ]
    },
    {
        "id": "103caed91230c198",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "set payload",
        "func": "msg.payload = [{age: {$gt: 25}}];\nreturn msg;",
        "outputs": 1,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 310,
        "y": 500,
        "wires": [
            [
                "3b5f6cbbc8585516"
            ]
        ]
    },
    {
        "id": "3b5f6cbbc8585516",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "deleteMany",
        "output": "toArray",
        "handleDocId": false,
        "name": "",
        "x": 490,
        "y": 500,
        "wires": [
            [
                "d69cf47b58e754d7"
            ]
        ]
    },
    {
        "id": "d69cf47b58e754d7",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 500,
        "wires": []
    },
    {
        "id": "d72c3423667d2fe7",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 620,
        "wires": [
            [
                "4fbc5c911d465894"
            ]
        ]
    },
    {
        "id": "4fbc5c911d465894",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "db",
        "collection": "",
        "operation": "stats",
        "output": "toArray",
        "handleDocId": false,
        "name": "db stats",
        "x": 480,
        "y": 620,
        "wires": [
            [
                "53eb06efe65bcfc4"
            ]
        ]
    },
    {
        "id": "53eb06efe65bcfc4",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "payload",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 700,
        "y": 620,
        "wires": []
    },
    {
        "id": "4efb71ded2d8a294",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 140,
        "y": 560,
        "wires": [
            [
                "f345242e576f8361"
            ]
        ]
    },
    {
        "id": "f345242e576f8361",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "distinct name",
        "func": "msg.payload = [\"name\"];\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 320,
        "y": 560,
        "wires": [
            [
                "9960080cec50e212"
            ]
        ]
    },
    {
        "id": "9960080cec50e212",
        "type": "mongodb4",
        "z": "6b7a48cdf37ecce9",
        "clientNode": "",
        "mode": "collection",
        "collection": "persons",
        "operation": "distinct",
        "output": "toArray",
        "handleDocId": false,
        "name": "",
        "x": 480,
        "y": 560,
        "wires": [
            [
                "df8bfd9233fa703a"
            ]
        ]
    },
    {
        "id": "df8bfd9233fa703a",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 710,
        "y": 560,
        "wires": []
    },
    {
        "id": "46a4de9f0e9df69e",
        "type": "s7 in",
        "z": "6b7a48cdf37ecce9",
        "endpoint": "08baf0b5c9586966",
        "mode": "all",
        "variable": "Results",
        "diff": false,
        "name": "Get results",
        "x": 1180,
        "y": 140,
        "wires": [
            [
                "189d608d7b021cf1"
            ]
        ]
    },
    {
        "id": "ac2caa642854176d",
        "type": "debug",
        "z": "6b7a48cdf37ecce9",
        "name": "debug 9",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1840,
        "y": 140,
        "wires": []
    },
    {
        "id": "96e12c319f3cac49",
        "type": "s7 control",
        "z": "6b7a48cdf37ecce9",
        "endpoint": "08baf0b5c9586966",
        "function": "trigger",
        "name": "",
        "x": 1160,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "1654fd94049aee89",
        "type": "inject",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 980,
        "y": 80,
        "wires": [
            [
                "96e12c319f3cac49"
            ]
        ]
    },
    {
        "id": "189d608d7b021cf1",
        "type": "split",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "splt": "\\n",
        "spltType": "str",
        "arraySplt": "24",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "property": "payload.resultBuffer",
        "x": 1330,
        "y": 140,
        "wires": [
            [
                "e79c47f07cb23871"
            ]
        ]
    },
    {
        "id": "e79c47f07cb23871",
        "type": "function",
        "z": "6b7a48cdf37ecce9",
        "name": "restore_structure",
        "func": "const data = new Uint8Array(msg.payload.resultBuffer)\nconst buff = data.buffer\n\nconst instance = {\n    timeStamp : new DataView(buff).getFloat32(0, false),\n    position : new DataView(buff).getFloat32(4, false),\n    ohm : String.fromCharCode.apply(null,data.slice(10, 10 + data[9])).match(/\\d+\\.?\\d*/g)?.map(Number)[0] || -1,\n    strain : new DataView(buff).getFloat32(20, false)\n}\n\nmsg.payload.data = instance\nmsg.parts.property = \"payload.data\"\nmsg.parts.count = msg.payload.count\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1490,
        "y": 140,
        "wires": [
            [
                "b94f2d29c80d5bea"
            ]
        ]
    },
    {
        "id": "b94f2d29c80d5bea",
        "type": "join",
        "z": "6b7a48cdf37ecce9",
        "name": "",
        "mode": "auto",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": false,
        "accumulate": "false",
        "timeout": "",
        "count": "",
        "reduceRight": false,
        "x": 1650,
        "y": 140,
        "wires": [
            [
                "ac2caa642854176d"
            ]
        ]
    },
    {
        "id": "08b8e929348e0608",
        "type": "ui-dropdown",
        "z": "c31a62b56be46a15",
        "group": "",
        "name": "Pulses",
        "label": "Pulsuri / rotaie",
        "order": 1,
        "width": "6",
        "height": "1",
        "passthru": true,
        "multiple": false,
        "chips": false,
        "clearable": false,
        "options": [
            {
                "label": "8",
                "value": "8",
                "type": "str"
            },
            {
                "label": "16",
                "value": "16",
                "type": "str"
            },
            {
                "label": "32",
                "value": "32",
                "type": "str"
            }
        ],
        "payload": 32,
        "topic": "pulses",
        "topicType": "str",
        "className": "",
        "typeIsComboBox": true,
        "msgTrigger": "onChange",
        "x": 130,
        "y": 80,
        "wires": [
            [
                "5742618fd1132f23"
            ]
        ]
    },
    {
        "id": "30ea0aac7634aeea",
        "type": "ui-number-input",
        "z": "c31a62b56be46a15",
        "group": "",
        "name": "Seconds",
        "label": "Durata captur (s)",
        "order": 1,
        "width": "6",
        "height": "1",
        "topic": "seconds",
        "topicType": "str",
        "min": 1,
        "max": 5,
        "step": 1,
        "tooltip": "",
        "passthru": true,
        "sendOnBlur": true,
        "sendOnEnter": true,
        "className": "",
        "clearable": false,
        "icon": "",
        "iconPosition": "left",
        "iconInnerPosition": "inside",
        "spinner": "default",
        "x": 120,
        "y": 140,
        "wires": [
            [
                "5742618fd1132f23"
            ]
        ]
    },
    {
        "id": "e0a95d2a33292aae",
        "type": "ui-button",
        "z": "c31a62b56be46a15",
        "group": "",
        "name": "Start",
        "label": "Start captur",
        "order": 1,
        "width": "12",
        "height": "1",
        "emulateClick": false,
        "className": "",
        "icon": "",
        "iconPosition": "left",
        "payload": "START",
        "payloadType": "str",
        "topic": "start",
        "topicType": "str",
        "buttonColor": "",
        "textColor": "",
        "iconColor": "",
        "enableClick": true,
        "enablePointerdown": false,
        "pointerdownPayload": "",
        "pointerdownPayloadType": "str",
        "enablePointerup": false,
        "pointerupPayload": "",
        "pointerupPayloadType": "str",
        "x": 110,
        "y": 200,
        "wires": [
            [
                "1cde7940fdde1a25",
                "517809c382b23437"
            ]
        ]
    },
    {
        "id": "02b9dcea35a30918",
        "type": "ui-text",
        "z": "c31a62b56be46a15",
        "group": "",
        "order": 1,
        "width": "12",
        "height": "1",
        "name": "Status",
        "label": "Status",
        "format": "{{msg.payload}}",
        "layout": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "wrapText": false,
        "className": "",
        "value": "payload",
        "valueType": "msg",
        "x": 610,
        "y": 40,
        "wires": []
    },
    {
        "id": "1cde7940fdde1a25",
        "type": "change",
        "z": "c31a62b56be46a15",
        "name": "status busy",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Capturing apas butonul/nvrte encoderul (1 rotaie)",
                "tot": "str"
            }
        ],
        "x": 320,
        "y": 40,
        "wires": [
            [
                "02b9dcea35a30918"
            ]
        ]
    },
    {
        "id": "5742618fd1132f23",
        "type": "function",
        "z": "c31a62b56be46a15",
        "name": "Store cfg",
        "func": "let cfg = context.get('cfg') || {};\nif (msg.topic === 'pulses') cfg.pulses = Number(msg.payload);\nif (msg.topic === 'seconds') cfg.seconds = Number(msg.payload);\nif (!cfg.pulses) cfg.pulses = 32;\nif (!cfg.seconds) cfg.seconds = 2;\n// fix sampling: 2 kS/s\ncfg.dt = 0.0005; // sec\ncontext.set('cfg', cfg);\nreturn null;",
        "outputs": 1,
        "x": 430,
        "y": 100,
        "wires": [
            []
        ]
    },
    {
        "id": "517809c382b23437",
        "type": "function",
        "z": "c31a62b56be46a15",
        "name": "Build SCPI (setup + INIT + *OPC?)",
        "func": "let cfg = context.get('cfg') || { pulses: 32, seconds: 2, dt: 0.0005 };\nlet dt = cfg.dt || 0.0005;\nlet seconds = cfg.seconds || 2;\nlet trigCount = Math.round(seconds / dt);\nif (trigCount < 100) trigCount = 100;\n\ncfg.trigCount = trigCount;\ncontext.set('cfg', cfg);\n\n// one command per message, NO ';'\nmsg.payload = [\n  '*CLS',\n  'CONF:FRES 100',\n  'FRES:NPLC 0.02',\n  'TRIG:SOUR TIM',\n  `TRIG:TIM ${dt}`,\n  'SAMP:COUN 1',\n  `TRIG:COUN ${trigCount}`,\n  'INIT',\n  '*OPC?'\n];\n\n// marker: new capture id for chart/topic\nmsg.captureId = Date.now();\ncontext.set('captureId', msg.captureId);\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 400,
        "y": 180,
        "wires": [
            [
                "f439b2248f7423d8"
            ]
        ]
    },
    {
        "id": "f439b2248f7423d8",
        "type": "split",
        "z": "c31a62b56be46a15",
        "name": "Split array",
        "splt": "1",
        "spltType": "len",
        "arraySplt": "1",
        "stream": false,
        "addname": "cmd",
        "x": 680,
        "y": 180,
        "wires": [
            [
                "0cdc208488344a06"
            ]
        ]
    },
    {
        "id": "0b7a59ea3dba2d5e",
        "type": "function",
        "z": "c31a62b56be46a15",
        "name": "keep last cmd",
        "func": "context.set('lastCmd', (msg.payload||'').toString().trim());\nreturn msg;",
        "outputs": 1,
        "x": 1140,
        "y": 300,
        "wires": [
            []
        ]
    },
    {
        "id": "f71151151508f5c9",
        "type": "function",
        "z": "c31a62b56be46a15",
        "name": "add newline",
        "func": "msg.payload = (msg.payload || '').toString() + \"\\n\";\nreturn msg;",
        "outputs": 1,
        "x": 1130,
        "y": 220,
        "wires": [
            [
                "03afb7e6d219c2b0"
            ]
        ]
    },
    {
        "id": "03afb7e6d219c2b0",
        "type": "tcp request",
        "z": "c31a62b56be46a15",
        "name": "DMM SCPI",
        "server": "192.168.100.25",
        "port": "5025",
        "out": "time",
        "ret": "string",
        "splitc": "\\n",
        "x": 1290,
        "y": 160,
        "wires": [
            [
                "336f53eb271a187a"
            ]
        ]
    },
    {
        "id": "336f53eb271a187a",
        "type": "function",
        "z": "c31a62b56be46a15",
        "name": "If OPC done -> FETC?",
        "func": "let resp = (msg.payload || '').toString().trim();\nlet lastCmd = context.get('lastCmd') || '';\n\n// only react to *OPC? reply\nif (lastCmd === '*OPC?' && resp === '1') {\n  // request readings\n  return [{ payload: 'FETC?\\n' }, { payload: 'Captur complet. Citesc datele' }];\n}\nreturn [null, null];",
        "outputs": 2,
        "x": 1520,
        "y": 100,
        "wires": [
            [
                "3a15c82cb23a9319"
            ],
            [
                "02b9dcea35a30918"
            ]
        ]
    },
    {
        "id": "3a15c82cb23a9319",
        "type": "tcp request",
        "z": "c31a62b56be46a15",
        "name": "DMM SCPI (FETC)",
        "server": "192.168.100.25",
        "port": "5025",
        "out": "time",
        "ret": "string",
        "splitc": "\\n",
        "x": 1770,
        "y": 170,
        "wires": [
            [
                "5741454c8d2e0a4b",
                "ab11722afab8f847"
            ]
        ]
    },
    {
        "id": "5741454c8d2e0a4b",
        "type": "function",
        "z": "c31a62b56be46a15",
        "name": "Analyze -> chart points + table + summary",
        "func": "let cfg = context.get('cfg') || { pulses: 32, dt: 0.0005 };\nconst PULSES = Number(cfg.pulses || 32);\nconst DT = Number(cfg.dt || 0.0005);\n\n// thresholds\nconst FAIL_OPEN_OHM = 10.0;\nconst CLOSED_THRESH_OHM = 1.0;\nconst BOUNCE_LIMIT_MS = 2.0;\nconst stableN = Math.max(1, Math.ceil((BOUNCE_LIMIT_MS / 1000) / DT));\n\n// Parse CSV\nlet s = (msg.payload || '').toString().trim();\nlet parts = s.split(',');\nlet arr = [];\nfor (let i = 0; i < parts.length; i++) {\n  let v = Number(parts[i]);\n  if (Number.isFinite(v)) arr.push(v);\n}\nif (arr.length < 50) {\n  return [null, { payload: { data: [] } }, { payload: `Prea puine samples: ${arr.length}` }];\n}\n\n// Build chart messages (one point per msg) for Dashboard 2 ui-chart\nlet t0 = Date.now();\nlet chartMsgs = arr.map((v, i) => ({\n  topic: 'R_mOhm',\n  payload: v * 1000,\n  timestamp: t0 + i * DT * 1000\n}));\n\n// Per-contact windows\nlet winLen = Math.floor(arr.length / PULSES);\nif (winLen < 2) winLen = 2;\n\nfunction median(xs) {\n  if (xs.length === 0) return NaN;\n  let a = xs.slice().sort((a, b) => a - b);\n  let m = Math.floor(a.length / 2);\n  return (a.length % 2) ? a[m] : 0.5 * (a[m - 1] + a[m]);\n}\n\nlet rows = [];\nlet failCount = 0;\nlet worstBounce = 0;\n\nfor (let c = 0; c < PULSES; c++) {\n  let start = c * winLen;\n  let end = (c === PULSES - 1) ? arr.length : (c + 1) * winLen;\n  let w = arr.slice(start, end);\n\n  let maxOhm = -Infinity;\n  for (let v of w) if (v > maxOhm) maxOhm = v;\n  let hasOpen = (maxOhm > FAIL_OPEN_OHM);\n\n  let firstClosed = -1;\n  for (let i = 0; i < w.length; i++) {\n    if (w[i] < CLOSED_THRESH_OHM) { firstClosed = i; break; }\n  }\n\n  let bounceMs = NaN;\n  let stableIdx = -1;\n  if (firstClosed >= 0) {\n    for (let i = firstClosed; i <= w.length - stableN; i++) {\n      let ok = true;\n      for (let k = 0; k < stableN; k++) {\n        if (!(w[i + k] < CLOSED_THRESH_OHM)) { ok = false; break; }\n      }\n      if (ok) { stableIdx = i; break; }\n    }\n    bounceMs = (stableIdx >= 0)\n      ? (stableIdx - firstClosed) * DT * 1000\n      : (w.length - firstClosed) * DT * 1000;\n  }\n\n  if (Number.isFinite(bounceMs) && bounceMs > worstBounce) worstBounce = bounceMs;\n\n  // contact resistance from stable region\n  let rOhm = NaN;\n  if (stableIdx >= 0) {\n    let stable = w.slice(stableIdx + stableN).filter(v => v < CLOSED_THRESH_OHM);\n    rOhm = median(stable);\n  }\n\n  let failBounce = Number.isFinite(bounceMs) ? (bounceMs > BOUNCE_LIMIT_MS) : true;\n  let failNoClose = (firstClosed < 0);\n  let status = (hasOpen || failBounce || failNoClose) ? 'FAIL' : 'PASS';\n  if (status === 'FAIL') failCount++;\n\n  rows.push({\n    contact: c + 1,\n    r_mOhm: Number.isFinite(rOhm) ? rOhm * 1000 : null,\n    bounce_ms: Number.isFinite(bounceMs) ? bounceMs : null,\n    max_ohm: Number.isFinite(maxOhm) ? maxOhm : null,\n    status\n  });\n}\n\nlet summary = `pulses=${PULSES} samples=${arr.length} dt=${(DT * 1000).toFixed(3)}ms failCount=${failCount} worstBounce=${worstBounce.toFixed(2)}ms`;\n\n// out1: array of chart points -> split -> ui-chart\n// out2: ui-table expects payload.data\n// out3: summary text\nreturn [\n  { payload: chartMsgs },\n  { payload: { data: rows } },\n  { payload: summary }\n];",
        "outputs": 3,
        "x": 2060,
        "y": 180,
        "wires": [
            [
                "8a6ea27c750b4958"
            ],
            [
                "3c0ec033d755b547"
            ],
            [
                "85fc8e3d13edcd58"
            ]
        ]
    },
    {
        "id": "8a6ea27c750b4958",
        "type": "split",
        "z": "c31a62b56be46a15",
        "name": "Split chart points",
        "splt": "1",
        "spltType": "len",
        "arraySplt": "1",
        "arraySpltType": "len",
        "stream": false,
        "addname": "",
        "property": "payload",
        "x": 2210,
        "y": 60,
        "wires": [
            [
                "64747030ebb305dc"
            ]
        ]
    },
    {
        "id": "64747030ebb305dc",
        "type": "ui-chart",
        "z": "c31a62b56be46a15",
        "group": "",
        "name": "Rezisten",
        "label": "Rezisten (m)  zoom wheel / pan drag",
        "order": 1,
        "chartType": "line",
        "category": "topic",
        "categoryType": "msg",
        "xAxisLabel": "",
        "xAxisProperty": "",
        "xAxisPropertyType": "timestamp",
        "xAxisType": "time",
        "xAxisFormat": "HH:mm:ss.SSS",
        "xAxisFormatType": "auto",
        "xmin": "",
        "xmax": "",
        "yAxisLabel": "",
        "yAxisProperty": "payload",
        "yAxisPropertyType": "msg",
        "ymin": "",
        "ymax": "",
        "bins": "",
        "stackSeries": false,
        "pointRadius": "",
        "showLegend": true,
        "removeOlder": "3",
        "removeOlderUnit": "1",
        "removeOlderPoints": "4000",
        "colors": [
            "#1f77b4",
            "#aec7e8",
            "#ff7f0e",
            "#2ca02c",
            "#98df8a",
            "#d62728",
            "#ff9896",
            "#9467bd",
            "#c5b0d5"
        ],
        "textColor": [
            "#666666"
        ],
        "textColorDefault": true,
        "gridColor": [
            "#e5e5e5"
        ],
        "gridColorDefault": true,
        "width": "12",
        "height": "6",
        "className": "",
        "interpolation": "linear",
        "x": 2450,
        "y": 80,
        "wires": [
            []
        ]
    },
    {
        "id": "3c0ec033d755b547",
        "type": "ui-table",
        "z": "c31a62b56be46a15",
        "group": "",
        "name": "Per contact",
        "label": "Rezultate pe contact",
        "order": 1,
        "width": "12",
        "height": "8",
        "maxrows": "",
        "autocols": true,
        "showSearch": false,
        "deselect": true,
        "selectionType": "none",
        "columns": [
            {
                "title": "",
                "key": "",
                "keyType": "key",
                "width": "",
                "align": "center"
            },
            {
                "title": "",
                "key": "",
                "keyType": "key",
                "width": ""
            },
            {
                "title": "",
                "key": "",
                "keyType": "key",
                "width": ""
            },
            {
                "title": "",
                "key": "",
                "keyType": "key",
                "width": ""
            },
            {
                "title": "",
                "key": "",
                "keyType": "key",
                "width": "",
                "align": "center"
            }
        ],
        "mobileBreakpoint": "lg",
        "mobileBreakpointType": "defaults",
        "action": "append",
        "x": 2420,
        "y": 190,
        "wires": [
            []
        ]
    },
    {
        "id": "85fc8e3d13edcd58",
        "type": "ui-text",
        "z": "c31a62b56be46a15",
        "group": "",
        "order": 1,
        "width": "12",
        "height": "1",
        "name": "Summary",
        "label": "Sumar",
        "format": "{{msg.payload}}",
        "layout": "",
        "style": false,
        "font": "",
        "fontSize": "",
        "color": "#000000",
        "wrapText": false,
        "className": "",
        "value": "payload",
        "valueType": "msg",
        "x": 2400,
        "y": 250,
        "wires": []
    },
    {
        "id": "963f98ace7bc77ba",
        "type": "change",
        "z": "c31a62b56be46a15",
        "name": "status done",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "Gata. Poi face zoom cu wheel i pan cu drag pe grafic.",
                "tot": "str"
            }
        ],
        "x": 2390,
        "y": 380,
        "wires": [
            [
                "02b9dcea35a30918"
            ]
        ]
    },
    {
        "id": "0cdc208488344a06",
        "type": "delay",
        "z": "c31a62b56be46a15",
        "name": "40ms between cmds",
        "pauseType": "delay",
        "timeout": "40",
        "timeoutUnits": "milliseconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 860,
        "y": 240,
        "wires": [
            [
                "f71151151508f5c9",
                "0b7a59ea3dba2d5e"
            ]
        ]
    },
    {
        "id": "ab11722afab8f847",
        "type": "debug",
        "z": "c31a62b56be46a15",
        "name": "debug 3",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "false",
        "statusVal": "",
        "statusType": "auto",
        "x": 2000,
        "y": 480,
        "wires": []
    }
]